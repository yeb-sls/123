# 云函数上传指南

## 问题描述

出现错误：`fc_function_not_found getJointReceivers`，表示云函数在云端不存在。

## 解决方案

需要将云函数上传到云端。以下是几种上传方法：

## 方法一：使用 HBuilderX 上传

### 1. 在 HBuilderX 中操作
1. 打开 HBuilderX
2. 在项目管理器中找到 `uniCloud-aliyun/cloudfunctions/getJointReceivers` 文件夹
3. 右键点击 `getJointReceivers` 文件夹
4. 选择 "上传部署"
5. 等待上传完成

### 2. 批量上传所有云函数
1. 右键点击 `uniCloud-aliyun/cloudfunctions` 文件夹
2. 选择 "上传所有云函数"
3. 等待所有云函数上传完成

## 方法二：使用 uniCloud 控制台

### 1. 登录 uniCloud 控制台
1. 访问 [uniCloud 控制台](https://unicloud.dcloud.net.cn/)
2. 登录您的账号
3. 选择对应的服务空间

### 2. 创建云函数
1. 进入 "云函数" 页面
2. 点击 "新建云函数"
3. 函数名称：`getJointReceivers`
4. 运行环境：选择 Node.js
5. 点击 "确定"

### 3. 上传代码
1. 点击刚创建的云函数
2. 进入 "代码编辑" 页面
3. 将以下代码复制到 `index.js`：

```javascript
'use strict';
const db = uniCloud.database()

exports.main = async (event, context) => {
  try {
    // 获取合坛法会收件信息列表
    const res = await db.collection('joint_receivers')
      .orderBy('create_time', 'desc')
      .get()
    
    return {
      code: 0,
      data: res.data || []
    }
  } catch (error) {
    console.error('获取合坛法会收件信息列表失败:', error);
    return {
      code: 1,
      msg: '获取合坛法会收件信息列表失败',
      error: error.message || error
    }
  }
}
```

4. 点击 "保存并部署"

## 方法三：使用命令行工具

### 1. 安装 uniCloud CLI
```bash
npm install -g @dcloudio/unicloud-cli
```

### 2. 登录
```bash
uni login
```

### 3. 上传云函数
```bash
# 进入项目目录
cd 景区小程序

# 上传单个云函数
uni cloud function deploy getJointReceivers

# 或上传所有云函数
uni cloud function deploy
```

## 需要上传的云函数列表

根据错误信息，以下云函数可能需要上传：

1. `getJointReceivers` - 获取合坛法会收件信息列表
2. `getJointReceiverConfig` - 获取收件信息配置
3. `updateJointReceiverConfig` - 更新收件信息配置
4. `deleteJointReceiver` - 删除收件信息

## 验证上传结果

### 1. 在 HBuilderX 中验证
1. 右键点击云函数文件夹
2. 选择 "查看云端云函数"
3. 确认云函数已上传

### 2. 在控制台中验证
1. 登录 uniCloud 控制台
2. 进入 "云函数" 页面
3. 查看云函数列表，确认已上传

### 3. 测试云函数
1. 在控制台点击云函数
2. 进入 "测试" 页面
3. 点击 "运行" 测试云函数是否正常工作

## 常见问题

### 1. 上传失败
- 检查网络连接
- 确认服务空间配置正确
- 检查云函数代码语法

### 2. 云函数不存在
- 确认云函数名称拼写正确
- 确认云函数已上传到正确的服务空间
- 检查云函数是否已部署

### 3. 权限问题
- 确认账号有上传云函数的权限
- 检查服务空间的权限设置

## 注意事项

1. **服务空间**：确保上传到正确的服务空间
2. **函数名称**：云函数名称必须与代码中调用的名称一致
3. **依赖包**：如果云函数使用了第三方包，需要在 `package.json` 中声明
4. **环境变量**：注意云函数的环境变量配置

## 相关文档

- [uniCloud 云函数开发指南](https://uniapp.dcloud.net.cn/uniCloud/cf-functions.html)
- [uniCloud 控制台使用指南](https://uniapp.dcloud.net.cn/uniCloud/console.html) 