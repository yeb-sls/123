# 云函数清理指南

## 问题描述

阿里云服务空间的云函数数量已达上限，需要删除无用函数后再继续上传。

## 云函数分类分析

### 🔴 可以删除的云函数（测试或重复功能）

#### 1. 测试相关云函数
- `initDatabase` - 数据库初始化（测试用）
- `initJointDatabase` - 合坛法会数据库初始化（测试用）
- `checkJointDatabase` - 合坛法会数据库检查（测试用）
- `checkJointGoodsConfig` - 合坛法会物品配置检查（测试用）
- `checkJointReceiverConfig` - 合坛法会收件配置检查（测试用）

#### 2. 重复或冗余的云函数
- `getJointProject` - 获取单个项目（与 `getJointProjects` 重复）
- `getJointReceiver` - 获取单个收件人（与 `getJointReceivers` 重复）

#### 3. 可能不再使用的云函数
- `getFahuiStats` - 法会统计（如果不需要统计功能）
- `getAdminStats` - 管理员统计（如果不需要统计功能）

### 🟡 需要保留的核心云函数

#### 合坛法会核心功能
- `getJointProjects` - 获取合坛法会项目列表
- `getJointOrders` - 获取合坛法会订单列表
- `createJointOrder` - 创建合坛法会订单
- `updateJointOrderStatus` - 更新订单状态
- `addJointOrderRemark` - 添加订单备注
- `exportJointOrders` - 导出订单

#### 合坛法会配置管理
- `getJointBanners` - 获取横幅
- `addJointBanner` - 添加横幅
- `updateJointBanner` - 更新横幅
- `deleteJointBanner` - 删除横幅

- `getJointIntros` - 获取介绍
- `addJointIntro` - 添加介绍
- `updateJointIntro` - 更新介绍
- `deleteJointIntro` - 删除介绍

- `addJointProject` - 添加项目
- `updateJointProject` - 更新项目
- `deleteJointProject` - 删除项目

#### 合坛法会物品管理
- `getJointGoods` - 获取物品列表
- `addJointGood` - 添加物品
- `updateJointGood` - 更新物品
- `deleteJointGood` - 删除物品
- `getJointGoodsConfig` - 获取物品配置
- `updateJointGoodsConfig` - 更新物品配置

#### 合坛法会收件管理
- `getJointReceivers` - 获取收件人列表
- `addJointReceiver` - 添加收件人
- `updateJointReceiver` - 更新收件人
- `deleteJointReceiver` - 删除收件人
- `getJointReceiverConfig` - 获取收件配置
- `updateJointReceiverConfig` - 更新收件配置

#### 通知系统
- `getUnreadNotificationCount` - 获取未读通知数量
- `getAdminNotifications` - 获取管理员通知
- `markNotificationAsRead` - 标记通知为已读
- `markAllNotificationsAsRead` - 标记所有通知为已读
- `notifyAdminOnPayment` - 支付成功通知

#### 专场法会核心功能
- `getFahuiProjects` - 获取法会项目
- `getFahuiOrders` - 获取法会订单
- `submitFahuiOrder` - 提交法会订单
- `updateFahuiOrderStatus` - 更新法会订单状态
- `addFahuiOrderRemark` - 添加法会订单备注

#### 其他功能
- `getLightItems` - 供灯项目
- `getHallItems` - 殿堂项目
- `getDelegateGoods` - 代办物品

## 删除步骤

### 步骤1：删除测试云函数

在 HBuilderX 中：

1. **删除数据库初始化相关**
   - 右键点击 `initDatabase` → 选择 "删除"
   - 右键点击 `initJointDatabase` → 选择 "删除"
   - 右键点击 `checkJointDatabase` → 选择 "删除"

2. **删除配置检查相关**
   - 右键点击 `checkJointGoodsConfig` → 选择 "删除"
   - 右键点击 `checkJointReceiverConfig` → 选择 "删除"

### 步骤2：删除重复云函数

1. **删除重复的项目获取函数**
   - 右键点击 `getJointProject` → 选择 "删除"

2. **删除重复的收件人获取函数**
   - 右键点击 `getJointReceiver` → 选择 "删除"

### 步骤3：删除统计云函数（可选）

如果不需要统计功能：

1. **删除统计相关**
   - 右键点击 `getFahuiStats` → 选择 "删除"
   - 右键点击 `getAdminStats` → 选择 "删除"

### 步骤4：验证删除

删除后，检查云函数列表，确认以下云函数已被删除：
- ✅ `initDatabase`
- ✅ `initJointDatabase`
- ✅ `checkJointDatabase`
- ✅ `checkJointGoodsConfig`
- ✅ `checkJointReceiverConfig`
- ✅ `getJointProject`
- ✅ `getJointReceiver`
- ✅ `getFahuiStats`（可选）
- ✅ `getAdminStats`（可选）

## 删除后的操作

### 1. 重新上传通知系统云函数

删除无用云函数后，重新上传通知系统相关云函数：

1. 右键点击 `getUnreadNotificationCount` → 选择 "上传部署"
2. 右键点击 `getAdminNotifications` → 选择 "上传部署"
3. 右键点击 `markNotificationAsRead` → 选择 "上传部署"
4. 右键点击 `markAllNotificationsAsRead` → 选择 "上传部署"

### 2. 验证功能

上传完成后，测试以下功能：

1. **后台首页**：检查通知徽章是否正常显示
2. **通知管理**：检查通知管理页面是否正常工作
3. **合坛法会订单**：检查订单管理功能是否正常

## 注意事项

### 1. 删除前确认
- 确保要删除的云函数确实不再使用
- 可以先备份重要数据

### 2. 删除顺序
- 先删除测试和重复的云函数
- 再删除统计相关云函数（如果不需要）

### 3. 功能验证
- 删除后及时测试相关功能
- 如有问题可以重新上传被误删的云函数

## 如果仍有问题

如果删除后仍然无法上传，可以考虑：

### 方案2：联系扩容
发送邮件到 `service@dcloud.io`，提供：
- spaceID（服务空间ID）
- 扩容需求说明

### 方案3：优化云函数
- 合并功能相似的云函数
- 减少云函数数量，提高单个云函数的复用性

## 预防措施

### 1. 定期清理
- 定期检查并删除不再使用的云函数
- 避免创建重复功能的云函数

### 2. 合理规划
- 在开发前规划好云函数结构
- 避免创建过多测试云函数

### 3. 版本管理
- 使用版本控制管理云函数
- 及时清理测试版本 