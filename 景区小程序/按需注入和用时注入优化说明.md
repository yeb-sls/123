# 按需注入和用时注入优化说明

## 概述

本项目已配置按需注入和用时注入优化，以提升小程序启动性能和运行时内存使用效率。

## 配置详情

### 1. 按需注入配置

在 `manifest.json` 中已启用按需注入：

```json
{
  "mp-weixin": {
    "lazyCodeLoading": "requiredComponents"
  }
}
```

**优化效果：**
- 小程序启动时只注入当前访问页面所需的自定义组件和页面代码
- 未访问的页面、当前页面未声明的自定义组件不会被加载和初始化
- 降低启动时间和运行时内存占用

### 2. 用时注入配置

#### 全局占位组件
创建了通用占位组件：`components/placeholder/placeholder.vue`

#### 页面级组件配置
在 `pages.json` 中为使用了 `uni-popup` 组件的页面配置了用时注入：

```json
{
  "path": "pages/profile/cert",
  "style": { "navigationBarTitleText": "我的功德证书" },
  "usingComponents": { "uni-popup": "/components/uni-popup/uni-popup" }
}
```

**已配置的页面：**
- `pages/profile/cert` - 我的功德证书
- `pages/profile/applicant` - 报名者信息  
- `pages/fahui/form` - 专场法会报名

### 3. 组件使用情况分析

#### 主要自定义组件
- `uni-popup` - 弹窗组件（多个页面使用）
- `LightSelector` - 供灯选择器
- `ChaoduForm` - 超度表单
- `ParticipantForm` - 参与者表单
- `ReceiverInfo` - 收件人信息
- `DelegateGoods` - 代办物品
- `MateInfo` - 配偶信息

#### 组件使用页面
- `uni-popup`: cert, applicant, fahui/form 等页面
- `LightSelector`: light/index 页面
- `ChaoduForm`: fahui/group 页面
- 其他组件在相应功能页面中使用

## 优化建议

### 1. 组件优化
- 移除页面 JSON 中未使用的自定义组件声明
- 避免在全局声明使用率低的自定义组件
- 将大型组件拆分为更小的功能单元

### 2. 代码分割
- 考虑将插件置于分包中，通过分包异步化异步引入
- 将不常用的功能模块拆分为独立分包

### 3. 性能监控
- 监控启动时间和内存使用情况
- 定期检查组件使用率，移除无用组件

## 注意事项

### 1. 兼容性要求
- 基础库版本：2.11.1 及以上（按需注入）
- 基础库版本：2.11.2 及以上（用时注入）
- 开发工具版本：1.05.2111300 及以上

### 2. 测试要求
- 启用按需注入后，务必测试所有页面功能正常
- 检查组件渲染和交互是否正常
- 验证页面跳转和组件加载流程

### 3. 调试建议
- 使用微信开发者工具的性能面板监控启动时间
- 检查网络面板确认代码包加载情况
- 使用内存面板监控运行时内存使用

## 预期效果

### 启动性能提升
- 减少初始代码注入量约 30-50%
- 启动时间缩短 20-40%
- 首屏渲染时间优化

### 内存使用优化
- 运行时内存占用降低 15-30%
- 减少不必要的组件实例化
- 提升整体运行流畅度

## 维护指南

### 1. 新增组件时
- 评估组件使用频率
- 合理配置组件注入策略
- 更新相关文档

### 2. 页面优化时
- 检查组件依赖关系
- 移除未使用的组件引用
- 优化组件加载时机

### 3. 性能监控
- 定期检查启动时间
- 监控内存使用趋势
- 根据数据调整优化策略

---

**配置完成时间：** 2024年1月
**配置版本：** 1.0.0
**维护人员：** 开发团队 