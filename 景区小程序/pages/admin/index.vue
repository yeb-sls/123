<template>
  <view class="admin-container">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <view class="header">
      <view class="header-content">
        <view class="header-left">
          <text class="logo">ğŸ›ï¸</text>
          <view class="title-group">
            <text class="main-title">æ™¯åŒºç®¡ç†ç³»ç»Ÿ</text>
            <text class="sub-title">Scenic Area Management</text>
          </view>
        </view>
        <view class="header-right">
          <view class="time-display">
            <text class="time">{{ currentTime }}</text>
            <text class="date">{{ currentDate }}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ•°æ®æ¦‚è§ˆå¡ç‰‡ -->
    <view class="overview-section">
      <view class="overview-grid">
        <view class="overview-card primary">
          <view class="card-icon">ğŸ‘¥</view>
          <view class="card-content">
            <text class="card-number">{{ stats.totalUsers || 0 }}</text>
            <text class="card-label">æ€»ç”¨æˆ·æ•°</text>
          </view>
          <view class="card-trend">
            <text class="trend-icon">â†—</text>
            <text class="trend-text">+12%</text>
          </view>
        </view>
        
        <view class="overview-card success">
          <view class="card-icon">ğŸ“‹</view>
          <view class="card-content">
            <text class="card-number">{{ stats.totalOrders || 0 }}</text>
            <text class="card-label">æ€»è®¢å•æ•°</text>
          </view>
          <view class="card-trend">
            <text class="trend-icon">â†—</text>
            <text class="trend-text">+8%</text>
          </view>
        </view>
        
        <view class="overview-card warning">
          <view class="card-icon">ğŸ’°</view>
          <view class="card-content">
            <text class="card-number">Â¥{{ stats.totalRevenue || 0 }}</text>
            <text class="card-label">æ€»æ”¶å…¥</text>
          </view>
          <view class="card-trend">
            <text class="trend-icon">â†—</text>
            <text class="trend-text">+15%</text>
          </view>
        </view>
        
        <view class="overview-card info">
          <view class="card-icon">ğŸ“Š</view>
          <view class="card-content">
            <text class="card-number">{{ stats.todayOrders || 0 }}</text>
            <text class="card-label">ä»Šæ—¥è®¢å•</text>
          </view>
          <view class="card-trend">
            <text class="trend-icon">â†—</text>
            <text class="trend-text">+5%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠŸèƒ½æ¨¡å— -->
    <view class="modules-section">
      <view class="section-header">
        <text class="section-title">åŠŸèƒ½æ¨¡å—</text>
        <text class="section-subtitle">å¿«é€Ÿè®¿é—®å„é¡¹ç®¡ç†åŠŸèƒ½</text>
      </view>
      
      <view class="modules-grid">
        <!-- é¦–é¡µç®¡ç† -->
        <view class="module-group">
          <view class="group-header">
            <text class="group-icon">ğŸ </text>
            <text class="group-title">é¦–é¡µç®¡ç†</text>
          </view>
          <view class="group-items">
            <view class="module-item" @click="goToPage('/pages/admin/home/banner')">
              <view class="item-icon">ğŸ–¼ï¸</view>
              <text class="item-name">è½®æ’­å›¾</text>
            </view>
            <view class="module-item" @click="goToPage('/pages/admin/home/nav')">
              <view class="item-icon">ğŸ”—</view>
              <text class="item-name">å¯¼èˆª</text>
            </view>
            <view class="module-item" @click="goToPage('/pages/admin/home/intro')">
              <view class="item-icon">ğŸ“</view>
              <text class="item-name">ä»‹ç»</text>
            </view>
          </view>
        </view>

        <!-- ä¸“åœºæ³•ä¼šç®¡ç† -->
        <view class="module-group">
          <view class="group-header">
            <text class="group-icon">ğŸ•‰ï¸</text>
            <text class="group-title">ä¸“åœºæ³•ä¼šç®¡ç†</text>
          </view>
          <view class="group-items">
            <view class="module-item" @click="goToPage('/pages/admin/fahui/special/index')">
              <view class="item-icon">ğŸ </view>
              <text class="item-name">ç®¡ç†é¦–é¡µ</text>
            </view>
            <view class="module-item" @click="goToPage('/pages/admin/fahui/projects')">
              <view class="item-icon">ğŸ“…</view>
              <text class="item-name">é¡¹ç›®ç®¡ç†</text>
            </view>
            <view class="module-item" @click="goToPage('/pages/admin/fahui/orders')">
              <view class="item-icon">ğŸ“‹</view>
              <text class="item-name">è®¢å•ç®¡ç†</text>
            </view>
          </view>
        </view>

        <!-- åˆå›æ³•ä¼šç®¡ç† -->
        <view class="module-group">
          <view class="group-header">
            <text class="group-icon">ğŸ™</text>
            <text class="group-title">åˆå›æ³•ä¼šç®¡ç†</text>
          </view>
          <view class="group-items">
            <view class="module-item" @click="goToPage('/pages/admin/joint/index')">
              <view class="item-icon">ğŸ </view>
              <text class="item-name">ç®¡ç†é¦–é¡µ</text>
            </view>
            <view class="module-item" @click="goToPage('/pages/admin/joint/projects')">
              <view class="item-icon">ğŸ“…</view>
              <text class="item-name">é¡¹ç›®ç®¡ç†</text>
            </view>
            <view class="module-item" @click="goToPage('/pages/admin/joint/orders')">
              <view class="item-icon">ğŸ“‹</view>
              <text class="item-name">è®¢å•ç®¡ç†</text>
            </view>
          </view>
        </view>

        <!-- ä¾›ç¯ç®¡ç† -->
        <view class="module-group">
          <view class="group-header">
            <text class="group-icon">ğŸ’¡</text>
            <text class="group-title">ä¾›ç¯ç®¡ç†</text>
          </view>
          <view class="group-items">
            <view class="module-item" @click="goToPage('/pages/admin/light/config')">
              <view class="item-icon">âš™ï¸</view>
              <text class="item-name">é…ç½®</text>
            </view>
            <view class="module-item" @click="goToPage('/pages/admin/light/orders')">
              <view class="item-icon">ğŸ“Š</view>
              <text class="item-name">è®¢å•</text>
            </view>
          </view>
        </view>

        <!-- æ®¿å ‚ä¾›å“ -->
        <view class="module-group">
          <view class="group-header">
            <text class="group-icon">ğŸ›ï¸</text>
            <text class="group-title">æ®¿å ‚ä¾›å“</text>
          </view>
          <view class="group-items">
            <view class="module-item" @click="goToPage('/pages/admin/hall/config')">
              <view class="item-icon">ğŸ›ï¸</view>
              <text class="item-name">é…ç½®</text>
            </view>
            <view class="module-item" @click="goToPage('/pages/admin/hall/orders')">
              <view class="item-icon">ğŸ“¦</view>
              <text class="item-name">è®¢å•</text>
            </view>
          </view>
        </view>

        <!-- åŠŸå¾·å¸ƒæ–½ -->
        <view class="module-group">
          <view class="group-header">
            <text class="group-icon">ğŸ’°</text>
            <text class="group-title">åŠŸå¾·å¸ƒæ–½</text>
          </view>
          <view class="group-items">
            <view class="module-item" @click="goToPage('/pages/admin/gongde/config')">
              <view class="item-icon">ğŸ¯</view>
              <text class="item-name">é…ç½®</text>
            </view>
            <view class="module-item" @click="goToPage('/pages/admin/gongde/orders')">
              <view class="item-icon">ğŸ“ˆ</view>
              <text class="item-name">è®°å½•</text>
            </view>
          </view>
        </view>

        <!-- ç³»ç»Ÿé€šçŸ¥ -->
        <view class="module-group">
          <view class="group-header">
            <text class="group-icon">ğŸ””</text>
            <text class="group-title">ç³»ç»Ÿé€šçŸ¥</text>
            <view v-if="unreadCount > 0" class="notification-badge">{{ unreadCount }}</view>
          </view>
          <view class="group-items">
            <view class="module-item" @click="goToPage('/pages/admin/notifications')">
              <view class="item-icon">ğŸ“¢</view>
              <text class="item-name">é€šçŸ¥ç®¡ç†</text>
            </view>
          </view>
        </view>

        <!-- æ´»åŠ¨ç®¡ç† -->
        <view class="module-group">
          <view class="group-header">
            <text class="group-icon">ğŸ¯</text>
            <text class="group-title">æ´»åŠ¨ç®¡ç†</text>
          </view>
          <view class="group-items">
            <view class="module-item" @click="goToPage('/pages/admin/activity/config')">
              <view class="item-icon">ğŸ“…</view>
              <text class="item-name">é…ç½®</text>
            </view>
            <view class="module-item" @click="goToPage('/pages/admin/activity/orders')">
              <view class="item-icon">ğŸ‘¥</view>
              <text class="item-name">æŠ¥å</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¿«æ·æ“ä½œ -->
    <view class="quick-actions">
      <view class="section-header">
        <text class="section-title">å¿«æ·æ“ä½œ</text>
        <text class="section-subtitle">å¸¸ç”¨åŠŸèƒ½å¿«é€Ÿè®¿é—®</text>
      </view>
      
      <view class="actions-grid">
        <view class="action-item" @click="refreshData">
          <view class="action-icon">ğŸ”„</view>
          <text class="action-name">åˆ·æ–°æ•°æ®</text>
        </view>
        <view class="action-item" @click="exportData">
          <view class="action-icon">ğŸ“¤</view>
          <text class="action-name">å¯¼å‡ºæ•°æ®</text>
        </view>
        <view class="action-item" @click="backupSystem">
          <view class="action-icon">ğŸ’¾</view>
          <text class="action-name">ç³»ç»Ÿå¤‡ä»½</text>
        </view>
        <view class="action-item" @click="systemSettings">
          <view class="action-icon">âš™ï¸</view>
          <text class="action-name">ç³»ç»Ÿè®¾ç½®</text>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
// å¯¼å…¥äº‘å¯¹è±¡
const commonManagement = uniCloud.importObject('common-management')
const notificationSystem = uniCloud.importObject('notification-system')

export default {
  data() {
    return {
      stats: {
        totalUsers: 0,
        totalOrders: 0,
        totalRevenue: 0,
        todayOrders: 0
      },
      currentTime: '',
      currentDate: '',
      unreadCount: 0
    }
  },
  onLoad() {
    this.loadStats()
    this.loadUnreadCount()
    this.updateTime()
    // æ¯åˆ†é’Ÿæ›´æ–°æ—¶é—´
    setInterval(this.updateTime, 60000)
  },
  methods: {
    // è·³è½¬åˆ°æŒ‡å®šé¡µé¢
    goToPage(url) {
      uni.navigateTo({
        url,
        success: () => {
          console.log('è·³è½¬æˆåŠŸ:', url)
        },
        fail: (err) => {
          console.error('è·³è½¬å¤±è´¥:', err)
          uni.showToast({
            title: 'é¡µé¢è·³è½¬å¤±è´¥',
            icon: 'none'
          })
        }
      })
    },

    // åŠ è½½ç»Ÿè®¡æ•°æ®
    async loadStats() {
      try {
        const result = await commonManagement.getAdminStats()
        this.stats = result.success && result.data ? result.data : {}
      } catch (error) {
        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error)
      }
    },

    // åŠ è½½æœªè¯»é€šçŸ¥æ•°é‡
    async loadUnreadCount() {
      try {
        const result = await notificationSystem.getUnreadCount()
        if (result.success) {
          this.unreadCount = result.count || 0
        }
      } catch (error) {
        console.error('åŠ è½½æœªè¯»é€šçŸ¥æ•°é‡å¤±è´¥:', error)
      }
    },

    // æ›´æ–°æ—¶é—´
    updateTime() {
      const now = new Date()
      this.currentTime = now.toLocaleTimeString('zh-CN', { 
        hour12: false,
        hour: '2-digit',
        minute: '2-digit'
      })
      this.currentDate = now.toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit'
      })
    },

    // åˆ·æ–°æ•°æ®
    refreshData() {
      this.loadStats()
      uni.showToast({
        title: 'æ•°æ®å·²åˆ·æ–°',
        icon: 'success'
      })
    },

    // å¯¼å‡ºæ•°æ®
    exportData() {
      uni.showToast({
        title: 'å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­',
        icon: 'none'
      })
    },

    // ç³»ç»Ÿå¤‡ä»½
    backupSystem() {
      uni.showToast({
        title: 'å¤‡ä»½åŠŸèƒ½å¼€å‘ä¸­',
        icon: 'none'
      })
    },

    // ç³»ç»Ÿè®¾ç½®
    systemSettings() {
      uni.showToast({
        title: 'è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­',
        icon: 'none'
      })
    }
  }
}
</script>

<style scoped>
.admin-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 0;
}

/* é¡¶éƒ¨å¯¼èˆªæ  */
.header {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20rpx);
  padding: 40rpx 30rpx 30rpx 30rpx;
  border-bottom: 1rpx solid rgba(255, 255, 255, 0.2);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 20rpx;
}

.logo {
  font-size: 48rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.title-group {
  display: flex;
  flex-direction: column;
}

.main-title {
  font-size: 36rpx;
  font-weight: bold;
  color: #333;
  line-height: 1.2;
}

.sub-title {
  font-size: 24rpx;
  color: #666;
  font-weight: 300;
}

.header-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

.time-display {
  text-align: right;
}

.time {
  font-size: 32rpx;
  font-weight: bold;
  color: #333;
  display: block;
}

.date {
  font-size: 24rpx;
  color: #666;
  display: block;
}

/* æ•°æ®æ¦‚è§ˆ */
.overview-section {
  padding: 30rpx;
}

.overview-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20rpx;
}

.overview-card {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20rpx);
  border-radius: 20rpx;
  padding: 30rpx;
  display: flex;
  align-items: center;
  gap: 20rpx;
  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.1);
  border: 1rpx solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
}

.overview-card:active {
  transform: translateY(-4rpx);
  box-shadow: 0 12rpx 40rpx rgba(0, 0, 0, 0.15);
}

.card-icon {
  font-size: 48rpx;
  width: 80rpx;
  height: 80rpx;
  border-radius: 20rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.8);
}

.overview-card.primary .card-icon {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.overview-card.success .card-icon {
  background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
  color: white;
}

.overview-card.warning .card-icon {
  background: linear-gradient(135deg, #ff9500 0%, #ff6b35 100%);
  color: white;
}

.overview-card.info .card-icon {
  background: linear-gradient(135deg, #007aff 0%, #5ac8fa 100%);
  color: white;
}

.card-content {
  flex: 1;
}

.card-number {
  font-size: 36rpx;
  font-weight: bold;
  color: #333;
  display: block;
  margin-bottom: 8rpx;
}

.card-label {
  font-size: 24rpx;
  color: #666;
  display: block;
}

.card-trend {
  display: flex;
  align-items: center;
  gap: 8rpx;
}

.trend-icon {
  font-size: 24rpx;
  color: #34c759;
}

.trend-text {
  font-size: 22rpx;
  color: #34c759;
  font-weight: 500;
}

/* åŠŸèƒ½æ¨¡å— */
.modules-section {
  padding: 0 30rpx 30rpx 30rpx;
}

.section-header {
  margin-bottom: 30rpx;
}

.section-title {
  font-size: 32rpx;
  font-weight: bold;
  color: white;
  display: block;
  margin-bottom: 8rpx;
}

.section-subtitle {
  font-size: 24rpx;
  color: rgba(255, 255, 255, 0.8);
  display: block;
}

.modules-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20rpx;
}

.module-group {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20rpx);
  border-radius: 20rpx;
  padding: 30rpx;
  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.1);
  border: 1rpx solid rgba(255, 255, 255, 0.2);
}

.group-header {
  display: flex;
  align-items: center;
  gap: 15rpx;
  margin-bottom: 25rpx;
  position: relative;
}

.group-icon {
  font-size: 32rpx;
  width: 60rpx;
  height: 60rpx;
  border-radius: 15rpx;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
}

.group-title {
  font-size: 28rpx;
  font-weight: bold;
  color: #333;
}

.notification-badge {
  position: absolute;
  top: -8rpx;
  right: -8rpx;
  background: #ff3b30;
  color: white;
  font-size: 20rpx;
  font-weight: bold;
  min-width: 32rpx;
  height: 32rpx;
  border-radius: 16rpx;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 8rpx;
  box-shadow: 0 2rpx 8rpx rgba(255, 59, 48, 0.3);
}

.group-items {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15rpx;
}

.module-item {
  background: rgba(255, 255, 255, 0.8);
  border-radius: 15rpx;
  padding: 20rpx 15rpx;
  text-align: center;
  transition: all 0.3s ease;
  border: 1rpx solid rgba(0, 0, 0, 0.05);
}

.module-item:active {
  transform: scale(0.95);
  background: rgba(255, 255, 255, 0.9);
  box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);
}

.item-icon {
  font-size: 32rpx;
  margin-bottom: 10rpx;
  display: block;
}

.item-name {
  font-size: 22rpx;
  color: #333;
  font-weight: 500;
  display: block;
}

/* å¿«æ·æ“ä½œ */
.quick-actions {
  padding: 0 30rpx 40rpx 30rpx;
}

.actions-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20rpx;
}

.action-item {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20rpx);
  border-radius: 20rpx;
  padding: 30rpx 20rpx;
  text-align: center;
  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.1);
  border: 1rpx solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
}

.action-item:active {
  transform: translateY(-4rpx);
  box-shadow: 0 12rpx 40rpx rgba(0, 0, 0, 0.15);
}

.action-icon {
  font-size: 40rpx;
  margin-bottom: 15rpx;
  display: block;
}

.action-name {
  font-size: 24rpx;
  color: #333;
  font-weight: 500;
  display: block;
}
</style> 