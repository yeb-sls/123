<view class="group-bg data-v-bbd8ae30"><view class="group-container data-v-bbd8ae30"><block wx:if="{{$root.g0>0}}"><image class="group-banner data-v-bbd8ae30" src="{{banners[0]}}" mode="aspectFill"></image></block><block wx:if="{{$root.g2>0}}"><view class="intro-section data-v-bbd8ae30"><view class="intro-title data-v-bbd8ae30">合坛法会介绍</view><block wx:for="{{intros}}" wx:for-item="intro" wx:for-index="index"><view class="intro-block data-v-bbd8ae30"><view class="intro-content data-v-bbd8ae30" style="{{'color:'+(intro.textColor)+';'}}">{{''+intro.content+''}}</view><block wx:if="{{intro.bgImage}}"><image class="intro-bg data-v-bbd8ae30" src="{{intro.bgImage}}" mode="aspectFill"></image></block></view></block></view></block><view class="section data-v-bbd8ae30"><view class="section-title data-v-bbd8ae30"><text class="icon data-v-bbd8ae30">🕯️</text>法会项目<text class="section-tip data-v-bbd8ae30">（必选）</text></view><view class="project-list data-v-bbd8ae30"><block wx:for="{{fahuiProjects}}" wx:for-item="project" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectProject',[index]]]]]}}" class="project-item data-v-bbd8ae30" bindtap="__e"><view class="project-info data-v-bbd8ae30"><text class="project-name data-v-bbd8ae30">{{project.name}}</text><text class="project-desc data-v-bbd8ae30">{{project.description}}</text><text class="project-price data-v-bbd8ae30">{{"¥"+project.price+"/人"}}</text></view><view class="{{['project-status','data-v-bbd8ae30',(selectedProjectIndex===index)?'active':'']}}"><text class="status-icon data-v-bbd8ae30">{{selectedProjectIndex===index?'✓':'○'}}</text></view></view></block></view></view><block wx:if="{{selectedProjectIndex>=0}}"><view class="section data-v-bbd8ae30"><view class="section-title data-v-bbd8ae30"><text class="icon data-v-bbd8ae30">📅</text>法会日期<text class="section-tip data-v-bbd8ae30">（必选）</text></view><view class="date-list data-v-bbd8ae30"><block wx:for="{{$root.l0}}" wx:for-item="date" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectDate',[index]]]]]}}" class="date-item data-v-bbd8ae30" bindtap="__e"><view class="date-info data-v-bbd8ae30"><text class="date-text data-v-bbd8ae30">{{date.m0}}</text><text class="date-desc data-v-bbd8ae30">{{date.m1}}</text></view><view class="{{['date-status','data-v-bbd8ae30',(selectedDateIndex===index)?'active':'']}}"><text class="status-icon data-v-bbd8ae30">{{selectedDateIndex===index?'✓':'○'}}</text></view></view></block></view></view></block><view class="section data-v-bbd8ae30"><view class="section-title data-v-bbd8ae30"><text class="icon data-v-bbd8ae30">👥</text>报名人信息<text class="section-tip data-v-bbd8ae30">（最多5人，每人信息需完整）</text></view><view class="applicant-list data-v-bbd8ae30"><block wx:for="{{$root.l1}}" wx:for-item="applicant" wx:for-index="index" wx:key="index"><view class="applicant-card data-v-bbd8ae30"><view class="applicant-header data-v-bbd8ae30"><text class="applicant-title data-v-bbd8ae30">{{"报名人 "+(index+1)}}</text><block wx:if="{{$root.g3>1}}"><button data-event-opts="{{[['tap',[['removeApplicant',[index]]]]]}}" class="remove-btn data-v-bbd8ae30" bindtap="__e">删除</button></block></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">姓名<text class="required data-v-bbd8ae30">*</text></text><input class="form-input data-v-bbd8ae30" placeholder="请输入姓名" maxlength="10" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],[[['applicants','',index]]]]]]]}}" value="{{applicant.$orig.name}}" bindinput="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">性别<text class="required data-v-bbd8ae30">*</text></text><picker range="{{genderOptions}}" value="{{applicant.g4}}" data-event-opts="{{[['change',[['onGenderChange',[index,'$event']]]]]}}" bindchange="__e" class="data-v-bbd8ae30"><view class="picker data-v-bbd8ae30"><text class="picker-value data-v-bbd8ae30">{{applicant.$orig.gender||'请选择性别'}}</text><text class="picker-arrow data-v-bbd8ae30">▼</text></view></picker></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">联系电话<text class="required data-v-bbd8ae30">*</text></text><input class="form-input data-v-bbd8ae30" placeholder="请输入联系电话" type="tel" maxlength="11" data-event-opts="{{[['input',[['__set_model',['$0','phone','$event',[]],[[['applicants','',index]]]]]]]}}" value="{{applicant.$orig.phone}}" bindinput="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">身份证号<text class="required data-v-bbd8ae30">*</text></text><input class="form-input data-v-bbd8ae30" placeholder="请输入身份证号" maxlength="18" data-event-opts="{{[['input',[['__set_model',['$0','idCard','$event',[]],[[['applicants','',index]]]]]]]}}" value="{{applicant.$orig.idCard}}" bindinput="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">农历生日</text><picker mode="date" value="{{applicant.$orig.lunarBirthday}}" data-event-opts="{{[['change',[['onBirthdayChange',[index,'$event']]]]]}}" bindchange="__e" class="data-v-bbd8ae30"><view class="picker data-v-bbd8ae30"><text class="picker-value data-v-bbd8ae30">{{applicant.$orig.lunarBirthday||'请选择农历生日'}}</text><text class="picker-arrow data-v-bbd8ae30">▼</text></view></picker></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">出生时辰</text><picker range="{{birthTimeOptions}}" value="{{applicant.g5}}" data-event-opts="{{[['change',[['onBirthTimeChange',[index,'$event']]]]]}}" bindchange="__e" class="data-v-bbd8ae30"><view class="picker data-v-bbd8ae30"><text class="picker-value data-v-bbd8ae30">{{applicant.$orig.birthTime||'请选择出生时辰'}}</text><text class="picker-arrow data-v-bbd8ae30">▼</text></view></picker></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">常住地址</text><input class="form-input data-v-bbd8ae30" placeholder="请输入常住地址" data-event-opts="{{[['input',[['__set_model',['$0','address','$event',[]],[[['applicants','',index]]]]]]]}}" value="{{applicant.$orig.address}}" bindinput="__e"/></view></view></block></view><block wx:if="{{$root.g6<5}}"><button data-event-opts="{{[['tap',[['addApplicant',['$event']]]]]}}" class="add-btn data-v-bbd8ae30" bindtap="__e"><text class="add-icon data-v-bbd8ae30">+</text><text class="add-text data-v-bbd8ae30">添加报名人</text></button></block></view><block wx:if="{{selectedProjectIndex>=0&&fahuiProjects[selectedProjectIndex]&&fahuiProjects[selectedProjectIndex].category==='姻缘和合'}}"><view class="section data-v-bbd8ae30"><view class="section-title data-v-bbd8ae30"><text class="icon data-v-bbd8ae30">💕</text>配偶信息<text class="section-tip data-v-bbd8ae30">（选填）</text></view><view class="spouse-form data-v-bbd8ae30"><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">配偶姓名</text><input class="form-input data-v-bbd8ae30" placeholder="请输入配偶姓名" maxlength="10" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['spouse']]]]]}}" value="{{spouse.name}}" bindinput="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">性别</text><picker range="{{genderOptions}}" value="{{$root.g7}}" data-event-opts="{{[['change',[['onSpouseGenderChange',['$event']]]]]}}" bindchange="__e" class="data-v-bbd8ae30"><view class="picker data-v-bbd8ae30"><text class="picker-value data-v-bbd8ae30">{{spouse.gender||'请选择性别'}}</text><text class="picker-arrow data-v-bbd8ae30">▼</text></view></picker></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">联系电话</text><input class="form-input data-v-bbd8ae30" placeholder="请输入联系电话" type="tel" maxlength="11" data-event-opts="{{[['input',[['__set_model',['$0','phone','$event',[]],['spouse']]]]]}}" value="{{spouse.phone}}" bindinput="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">农历生日</text><picker mode="date" value="{{spouse.lunarBirthday}}" data-event-opts="{{[['change',[['onSpouseBirthdayChange',['$event']]]]]}}" bindchange="__e" class="data-v-bbd8ae30"><view class="picker data-v-bbd8ae30"><text class="picker-value data-v-bbd8ae30">{{spouse.lunarBirthday||'请选择农历生日'}}</text><text class="picker-arrow data-v-bbd8ae30">▼</text></view></picker></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">出生时辰</text><picker range="{{birthTimeOptions}}" value="{{$root.g8}}" data-event-opts="{{[['change',[['onSpouseBirthTimeChange',['$event']]]]]}}" bindchange="__e" class="data-v-bbd8ae30"><view class="picker data-v-bbd8ae30"><text class="picker-value data-v-bbd8ae30">{{spouse.birthTime||'请选择出生时辰'}}</text><text class="picker-arrow data-v-bbd8ae30">▼</text></view></picker></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">常住地址</text><input class="form-input data-v-bbd8ae30" placeholder="请输入常住地址" data-event-opts="{{[['input',[['__set_model',['$0','address','$event',[]],['spouse']]]]]}}" value="{{spouse.address}}" bindinput="__e"/></view></view></view></block><block wx:if="{{selectedProjectIndex>=0&&fahuiProjects[selectedProjectIndex]&&fahuiProjects[selectedProjectIndex].category==='超度法会'}}"><view class="section data-v-bbd8ae30"><view class="section-title data-v-bbd8ae30"><text class="icon data-v-bbd8ae30">🕯️</text>超度信息<text class="section-tip data-v-bbd8ae30">（必填）</text></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">超度类型<text class="required data-v-bbd8ae30">*</text></text><picker range="{{chaoduTypes}}" value="{{$root.g9}}" data-event-opts="{{[['change',[['onChaoduTypeChange',['$event']]]]]}}" bindchange="__e" class="data-v-bbd8ae30"><view class="picker data-v-bbd8ae30"><text class="picker-value data-v-bbd8ae30">{{chaoduType||'请选择超度类型'}}</text><text class="picker-arrow data-v-bbd8ae30">▼</text></view></picker></view><view class="deceased-list data-v-bbd8ae30"><block wx:for="{{$root.l2}}" wx:for-item="deceased" wx:for-index="index" wx:key="index"><view class="deceased-card data-v-bbd8ae30"><view class="deceased-header data-v-bbd8ae30"><text class="deceased-title data-v-bbd8ae30">{{"已故亲人 "+(index+1)}}</text><block wx:if="{{deceased.g10>1}}"><button data-event-opts="{{[['tap',[['removeDeceased',[index]]]]]}}" class="remove-btn data-v-bbd8ae30" bindtap="__e">删除</button></block></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">姓名<text class="required data-v-bbd8ae30">*</text></text><input class="form-input data-v-bbd8ae30" placeholder="请输入姓名" maxlength="10" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],[[['deceasedList','',index]]]]]]]}}" value="{{deceased.$orig.name}}" bindinput="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">关系<text class="required data-v-bbd8ae30">*</text></text><picker range="{{relationOptions}}" value="{{deceased.g11}}" data-event-opts="{{[['change',[['onRelationChange',[index,'$event']]]]]}}" bindchange="__e" class="data-v-bbd8ae30"><view class="picker data-v-bbd8ae30"><text class="picker-value data-v-bbd8ae30">{{deceased.$orig.relation||'请选择关系'}}</text><text class="picker-arrow data-v-bbd8ae30">▼</text></view></picker></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">出生农历</text><picker mode="date" value="{{deceased.$orig.lunarBirthday}}" data-event-opts="{{[['change',[['onDeceasedBirthdayChange',[index,'$event']]]]]}}" bindchange="__e" class="data-v-bbd8ae30"><view class="picker data-v-bbd8ae30"><text class="picker-value data-v-bbd8ae30">{{deceased.$orig.lunarBirthday||'请选择出生农历'}}</text><text class="picker-arrow data-v-bbd8ae30">▼</text></view></picker></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">去世农历</text><picker mode="date" value="{{deceased.$orig.deathDate}}" data-event-opts="{{[['change',[['onDeceasedDeathChange',[index,'$event']]]]]}}" bindchange="__e" class="data-v-bbd8ae30"><view class="picker data-v-bbd8ae30"><text class="picker-value data-v-bbd8ae30">{{deceased.$orig.deathDate||'请选择去世农历'}}</text><text class="picker-arrow data-v-bbd8ae30">▼</text></view></picker></view></view></block><block wx:if="{{$root.g12<3}}"><button data-event-opts="{{[['tap',[['addDeceased',['$event']]]]]}}" class="add-btn data-v-bbd8ae30" bindtap="__e"><text class="add-icon data-v-bbd8ae30">+</text><text class="add-text data-v-bbd8ae30">添加已故亲人</text></button></block></view></view></block><block wx:if="{{$root.g13>0}}"><view class="section data-v-bbd8ae30"><view class="section-title data-v-bbd8ae30"><text class="icon data-v-bbd8ae30">🛍️</text>代办物品<text class="section-tip data-v-bbd8ae30">（可选）</text></view><view class="goods-list data-v-bbd8ae30"><block wx:for="{{$root.l3}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="goods-item data-v-bbd8ae30"><view class="goods-header data-v-bbd8ae30"><text class="goods-title data-v-bbd8ae30">{{"物品 "+(index+1)}}</text><block wx:if="{{item.g14>1}}"><button data-event-opts="{{[['tap',[['removeGoods',[index]]]]]}}" class="remove-btn data-v-bbd8ae30" bindtap="__e">删除</button></block></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">物品名称<text class="required data-v-bbd8ae30">*</text></text><input class="form-input data-v-bbd8ae30" placeholder="请输入物品名称" maxlength="20" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],[[['goods','',index]]]]]]]}}" value="{{item.$orig.name}}" bindinput="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">数量<text class="required data-v-bbd8ae30">*</text></text><input class="form-input data-v-bbd8ae30" placeholder="请输入数量" type="number" min="1" data-event-opts="{{[['input',[['__set_model',['$0','qty','$event',['number']],[[['goods','',index]]]]]],['blur',[['$forceUpdate']]]]}}" value="{{item.$orig.qty}}" bindinput="__e" bindblur="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">单价<text class="required data-v-bbd8ae30">*</text></text><input class="form-input data-v-bbd8ae30" placeholder="请输入单价" type="number" min="1" data-event-opts="{{[['input',[['__set_model',['$0','price','$event',['number']],[[['goods','',index]]]]]],['blur',[['$forceUpdate']]]]}}" value="{{item.$orig.price}}" bindinput="__e" bindblur="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">备注</text><input class="form-input data-v-bbd8ae30" placeholder="请输入备注信息" maxlength="50" data-event-opts="{{[['input',[['__set_model',['$0','remark','$event',[]],[[['goods','',index]]]]]]]}}" value="{{item.$orig.remark}}" bindinput="__e"/></view></view></block><block wx:if="{{$root.g15<5}}"><button data-event-opts="{{[['tap',[['addGoods',['$event']]]]]}}" class="add-btn data-v-bbd8ae30" bindtap="__e"><text class="add-icon data-v-bbd8ae30">+</text><text class="add-text data-v-bbd8ae30">添加物品</text></button></block></view></view></block><block wx:if="{{showReceiver}}"><view class="section data-v-bbd8ae30"><view class="section-title data-v-bbd8ae30"><text class="icon data-v-bbd8ae30">📦</text>收件信息<text class="section-tip data-v-bbd8ae30">（可选）</text></view><view class="receiver-form data-v-bbd8ae30"><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">收件人</text><input class="form-input data-v-bbd8ae30" placeholder="请输入收件人姓名" maxlength="10" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['receiver']]]]]}}" value="{{receiver.name}}" bindinput="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">联系电话</text><input class="form-input data-v-bbd8ae30" placeholder="请输入联系电话" type="tel" maxlength="11" data-event-opts="{{[['input',[['__set_model',['$0','phone','$event',[]],['receiver']]]]]}}" value="{{receiver.phone}}" bindinput="__e"/></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">收件地址</text><textarea class="form-textarea data-v-bbd8ae30" placeholder="请输入详细收件地址" maxlength="100" data-event-opts="{{[['input',[['__set_model',['$0','address','$event',[]],['receiver']]]]]}}" value="{{receiver.address}}" bindinput="__e"></textarea></view><view class="form-group data-v-bbd8ae30"><text class="form-label data-v-bbd8ae30">备注信息</text><input class="form-input data-v-bbd8ae30" placeholder="请输入备注信息" maxlength="50" data-event-opts="{{[['input',[['__set_model',['$0','remark','$event',[]],['receiver']]]]]}}" value="{{receiver.remark}}" bindinput="__e"/></view></view></view></block><view class="section data-v-bbd8ae30"><view class="section-title data-v-bbd8ae30"><text class="icon data-v-bbd8ae30">💰</text>费用预览</view><view class="cost-card data-v-bbd8ae30"><view class="cost-item data-v-bbd8ae30"><text class="cost-label data-v-bbd8ae30">法会费用</text><text class="cost-value data-v-bbd8ae30">{{"¥"+fahuiCost}}</text></view><block wx:if="{{goodsCost>0}}"><view class="cost-item data-v-bbd8ae30"><text class="cost-label data-v-bbd8ae30">代办费用</text><text class="cost-value data-v-bbd8ae30">{{"¥"+goodsCost}}</text></view></block><view class="cost-item total data-v-bbd8ae30"><text class="cost-label data-v-bbd8ae30">总计</text><text class="cost-value total-price data-v-bbd8ae30">{{"¥"+totalCost}}</text></view></view></view><view class="btn-group data-v-bbd8ae30"><button class="submit-btn data-v-bbd8ae30" type="primary" loading="{{submitting}}" data-event-opts="{{[['tap',[['submitForm',['$event']]]]]}}" bindtap="__e"><block wx:if="{{!submitting}}"><text class="data-v-bbd8ae30">提交报名</text></block><block wx:else><text class="data-v-bbd8ae30">提交中...</text></block></button><button data-event-opts="{{[['tap',[['resetForm',['$event']]]]]}}" class="reset-btn data-v-bbd8ae30" bindtap="__e">重置表单</button></view></view></view>