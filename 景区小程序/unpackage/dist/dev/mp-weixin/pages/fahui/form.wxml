<view class="form-bg data-v-af3e902a"><block wx:if="{{isLoading}}"><view class="loading-container data-v-af3e902a"><view class="loading-spinner data-v-af3e902a"></view><text class="loading-text data-v-af3e902a">加载中...</text></view></block><block wx:else><view class="form-container data-v-af3e902a"><view class="form-title data-v-af3e902a">专场法会报名</view><view class="form-help data-v-af3e902a"><text class="data-v-af3e902a">📝 请仔细填写所有必填信息，确保信息准确完整</text><text class="data-v-af3e902a">👥 可添加最多5位报名人，每人信息需完整</text><text class="data-v-af3e902a">💝 不同法会类型有特殊要求，请按提示填写</text><text class="data-v-af3e902a">💾 数据会自动保存，可随时返回继续填写</text></view><view class="section-title data-v-af3e902a">报名人信息<text class="section-tip data-v-af3e902a">（最多5人，每人信息需完整）</text></view><view class="section-tip-full data-v-af3e902a">点击"编辑"按钮可修改报名人信息</view><view class="applicant-list data-v-af3e902a"><block wx:for="{{$root.l0}}" wx:for-item="applicant" wx:for-index="idx" wx:key="idx"><view class="applicant-card data-v-af3e902a"><view class="applicant-header data-v-af3e902a"><text class="applicant-name data-v-af3e902a">{{applicant.$orig.name||'未填写'}}</text><view class="applicant-actions data-v-af3e902a"><button class="mini-btn data-v-af3e902a" size="mini" data-event-opts="{{[['tap',[['openApplicantDialog',[idx]]]]]}}" bindtap="__e">编辑</button><block wx:if="{{applicant.g0>1}}"><button class="mini-btn danger data-v-af3e902a" size="mini" data-event-opts="{{[['tap',[['removeApplicant',[idx]]]]]}}" bindtap="__e">删除</button></block></view></view><view class="applicant-info-row data-v-af3e902a"><text class="data-v-af3e902a">性别：</text><text class="info-value data-v-af3e902a">{{applicant.$orig.gender||'未选'}}</text><text class="data-v-af3e902a">电话：</text><text class="info-value data-v-af3e902a">{{applicant.$orig.phone||'未填'}}</text></view><view class="applicant-info-row data-v-af3e902a"><text class="data-v-af3e902a">农历生日：</text><text class="info-value data-v-af3e902a">{{applicant.$orig.lunarBirthday||'未选'}}</text><text class="data-v-af3e902a">出生时辰：</text><text class="info-value data-v-af3e902a">{{applicant.$orig.birthTime||'未选'}}</text></view><view class="applicant-info-row data-v-af3e902a"><text class="data-v-af3e902a">常住地址：</text><text class="info-value data-v-af3e902a">{{applicant.$orig.address||'未填'}}</text></view></view></block></view><button class="add-btn data-v-af3e902a" disabled="{{$root.g1>=5}}" size="mini" data-event-opts="{{[['tap',[['addApplicant',['$event']]]]]}}" bindtap="__e">+ 添加报名人</button><uni-popup vue-id="63b6c67b-1" type="center" data-ref="popup" class="data-v-af3e902a vue-ref" bind:__l="__l" vue-slots="{{['default']}}"><view class="popup-content data-v-af3e902a"><view class="popup-title data-v-af3e902a">报名者信息</view><view class="popup-tip data-v-af3e902a">带 * 的字段为必填项</view><input class="input data-v-af3e902a" placeholder="* 姓名（必填）" maxlength="20" data-event-opts="{{[['blur',[['validateName',['$event']]]],['input',[['__set_model',['$0','name','$event',[]],['editApplicant']],['saveDraft',['$event']]]]]}}" value="{{editApplicant.name}}" bindblur="__e" bindinput="__e"/><picker range="{{genderOptions}}" value="{{$root.g2}}" data-event-opts="{{[['change',[['onGenderChange',['$event']]]]]}}" bindchange="__e" class="data-v-af3e902a"><view class="picker data-v-af3e902a"><text class="picker-label data-v-af3e902a">* 性别：</text><text class="picker-value data-v-af3e902a">{{editApplicant.gender||'请选择'}}</text><text class="picker-arrow data-v-af3e902a">▼</text></view></picker><input class="input data-v-af3e902a" placeholder="* 联系电话（必填）" type="number" maxlength="11" data-event-opts="{{[['blur',[['validatePhone',['$event']]]],['input',[['__set_model',['$0','phone','$event',[]],['editApplicant']],['saveDraft',['$event']]]]]}}" value="{{editApplicant.phone}}" bindblur="__e" bindinput="__e"/><picker mode="date" value="{{editApplicant.lunarBirthday}}" data-event-opts="{{[['change',[['onLunarBirthdayChange',['$event']]]]]}}" bindchange="__e" class="data-v-af3e902a"><view class="picker data-v-af3e902a"><text class="picker-label data-v-af3e902a">* 农历生日：</text><text class="picker-value data-v-af3e902a">{{editApplicant.lunarBirthday||'请选择'}}</text><text class="picker-arrow data-v-af3e902a">▼</text></view></picker><picker range="{{birthTimeOptions}}" value="{{$root.g3}}" data-event-opts="{{[['change',[['onBirthTimeChange',['$event']]]]]}}" bindchange="__e" class="data-v-af3e902a"><view class="picker data-v-af3e902a"><text class="picker-label data-v-af3e902a">* 出生时辰：</text><text class="picker-value data-v-af3e902a">{{editApplicant.birthTime||'请选择'}}</text><text class="picker-arrow data-v-af3e902a">▼</text></view></picker><input class="input data-v-af3e902a" placeholder="* 常住地址（必填）" data-event-opts="{{[['input',[['__set_model',['$0','address','$event',[]],['editApplicant']],['saveDraft',['$event']]]]]}}" value="{{editApplicant.address}}" bindinput="__e"/><view class="popup-btns data-v-af3e902a"><button data-event-opts="{{[['tap',[['saveApplicant',['$event']]]]]}}" class="popup-btn primary data-v-af3e902a" bindtap="__e">保存</button><button data-event-opts="{{[['tap',[['closePopup',['$event']]]]]}}" class="popup-btn data-v-af3e902a" bindtap="__e">取消</button></view></view></uni-popup><view class="section-title data-v-af3e902a">法会项目信息</view><view class="card data-v-af3e902a"><picker range="{{$root.g4}}" value="{{fahuiProjectIdx}}" data-event-opts="{{[['change',[['onProjectChange',['$event']]]]]}}" bindchange="__e" class="data-v-af3e902a"><view class="picker data-v-af3e902a"><text class="picker-label data-v-af3e902a">法会项目：</text><text class="picker-value data-v-af3e902a">{{currentProject?currentProject.name:'请选择'}}</text><text class="picker-arrow data-v-af3e902a">▼</text></view></picker><view class="fahui-tip data-v-af3e902a">法会日期：<text class="info-value data-v-af3e902a">预订成功后道长与您联系确认</text></view></view><block wx:if="{{currentProject&&currentProject.category==='姻缘'}}"><view class="special-tip data-v-af3e902a"><text class="data-v-af3e902a">如需填写配偶信息，请点击下方按钮</text><button class="mini-btn data-v-af3e902a" size="mini" data-event-opts="{{[['tap',[['openSpouseDialog',['$event']]]]]}}" bindtap="__e">填写配偶信息（选填）</button></view></block><block wx:if="{{currentProject&&currentProject.category==='超度'}}"><view class="data-v-af3e902a"><view class="section-title data-v-af3e902a">超度类型<text class="section-tip data-v-af3e902a">（必选）</text></view><view class="card data-v-af3e902a"><picker range="{{chaoduTypes}}" value="{{$root.g5}}" data-event-opts="{{[['change',[['onChaoduTypeChange',['$event']]]]]}}" bindchange="__e" class="data-v-af3e902a"><view class="picker data-v-af3e902a"><text class="picker-label data-v-af3e902a">超度类型：</text><text class="picker-value data-v-af3e902a">{{chaoduType||'请选择'}}</text><text class="picker-arrow data-v-af3e902a">▼</text></view></picker></view><view class="section-title data-v-af3e902a">已故亲人信息<text class="section-tip data-v-af3e902a">（至少1人，最多5人）</text></view><view class="section-tip-full data-v-af3e902a">点击"编辑"按钮可修改已故亲人信息</view><view class="deceased-list data-v-af3e902a"><block wx:for="{{$root.l1}}" wx:for-item="deceased" wx:for-index="idx" wx:key="idx"><view class="deceased-card data-v-af3e902a"><view class="deceased-header data-v-af3e902a"><text class="deceased-name data-v-af3e902a">{{deceased.$orig.name||'未填写'}}</text><view class="deceased-actions data-v-af3e902a"><button class="mini-btn data-v-af3e902a" size="mini" data-event-opts="{{[['tap',[['openDeceasedDialog',[idx]]]]]}}" bindtap="__e">编辑</button><block wx:if="{{deceased.g6>1}}"><button class="mini-btn danger data-v-af3e902a" size="mini" data-event-opts="{{[['tap',[['removeDeceased',[idx]]]]]}}" bindtap="__e">删除</button></block></view></view><view class="deceased-info-row data-v-af3e902a"><text class="data-v-af3e902a">出生农历：</text><text class="info-value data-v-af3e902a">{{deceased.$orig.lunarBirthday||'未选'}}</text><text class="data-v-af3e902a">去世农历：</text><text class="info-value data-v-af3e902a">{{deceased.$orig.deathDate||'未选'}}</text></view><view class="deceased-info-row data-v-af3e902a"><text class="data-v-af3e902a">关系：</text><text class="info-value data-v-af3e902a">{{deceased.$orig.relation||'未选'}}</text></view></view></block></view><block wx:if="{{$root.g7<5}}"><button data-event-opts="{{[['tap',[['addDeceased',['$event']]]]]}}" class="add-btn data-v-af3e902a" bindtap="__e"><text class="add-icon data-v-af3e902a">+</text><text class="add-text data-v-af3e902a">添加已故亲人</text></button></block></view></block><uni-popup vue-id="63b6c67b-2" type="center" data-ref="deceasedPopup" class="data-v-af3e902a vue-ref" bind:__l="__l" vue-slots="{{['default']}}"><view class="popup-content data-v-af3e902a"><view class="popup-title data-v-af3e902a">已故亲人信息</view><view class="popup-tip data-v-af3e902a">带 * 的字段为必填项，建议填写出生和去世日期</view><input class="input data-v-af3e902a" placeholder="* 姓名（必填）" maxlength="20" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['editDeceased']],['saveDraft',['$event']]]]]}}" value="{{editDeceased.name}}" bindinput="__e"/><picker mode="date" value="{{editDeceased.lunarBirthday}}" data-event-opts="{{[['change',[['onDeceasedLunarBirthdayChange',['$event']]]]]}}" bindchange="__e" class="data-v-af3e902a"><view class="picker data-v-af3e902a"><text class="picker-label data-v-af3e902a">出生农历：</text><text class="picker-value data-v-af3e902a">{{editDeceased.lunarBirthday||'请选择'}}</text><text class="picker-arrow data-v-af3e902a">▼</text></view></picker><picker mode="date" value="{{editDeceased.deathDate}}" data-event-opts="{{[['change',[['onDeceasedDeathDateChange',['$event']]]]]}}" bindchange="__e" class="data-v-af3e902a"><view class="picker data-v-af3e902a"><text class="picker-label data-v-af3e902a">去世农历：</text><text class="picker-value data-v-af3e902a">{{editDeceased.deathDate||'请选择'}}</text><text class="picker-arrow data-v-af3e902a">▼</text></view></picker><picker range="{{deceasedRelationOptions}}" value="{{$root.g8}}" data-event-opts="{{[['change',[['onDeceasedRelationChange',['$event']]]]]}}" bindchange="__e" class="data-v-af3e902a"><view class="picker data-v-af3e902a"><text class="picker-label data-v-af3e902a">* 关系：</text><text class="picker-value data-v-af3e902a">{{editDeceased.relation||'请选择'}}</text><text class="picker-arrow data-v-af3e902a">▼</text></view></picker><view class="popup-btns data-v-af3e902a"><button data-event-opts="{{[['tap',[['saveDeceased',['$event']]]]]}}" class="popup-btn primary data-v-af3e902a" bindtap="__e">保存</button><button data-event-opts="{{[['tap',[['closeDeceasedPopup',['$event']]]]]}}" class="popup-btn data-v-af3e902a" bindtap="__e">取消</button></view></view></uni-popup><block wx:if="{{showItems}}"><view class="section-title data-v-af3e902a">代办物品<text class="section-tip data-v-af3e902a">（可选）</text></view></block><block wx:if="{{showItems}}"><view class="card data-v-af3e902a"><block wx:for="{{items}}" wx:for-item="item" wx:for-index="idx" wx:key="idx"><view class="item-row data-v-af3e902a"><text class="data-v-af3e902a">{{item.name+"（￥"+item.price+"）"}}</text><input class="input item-input data-v-af3e902a" type="number" min="0" data-event-opts="{{[['input',[['__set_model',['$0','count','$event',['number']],[[['items','',idx]]]],['saveDraft',['$event']]]],['blur',[['$forceUpdate']]]]}}" value="{{item.count}}" bindinput="__e" bindblur="__e"/></view></block></view></block><block wx:if="{{showReceiver}}"><view class="section-title data-v-af3e902a">收件信息<text class="section-tip data-v-af3e902a">（可选）</text></view></block><block wx:if="{{showReceiver}}"><view class="card data-v-af3e902a"><input class="input data-v-af3e902a" placeholder="请输入收件人" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['receiver']],['saveDraft',['$event']]]]]}}" value="{{receiver.name}}" bindinput="__e"/><input class="input data-v-af3e902a" placeholder="请输入收件人电话" data-event-opts="{{[['input',[['__set_model',['$0','phone','$event',[]],['receiver']],['saveDraft',['$event']]]]]}}" value="{{receiver.phone}}" bindinput="__e"/><input class="input data-v-af3e902a" placeholder="请输入收件人地址" data-event-opts="{{[['input',[['__set_model',['$0','address','$event',[]],['receiver']],['saveDraft',['$event']]]]]}}" value="{{receiver.address}}" bindinput="__e"/></view></block><button class="form-btn data-v-af3e902a" type="primary" disabled="{{isSubmitting}}" data-event-opts="{{[['tap',[['nextStep',['$event']]]]]}}" bindtap="__e"><block wx:if="{{isSubmitting}}"><view class="btn-loading data-v-af3e902a"><view class="btn-spinner data-v-af3e902a"></view><text class="data-v-af3e902a">提交中...</text></view></block><block wx:else><text class="data-v-af3e902a">下一步</text></block></button><block wx:if="{{false}}"><view class="debug-info data-v-af3e902a"><text class="data-v-af3e902a">{{"报名人数："+$root.g9}}</text><text class="data-v-af3e902a">{{"已故亲人数："+$root.g10}}</text><text class="data-v-af3e902a">{{"法会项目："+(currentProject?currentProject.name:'未选择')}}</text></view></block><block wx:if="{{errorMessage}}"><view class="error-message data-v-af3e902a"><text class="data-v-af3e902a">{{errorMessage}}</text><button data-event-opts="{{[['tap',[['clearError',['$event']]]]]}}" class="error-btn data-v-af3e902a" bindtap="__e">知道了</button></view></block></view></block></view>