<view class="fahui-page data-v-497fb5e2"><block wx:if="{{bannerImage}}"><image class="fahui-banner data-v-497fb5e2" src="{{bannerImage}}" mode="aspectFill"></image></block><block wx:if="{{bannerDesc}}"><view class="banner-desc data-v-497fb5e2">{{bannerDesc}}</view></block><view class="intro-section data-v-497fb5e2"><block wx:if="{{specialIntro.image}}"><view class="intro-image data-v-497fb5e2"><image class="intro-img data-v-497fb5e2" src="{{specialIntro.image}}" mode="aspectFill"></image></view></block><view class="intro-content data-v-497fb5e2">{{specialIntro.content}}</view></view><view class="section data-v-497fb5e2"><view class="section-title data-v-497fb5e2"><text class="icon data-v-497fb5e2">👥</text>报名人信息<text class="section-tip data-v-497fb5e2">（最多5人，每人信息需完整）</text></view><participant-form vue-id="3310f138-1" value="{{applicants}}" data-event-opts="{{[['^change',[['onParticipantsChange']]]]}}" bind:change="__e" class="data-v-497fb5e2" bind:__l="__l"></participant-form></view><view class="section data-v-497fb5e2"><view class="section-title data-v-497fb5e2"><text class="icon data-v-497fb5e2">🕯️</text>法会项目<text class="section-tip data-v-497fb5e2">（必选）</text></view><view class="project-list data-v-497fb5e2"><block wx:for="{{fahuiProjects}}" wx:for-item="project" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectProject',[index]]]]]}}" class="project-item data-v-497fb5e2" bindtap="__e"><view class="project-info data-v-497fb5e2"><text class="project-name data-v-497fb5e2">{{project.name}}</text><text data-event-opts="{{[['tap',[['showProjectIntro',['$0'],[[['fahuiProjects','',index]]]]]]]}}" class="info-icon data-v-497fb5e2" catchtap="__e">ℹ️</text><text class="project-desc data-v-497fb5e2">{{project.description}}</text><text class="project-price data-v-497fb5e2">{{"¥"+project.price}}</text><text class="project-remaining data-v-497fb5e2">{{"剩余名额："+(project.maxApplicants?project.maxApplicants-(project.currentApplicants||0):'不限')}}</text></view><view class="{{['project-status','data-v-497fb5e2',(selectedProjectIndex===index)?'active':'']}}"><text class="status-icon data-v-497fb5e2">{{selectedProjectIndex===index?'✓':'○'}}</text></view></view></block></view></view><block wx:if="{{selectedProjectIndex===0}}"><view class="section data-v-497fb5e2"><view class="section-title data-v-497fb5e2"><text class="icon data-v-497fb5e2">💕</text>配偶信息<text class="section-tip data-v-497fb5e2">（选填）</text></view><view class="spouse-form data-v-497fb5e2"><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">配偶姓名</text><input class="form-input data-v-497fb5e2" placeholder="请输入配偶姓名" maxlength="10" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['spouse']]]]]}}" value="{{spouse.name}}" bindinput="__e"/></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">性别</text><picker range="{{genderOptions}}" value="{{$root.g0}}" data-event-opts="{{[['change',[['onSpouseGenderChange',['$event']]]]]}}" bindchange="__e" class="data-v-497fb5e2"><view class="picker data-v-497fb5e2"><text class="picker-value data-v-497fb5e2">{{spouse.gender||'请选择性别'}}</text><text class="picker-arrow data-v-497fb5e2">▼</text></view></picker></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">联系电话</text><input class="form-input data-v-497fb5e2" placeholder="请输入联系电话" type="number" maxlength="11" data-event-opts="{{[['input',[['__set_model',['$0','phone','$event',[]],['spouse']]]]]}}" value="{{spouse.phone}}" bindinput="__e"/></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">农历生日</text><picker mode="date" value="{{spouse.lunarBirthday}}" data-event-opts="{{[['change',[['onSpouseBirthdayChange',['$event']]]]]}}" bindchange="__e" class="data-v-497fb5e2"><view class="picker data-v-497fb5e2"><text class="picker-value data-v-497fb5e2">{{spouse.lunarBirthday||'请选择农历生日'}}</text><text class="picker-arrow data-v-497fb5e2">▼</text></view></picker></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">出生时辰</text><picker range="{{birthTimeOptions}}" value="{{$root.g1}}" data-event-opts="{{[['change',[['onSpouseBirthTimeChange',['$event']]]]]}}" bindchange="__e" class="data-v-497fb5e2"><view class="picker data-v-497fb5e2"><text class="picker-value data-v-497fb5e2">{{spouse.birthTime||'请选择出生时辰'}}</text><text class="picker-arrow data-v-497fb5e2">▼</text></view></picker></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">常住地址</text><input class="form-input data-v-497fb5e2" placeholder="请输入常住地址" data-event-opts="{{[['input',[['__set_model',['$0','address','$event',[]],['spouse']]]]]}}" value="{{spouse.address}}" bindinput="__e"/></view></view></view></block><block wx:if="{{selectedProjectIndex===1}}"><view class="section data-v-497fb5e2"><view class="section-title data-v-497fb5e2"><text class="icon data-v-497fb5e2">🕯️</text>超度信息<text class="section-tip data-v-497fb5e2">（必填）</text></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">超度类型<text class="required data-v-497fb5e2">*</text></text><picker range="{{chaoduTypes}}" value="{{$root.g2}}" data-event-opts="{{[['change',[['onChaoduTypeChange',['$event']]]]]}}" bindchange="__e" class="data-v-497fb5e2"><view class="picker data-v-497fb5e2"><text class="picker-value data-v-497fb5e2">{{chaoduType||'请选择超度类型'}}</text><text class="picker-arrow data-v-497fb5e2">▼</text></view></picker></view><view class="deceased-list data-v-497fb5e2"><block wx:for="{{$root.l0}}" wx:for-item="deceased" wx:for-index="index" wx:key="index"><view class="deceased-card data-v-497fb5e2"><view class="deceased-header data-v-497fb5e2"><text class="deceased-title data-v-497fb5e2">{{"已故亲人 "+(index+1)}}</text><block wx:if="{{deceased.g3>1}}"><button data-event-opts="{{[['tap',[['removeDeceased',[index]]]]]}}" class="remove-btn data-v-497fb5e2" bindtap="__e">删除</button></block></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">姓名<text class="required data-v-497fb5e2">*</text></text><input class="form-input data-v-497fb5e2" placeholder="请输入姓名" maxlength="10" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],[[['deceasedList','',index]]]]]]]}}" value="{{deceased.$orig.name}}" bindinput="__e"/></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">关系<text class="required data-v-497fb5e2">*</text></text><picker range="{{relationOptions}}" value="{{deceased.g4}}" data-event-opts="{{[['change',[['onRelationChange',[index,'$event']]]]]}}" bindchange="__e" class="data-v-497fb5e2"><view class="picker data-v-497fb5e2"><text class="picker-value data-v-497fb5e2">{{deceased.$orig.relation||'请选择关系'}}</text><text class="picker-arrow data-v-497fb5e2">▼</text></view></picker></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">出生农历</text><picker mode="date" value="{{deceased.$orig.lunarBirthday}}" data-event-opts="{{[['change',[['onDeceasedBirthdayChange',[index,'$event']]]]]}}" bindchange="__e" class="data-v-497fb5e2"><view class="picker data-v-497fb5e2"><text class="picker-value data-v-497fb5e2">{{deceased.$orig.lunarBirthday||'请选择出生农历'}}</text><text class="picker-arrow data-v-497fb5e2">▼</text></view></picker></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">去世农历</text><picker mode="date" value="{{deceased.$orig.deathDate}}" data-event-opts="{{[['change',[['onDeceasedDeathChange',[index,'$event']]]]]}}" bindchange="__e" class="data-v-497fb5e2"><view class="picker data-v-497fb5e2"><text class="picker-value data-v-497fb5e2">{{deceased.$orig.deathDate||'请选择去世农历'}}</text><text class="picker-arrow data-v-497fb5e2">▼</text></view></picker></view></view></block></view><block wx:if="{{$root.g5<5}}"><button data-event-opts="{{[['tap',[['addDeceased',['$event']]]]]}}" class="add-btn data-v-497fb5e2" bindtap="__e"><text class="add-icon data-v-497fb5e2">+</text><text class="add-text data-v-497fb5e2">添加已故亲人</text></button></block></view></block><block wx:if="{{showGoods}}"><view class="section data-v-497fb5e2"><view class="section-title data-v-497fb5e2"><text class="icon data-v-497fb5e2">🛍️</text>代办物品<text class="section-tip data-v-497fb5e2">（可选）</text></view><view class="goods-list data-v-497fb5e2"><block wx:for="{{goodsList}}" wx:for-item="item" wx:for-index="index" wx:key="index"><view class="goods-item data-v-497fb5e2"><view class="goods-info data-v-497fb5e2"><text class="goods-name data-v-497fb5e2">{{item.name}}</text><text class="goods-desc data-v-497fb5e2">{{item.description}}</text><text class="goods-price data-v-497fb5e2">{{"¥"+item.price}}</text></view><view class="goods-control data-v-497fb5e2"><button class="qty-btn data-v-497fb5e2" disabled="{{item.qty<=0}}" data-event-opts="{{[['tap',[['decreaseGoodsQty',[index]]]]]}}" bindtap="__e">-</button><text class="qty-value data-v-497fb5e2">{{item.qty}}</text><button data-event-opts="{{[['tap',[['increaseGoodsQty',[index]]]]]}}" class="qty-btn data-v-497fb5e2" bindtap="__e">+</button></view></view></block></view><view class="total-section data-v-497fb5e2"><text class="total-label data-v-497fb5e2">代办费用：</text><text class="total-price data-v-497fb5e2">{{"¥"+goodsTotalPrice}}</text></view></view></block><block wx:if="{{showReceiver}}"><view class="section data-v-497fb5e2"><view class="section-title data-v-497fb5e2"><text class="icon data-v-497fb5e2">📦</text>收件信息<text class="section-tip data-v-497fb5e2">（可选）</text></view><view class="receiver-form data-v-497fb5e2"><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">收件人</text><input class="form-input data-v-497fb5e2" placeholder="请输入收件人" maxlength="10" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['receiver']]]]]}}" value="{{receiver.name}}" bindinput="__e"/></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">联系电话</text><input class="form-input data-v-497fb5e2" placeholder="请输入联系电话" type="number" maxlength="11" data-event-opts="{{[['input',[['__set_model',['$0','phone','$event',[]],['receiver']]]]]}}" value="{{receiver.phone}}" bindinput="__e"/></view><view class="form-group data-v-497fb5e2"><text class="form-label data-v-497fb5e2">收件地址</text><input class="form-input data-v-497fb5e2" placeholder="请输入收件地址" data-event-opts="{{[['input',[['__set_model',['$0','address','$event',[]],['receiver']]]]]}}" value="{{receiver.address}}" bindinput="__e"/></view></view></view></block><view class="footer data-v-497fb5e2"><button data-event-opts="{{[['tap',[['nextStep',['$event']]]]]}}" class="next-btn data-v-497fb5e2" bindtap="__e">下一步</button></view><block wx:if="{{showHistoryDialog}}"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="history-dialog-mask data-v-497fb5e2" bindtap="__e"><view class="history-dialog data-v-497fb5e2" tabindex="0" data-event-opts="{{[['tap',[['',['$event']]]],['keydown',[['onHistoryKeydown',['$event']]]]]}}" catchtap="__e" bindkeydown="__e"><view class="dialog-title data-v-497fb5e2">选择历史报名人</view><view class="search-bar data-v-497fb5e2"><input class="search-input data-v-497fb5e2" placeholder="搜索姓名或电话" data-event-opts="{{[['input',[['__set_model',['','historySearch','$event',[]]],['onHistorySearch',['$event']]]]]}}" value="{{historySearch}}" bindinput="__e"/><block wx:if="{{historySearch}}"><text data-event-opts="{{[['tap',[['clearHistorySearch',['$event']]]]]}}" class="search-clear data-v-497fb5e2" bindtap="__e">×</text></block></view><block wx:if="{{$root.g6===0}}"><view class="empty-tip data-v-497fb5e2"><text class="empty-icon data-v-497fb5e2">🗂️</text>暂无匹配报名人</view></block><block wx:else><view class="history-list data-v-497fb5e2"><block wx:for="{{$root.l1}}" wx:for-item="item" wx:for-index="idx" wx:key="idx"><view data-event-opts="{{[['mouseenter',[['e1',['$event']]]],['mouseleave',[['e2',['$event']]]],['tap',[['onHistoryItemClick',[idx,'$0'],[[['filteredHistory','',idx]]]]]]]}}" data-event-params="{{({idx})}}" class="{{['history-item','data-v-497fb5e2',(hoverIdx===idx)?'hover':'',(item.g7)?'selected':'']}}" bindmouseenter="__e" bindmouseleave="__e" bindtap="__e"><view class="history-main data-v-497fb5e2"><view class="history-name data-v-497fb5e2">{{item.$orig.name+''}}<text class="history-phone data-v-497fb5e2">{{item.$orig.phone}}</text></view><view class="history-detail data-v-497fb5e2">{{item.$orig.gender+" | "+item.$orig.lunarBirthday+" | "+item.$orig.birthTime+" | "+item.$orig.address}}</view><view class="history-detail2 data-v-497fb5e2">{{"身份证号："+(item.$orig.idCard||'—')}}</view></view><block wx:if="{{!batchDeleteMode}}"><button data-event-opts="{{[['tap',[['deleteHistoryParticipant',[idx]]]]]}}" class="history-del data-v-497fb5e2" catchtap="__e">删除</button></block><block wx:if="{{batchDeleteMode}}"><input class="batch-checkbox data-v-497fb5e2" type="checkbox" data-event-opts="{{[['change',[['toggleBatchDelete',[idx]]]]]}}" checked="{{item.g8}}" catchchange="__e"/></block></view></block></view></block><view class="dialog-actions data-v-497fb5e2"><button data-event-opts="{{[['tap',[['e3',['$event']]]]]}}" class="dialog-close data-v-497fb5e2" bindtap="__e">关闭</button><button data-event-opts="{{[['tap',[['toggleBatchDeleteMode',['$event']]]]]}}" class="dialog-btn data-v-497fb5e2" bindtap="__e">{{batchDeleteMode?'取消批量':'批量删除'}}</button><button data-event-opts="{{[['tap',[['exportHistory',['$event']]]]]}}" class="dialog-btn data-v-497fb5e2" bindtap="__e">导出</button><button data-event-opts="{{[['tap',[['importHistory',['$event']]]]]}}" class="dialog-btn data-v-497fb5e2" bindtap="__e">导入</button><block wx:if="{{batchDeleteMode&&batchDeleteSet.size}}"><button data-event-opts="{{[['tap',[['confirmBatchDelete',['$event']]]]]}}" class="dialog-btn danger data-v-497fb5e2" bindtap="__e">{{"确认删除("+batchDeleteSet.size+")"}}</button></block></view><block wx:if="{{showImportInput}}"><input style="display:none;" type="file" accept="application/json" data-ref="importFile" data-event-opts="{{[['change',[['onImportFile',['$event']]]]]}}" bindchange="__e" class="data-v-497fb5e2 vue-ref"/></block></view></view></block></view>