<view class="form-bg data-v-4bb6e490"><block wx:if="{{isLoading}}"><view class="loading-container data-v-4bb6e490"><view class="loading-spinner data-v-4bb6e490"></view><text class="loading-text data-v-4bb6e490">加载中...</text></view></block><block wx:else><view class="form-container data-v-4bb6e490"><view class="form-title data-v-4bb6e490">合坛法会报名</view><view class="form-help data-v-4bb6e490"><text class="data-v-4bb6e490">📝 请仔细填写所有必填信息，确保信息准确完整</text><text class="data-v-4bb6e490">👥 可添加最多5位报名人，每人信息需完整</text><text class="data-v-4bb6e490">💝 不同法会类型有特殊要求，请按提示填写</text><text class="data-v-4bb6e490">💾 数据会自动保存，可随时返回继续填写</text></view><view class="section-title data-v-4bb6e490">报名人信息<text class="section-tip data-v-4bb6e490">（最多5人，每人信息需完整）</text></view><view class="section-tip-full data-v-4bb6e490">点击"编辑"按钮可修改报名人信息</view><view class="debug-info data-v-4bb6e490"><text class="debug-text data-v-4bb6e490">{{"调试信息：报名人数量 "+$root.g0}}</text><text class="debug-text data-v-4bb6e490">{{"当前项目："+(currentProject?currentProject.name:'未选择')}}</text></view><view class="applicant-list data-v-4bb6e490"><block wx:for="{{$root.l0}}" wx:for-item="applicant" wx:for-index="idx" wx:key="idx"><view class="applicant-card data-v-4bb6e490"><view class="applicant-header data-v-4bb6e490"><text class="applicant-name data-v-4bb6e490">{{applicant.$orig.name||'未填写'}}</text><view class="applicant-actions data-v-4bb6e490"><button class="mini-btn data-v-4bb6e490" size="mini" data-event-opts="{{[['tap',[['openApplicantDialog',[idx]]]]]}}" bindtap="__e">编辑</button><block wx:if="{{applicant.g1>1}}"><button class="mini-btn danger data-v-4bb6e490" size="mini" data-event-opts="{{[['tap',[['removeApplicant',[idx]]]]]}}" bindtap="__e">删除</button></block></view></view><view class="debug-applicant data-v-4bb6e490"><text class="debug-applicant-text data-v-4bb6e490">{{"调试：姓名=\""+applicant.$orig.name+"\" 性别=\""+applicant.$orig.gender+"\" 电话=\""+applicant.$orig.phone+"\""}}</text></view><view class="applicant-info-row data-v-4bb6e490"><text class="data-v-4bb6e490">性别：</text><text class="info-value data-v-4bb6e490">{{applicant.$orig.gender||'未选'}}</text><text class="data-v-4bb6e490">电话：</text><text class="info-value data-v-4bb6e490">{{applicant.$orig.phone||'未填'}}</text></view><view class="applicant-info-row data-v-4bb6e490"><text class="data-v-4bb6e490">农历生日：</text><text class="info-value data-v-4bb6e490">{{applicant.$orig.lunarBirthday||'未选'}}</text><text class="data-v-4bb6e490">出生时辰：</text><text class="info-value data-v-4bb6e490">{{applicant.$orig.birthTime||'未选'}}</text></view><view class="applicant-info-row data-v-4bb6e490"><text class="data-v-4bb6e490">常住地址：</text><text class="info-value data-v-4bb6e490">{{applicant.$orig.address||'未填'}}</text></view></view></block></view><button class="add-btn data-v-4bb6e490" disabled="{{$root.g2>=5}}" size="mini" data-event-opts="{{[['tap',[['addApplicant',['$event']]]]]}}" bindtap="__e">+ 添加报名人</button><button class="debug-btn data-v-4bb6e490" size="mini" data-event-opts="{{[['tap',[['debugApplicants',['$event']]]]]}}" bindtap="__e">调试报名人数据</button><button class="fix-btn data-v-4bb6e490" size="mini" data-event-opts="{{[['tap',[['quickFix',['$event']]]]]}}" bindtap="__e">快速修复数据</button><uni-popup vue-id="2b262e76-1" type="center" data-ref="popup" class="data-v-4bb6e490 vue-ref" bind:__l="__l" vue-slots="{{['default']}}"><view class="popup-content data-v-4bb6e490"><view class="popup-title data-v-4bb6e490">报名者信息</view><view class="popup-tip data-v-4bb6e490">带 * 的字段为必填项</view><input class="input data-v-4bb6e490" placeholder="* 姓名（必填）" maxlength="20" data-event-opts="{{[['blur',[['validateName',['$event']]]],['input',[['__set_model',['$0','name','$event',[]],['editApplicant']],['saveDraft',['$event']]]]]}}" value="{{editApplicant.name}}" bindblur="__e" bindinput="__e"/><picker range="{{genderOptions}}" value="{{genderIndex}}" data-event-opts="{{[['change',[['onGenderChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">* 性别：</text><text class="picker-value data-v-4bb6e490">{{editApplicant.gender||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker><input class="input data-v-4bb6e490" placeholder="* 联系电话（必填）" type="tel" maxlength="11" data-event-opts="{{[['blur',[['validatePhone',['$event']]]],['input',[['__set_model',['$0','phone','$event',[]],['editApplicant']],['saveDraft',['$event']]]]]}}" value="{{editApplicant.phone}}" bindblur="__e" bindinput="__e"/><picker mode="date" value="{{editApplicant.lunarBirthday}}" data-event-opts="{{[['change',[['onLunarBirthdayChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">* 农历生日：</text><text class="picker-value data-v-4bb6e490">{{editApplicant.lunarBirthday||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker><picker range="{{birthTimeOptions}}" value="{{birthTimeIndex}}" data-event-opts="{{[['change',[['onBirthTimeChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">* 出生时辰：</text><text class="picker-value data-v-4bb6e490">{{editApplicant.birthTime||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker><input class="input data-v-4bb6e490" placeholder="* 常住地址（必填）" data-event-opts="{{[['input',[['__set_model',['$0','address','$event',[]],['editApplicant']],['saveDraft',['$event']]]]]}}" value="{{editApplicant.address}}" bindinput="__e"/><view class="popup-btns data-v-4bb6e490"><button data-event-opts="{{[['tap',[['saveApplicant',['$event']]]]]}}" class="popup-btn primary data-v-4bb6e490" bindtap="__e">保存</button><button data-event-opts="{{[['tap',[['closePopup',['$event']]]]]}}" class="popup-btn data-v-4bb6e490" bindtap="__e">取消</button></view></view></uni-popup><view class="section-title data-v-4bb6e490">法会项目信息</view><view class="card data-v-4bb6e490"><picker range="{{projectNames}}" value="{{jointProjectIdx}}" data-event-opts="{{[['change',[['onProjectChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">法会项目：</text><text class="picker-value data-v-4bb6e490">{{currentProject?currentProject.name:'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker><block wx:if="{{hasProjectDates}}"><picker range="{{currentProject.dates}}" value="{{selectedDateIdx}}" data-event-opts="{{[['change',[['onDateChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">法会日期：</text><text class="picker-value data-v-4bb6e490">{{selectedDate||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker></block><block wx:else><view class="fahui-tip data-v-4bb6e490">法会日期：<text class="info-value data-v-4bb6e490">预订成功后道长与您联系确认</text></view></block></view><block wx:if="{{showSpouseInfo}}"><view style="margin-top:10rpx;margin-bottom:10rpx;" class="data-v-4bb6e490"><view class="section-title data-v-4bb6e490" style="margin-bottom:8rpx;">配偶信息</view><view class="card data-v-4bb6e490" style="margin-bottom:0;"><view class="spouse-info data-v-4bb6e490"><view class="info-row data-v-4bb6e490"><text class="info-label data-v-4bb6e490">姓名：</text><text class="info-value data-v-4bb6e490">{{spouse.name}}</text></view><view class="info-row data-v-4bb6e490"><text class="info-label data-v-4bb6e490">性别：</text><text class="info-value data-v-4bb6e490">{{spouse.gender}}</text></view><view class="info-row data-v-4bb6e490"><text class="info-label data-v-4bb6e490">农历生日：</text><text class="info-value data-v-4bb6e490">{{spouse.lunarBirthday||'未填写'}}</text></view><view class="info-row data-v-4bb6e490"><text class="info-label data-v-4bb6e490">出生时辰：</text><text class="info-value data-v-4bb6e490">{{spouse.birthTime||'未填写'}}</text></view></view><button class="mini-btn data-v-4bb6e490" size="mini" data-event-opts="{{[['tap',[['openSpouseDialog',['$event']]]]]}}" bindtap="__e">修改配偶信息</button></view></view></block><block wx:if="{{isChaoduProject}}"><view style="margin-top:10rpx;margin-bottom:10rpx;" class="data-v-4bb6e490"><view class="section-title data-v-4bb6e490" style="margin-bottom:8rpx;">超度类型<text class="section-tip data-v-4bb6e490">（必选）</text></view><view class="card data-v-4bb6e490" style="margin-bottom:0;"><picker range="{{chaoduTypes}}" value="{{chaoduTypeIndex}}" data-event-opts="{{[['change',[['onChaoduTypeChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">超度类型：</text><text class="picker-value data-v-4bb6e490">{{chaoduType||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker></view><view class="section-title data-v-4bb6e490" style="margin-bottom:8rpx;">已故亲人信息<text class="section-tip data-v-4bb6e490">（至少1人，最多5人）</text></view><view class="section-tip-full data-v-4bb6e490">点击"编辑"按钮可修改已故亲人信息</view><view class="deceased-list data-v-4bb6e490"><block wx:for="{{$root.l1}}" wx:for-item="deceased" wx:for-index="idx" wx:key="idx"><view class="deceased-card data-v-4bb6e490"><view class="deceased-header data-v-4bb6e490"><text class="deceased-name data-v-4bb6e490">{{deceased.$orig.name||'未填写'}}</text><view class="deceased-actions data-v-4bb6e490"><button class="mini-btn data-v-4bb6e490" size="mini" data-event-opts="{{[['tap',[['openDeceasedDialog',[idx]]]]]}}" bindtap="__e">编辑</button><block wx:if="{{deceased.g3>1}}"><button class="mini-btn danger data-v-4bb6e490" size="mini" data-event-opts="{{[['tap',[['removeDeceased',[idx]]]]]}}" bindtap="__e">删除</button></block></view></view><view class="deceased-info-row data-v-4bb6e490"><text class="data-v-4bb6e490">出生农历：</text><text class="info-value data-v-4bb6e490">{{deceased.$orig.lunarBirthday||'未选'}}</text><text class="data-v-4bb6e490">去世农历：</text><text class="info-value data-v-4bb6e490">{{deceased.$orig.deathDate||'未选'}}</text></view><view class="deceased-info-row data-v-4bb6e490"><text class="data-v-4bb6e490">关系：</text><text class="info-value data-v-4bb6e490">{{deceased.$orig.relation||'未选'}}</text></view></view></block></view><block wx:if="{{$root.g4<5}}"><button data-event-opts="{{[['tap',[['addDeceased',['$event']]]]]}}" class="add-btn data-v-4bb6e490" bindtap="__e"><text class="add-icon data-v-4bb6e490">+</text><text class="add-text data-v-4bb6e490">添加已故亲人</text></button></block></view></block><uni-popup vue-id="2b262e76-2" type="center" data-ref="spousePopup" class="data-v-4bb6e490 vue-ref" bind:__l="__l" vue-slots="{{['default']}}"><view class="popup-content data-v-4bb6e490"><view class="popup-title data-v-4bb6e490">配偶信息</view><view class="popup-tip data-v-4bb6e490">以下信息为选填项，可根据需要填写</view><input class="input data-v-4bb6e490" placeholder="姓名（选填）" maxlength="20" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['editSpouse']],['saveDraft',['$event']]]]]}}" value="{{editSpouse.name}}" bindinput="__e"/><picker range="{{genderOptions}}" value="{{spouseGenderIndex}}" data-event-opts="{{[['change',[['onSpouseGenderChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">性别：</text><text class="picker-value data-v-4bb6e490">{{editSpouse.gender||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker><picker mode="date" value="{{editSpouse.lunarBirthday}}" data-event-opts="{{[['change',[['onSpouseLunarBirthdayChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">农历生日：</text><text class="picker-value data-v-4bb6e490">{{editSpouse.lunarBirthday||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker><picker range="{{birthTimeOptions}}" value="{{spouseBirthTimeIndex}}" data-event-opts="{{[['change',[['onSpouseBirthTimeChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">出生时辰：</text><text class="picker-value data-v-4bb6e490">{{editSpouse.birthTime||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker><view class="popup-btns data-v-4bb6e490"><button data-event-opts="{{[['tap',[['saveSpouse',['$event']]]]]}}" class="popup-btn primary data-v-4bb6e490" bindtap="__e">保存</button><button data-event-opts="{{[['tap',[['closeSpousePopup',['$event']]]]]}}" class="popup-btn data-v-4bb6e490" bindtap="__e">取消</button></view></view></uni-popup><uni-popup vue-id="2b262e76-3" type="center" data-ref="deceasedPopup" class="data-v-4bb6e490 vue-ref" bind:__l="__l" vue-slots="{{['default']}}"><view class="popup-content data-v-4bb6e490"><view class="popup-title data-v-4bb6e490">已故亲人信息</view><view class="popup-tip data-v-4bb6e490">带 * 的字段为必填项，建议填写出生和去世日期</view><input class="input data-v-4bb6e490" placeholder="* 姓名（必填）" maxlength="20" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['editDeceased']],['saveDraft',['$event']]]]]}}" value="{{editDeceased.name}}" bindinput="__e"/><picker mode="date" value="{{editDeceased.lunarBirthday}}" data-event-opts="{{[['change',[['onDeceasedLunarBirthdayChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">出生农历：</text><text class="picker-value data-v-4bb6e490">{{editDeceased.lunarBirthday||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker><picker mode="date" value="{{editDeceased.deathDate}}" data-event-opts="{{[['change',[['onDeceasedDeathDateChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">去世农历：</text><text class="picker-value data-v-4bb6e490">{{editDeceased.deathDate||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker><picker range="{{deceasedRelationOptions}}" value="{{deceasedRelationIndex}}" data-event-opts="{{[['change',[['onDeceasedRelationChange',['$event']]]]]}}" bindchange="__e" class="data-v-4bb6e490"><view class="picker data-v-4bb6e490"><text class="picker-label data-v-4bb6e490">* 关系：</text><text class="picker-value data-v-4bb6e490">{{editDeceased.relation||'请选择'}}</text><text class="picker-arrow data-v-4bb6e490">▼</text></view></picker><view class="popup-btns data-v-4bb6e490"><button data-event-opts="{{[['tap',[['saveDeceased',['$event']]]]]}}" class="popup-btn primary data-v-4bb6e490" bindtap="__e">保存</button><button data-event-opts="{{[['tap',[['closeDeceasedPopup',['$event']]]]]}}" class="popup-btn data-v-4bb6e490" bindtap="__e">取消</button></view></view></uni-popup><block wx:if="{{showItems}}"><view class="section-title data-v-4bb6e490">代办物品<text class="section-tip data-v-4bb6e490">（可选）</text></view></block><block wx:if="{{showItems}}"><view class="card data-v-4bb6e490"><block wx:for="{{items}}" wx:for-item="item" wx:for-index="idx" wx:key="idx"><view class="item-row data-v-4bb6e490"><text class="data-v-4bb6e490">{{item.name+"（￥"+item.price+"）"}}</text><input class="input item-input data-v-4bb6e490" type="number" min="0" data-event-opts="{{[['input',[['__set_model',['$0','count','$event',['number']],[[['items','',idx]]]],['saveDraft',['$event']]]],['blur',[['$forceUpdate']]]]}}" value="{{item.count}}" bindinput="__e" bindblur="__e"/></view></block></view></block><block wx:if="{{showReceiver}}"><view class="section-title data-v-4bb6e490">收件信息<block wx:if="{{!receiverConfig||!receiverConfig.nameRequired&&!receiverConfig.phoneRequired&&!receiverConfig.addressRequired}}"><text class="section-tip data-v-4bb6e490">（可选）</text></block><block wx:else><text class="section-tip data-v-4bb6e490">（必填项已标记*）</text></block></view></block><block wx:if="{{showReceiver}}"><view class="card data-v-4bb6e490"><view class="input-group data-v-4bb6e490"><block wx:if="{{receiverConfig&&receiverConfig.nameRequired}}"><text class="input-label data-v-4bb6e490">收件人姓名 *</text></block><block wx:else><text class="input-label data-v-4bb6e490">收件人姓名</text></block><input class="input data-v-4bb6e490" placeholder="请输入收件人姓名" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['receiver']],['saveDraft',['$event']]]]]}}" value="{{receiver.name}}" bindinput="__e"/></view><view class="input-group data-v-4bb6e490"><block wx:if="{{receiverConfig&&receiverConfig.phoneRequired}}"><text class="input-label data-v-4bb6e490">联系电话 *</text></block><block wx:else><text class="input-label data-v-4bb6e490">联系电话</text></block><input class="input data-v-4bb6e490" placeholder="请输入联系电话" type="tel" maxlength="11" data-event-opts="{{[['input',[['__set_model',['$0','phone','$event',[]],['receiver']],['saveDraft',['$event']]]]]}}" value="{{receiver.phone}}" bindinput="__e"/></view><view class="input-group data-v-4bb6e490"><block wx:if="{{receiverConfig&&receiverConfig.addressRequired}}"><text class="input-label data-v-4bb6e490">收件地址 *</text></block><block wx:else><text class="input-label data-v-4bb6e490">收件地址</text></block><textarea class="textarea data-v-4bb6e490" placeholder="请输入详细收件地址" data-event-opts="{{[['input',[['__set_model',['$0','address','$event',[]],['receiver']],['saveDraft',['$event']]]]]}}" value="{{receiver.address}}" bindinput="__e"></textarea></view></view></block><button class="form-btn data-v-4bb6e490" type="primary" disabled="{{isSubmitting}}" data-event-opts="{{[['tap',[['nextStep',['$event']]]]]}}" bindtap="__e"><block wx:if="{{isSubmitting}}"><view class="btn-loading data-v-4bb6e490"><view class="btn-spinner data-v-4bb6e490"></view><text class="data-v-4bb6e490">提交中...</text></view></block><block wx:else><text class="data-v-4bb6e490">下一步</text></block></button><block wx:if="{{true}}"><view class="debug-info data-v-4bb6e490"><text class="data-v-4bb6e490">{{"报名人数："+$root.g5}}</text><text class="data-v-4bb6e490">{{"已故亲人数："+$root.g6}}</text><text class="data-v-4bb6e490">{{"代办物品数："+$root.g7}}</text><text class="data-v-4bb6e490">{{"收件信息："+(showReceiver?'显示':'隐藏')}}</text><text class="data-v-4bb6e490">{{"代办物品模块："+(showItems?'显示':'隐藏')}}</text><button data-event-opts="{{[['tap',[['checkModuleConfig',['$event']]]]]}}" class="debug-btn data-v-4bb6e490" bindtap="__e">检查代办物品配置</button><button data-event-opts="{{[['tap',[['checkReceiverConfig',['$event']]]]]}}" class="debug-btn data-v-4bb6e490" bindtap="__e">检查收件信息配置</button><button data-event-opts="{{[['tap',[['debugData',['$event']]]]]}}" class="debug-btn data-v-4bb6e490" style="background:#ff6b6b;color:white;" bindtap="__e">生成测试数据</button></view></block></view></block></view>