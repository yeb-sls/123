<view class="admin-container data-v-6f9cf068"><view class="header data-v-6f9cf068"><view data-event-opts="{{[['tap',[['goBack',['$event']]]]]}}" class="back-btn data-v-6f9cf068" bindtap="__e"><text class="back-icon data-v-6f9cf068">←</text><text class="back-text data-v-6f9cf068">返回</text></view><view class="title data-v-6f9cf068">法会订单管理</view><view data-event-opts="{{[['tap',[['loadOrders',['$event']]]]]}}" class="refresh-btn data-v-6f9cf068" bindtap="__e"><text class="refresh-icon data-v-6f9cf068">🔄</text><text class="refresh-text data-v-6f9cf068">刷新</text></view><button data-event-opts="{{[['tap',[['exportOrders',['$event']]]]]}}" class="export-btn data-v-6f9cf068" bindtap="__e">导出订单</button></view><view class="module-status-bar data-v-6f9cf068"><text class="data-v-6f9cf068">收件信息模块：</text><text style="{{'color:'+(receiverEnabled?'#52c41a':'#ff4d4f')+';'}}" class="data-v-6f9cf068">{{''+(receiverEnabled?'已启用':'未启用')+''}}</text><switch style="margin-left:24rpx;" checked="{{receiverEnabled}}" data-event-opts="{{[['change',[['onReceiverSwitchChange',['$event']]]]]}}" bindchange="__e" class="data-v-6f9cf068"></switch></view><view class="filter-bar data-v-6f9cf068"><view class="filter-item data-v-6f9cf068"><text class="filter-label data-v-6f9cf068">状态：</text><picker value="{{statusIndex}}" range="{{statusOptions}}" data-event-opts="{{[['change',[['onStatusChange',['$event']]]]]}}" bindchange="__e" class="data-v-6f9cf068"><view class="picker-text data-v-6f9cf068">{{statusOptions[statusIndex]}}</view></picker></view><view class="filter-item data-v-6f9cf068"><text class="filter-label data-v-6f9cf068">类型：</text><picker value="{{typeIndex}}" range="{{typeOptions}}" data-event-opts="{{[['change',[['onTypeChange',['$event']]]]]}}" bindchange="__e" class="data-v-6f9cf068"><view class="picker-text data-v-6f9cf068">{{typeOptions[typeIndex]}}</view></picker></view></view><view class="order-list data-v-6f9cf068"><block wx:for="{{$root.l1}}" wx:for-item="order" wx:for-index="index" wx:key="_id"><view class="order-item data-v-6f9cf068"><view class="order-header data-v-6f9cf068"><view class="order-id data-v-6f9cf068">{{"订单号："+(order.$orig.orderNo||order.$orig._id)}}</view><view class="{{['order-status','data-v-6f9cf068',order.$orig.status==='待确认'?'status-pending':order.$orig.status==='已确认'?'status-confirmed':order.$orig.status==='已取消'?'status-cancelled':'status-default']}}">{{''+order.m0+''}}</view></view><view class="order-content data-v-6f9cf068"><view class="order-info data-v-6f9cf068"><view class="info-row data-v-6f9cf068"><text class="info-label data-v-6f9cf068">法会名称：</text><text class="info-value data-v-6f9cf068">{{order.$orig.fahuiName||order.$orig.fahuiProject&&order.$orig.fahuiProject.name||'-'}}</text></view><view class="info-row data-v-6f9cf068"><text class="info-label data-v-6f9cf068">报名人：</text><text class="info-value data-v-6f9cf068">{{order.g0}}</text></view><view class="info-row data-v-6f9cf068"><text class="info-label data-v-6f9cf068">金额：</text><text class="info-value price data-v-6f9cf068">{{"¥"+(order.$orig.amount||order.$orig.totalFee||0)}}</text></view><view class="info-row data-v-6f9cf068"><text class="info-label data-v-6f9cf068">状态：</text><text class="info-value data-v-6f9cf068">{{order.m1}}</text></view><view class="info-row data-v-6f9cf068"><text class="info-label data-v-6f9cf068">支付时间：</text><text class="info-value data-v-6f9cf068">{{order.$orig.payTime?order.m2:'-'}}</text></view><block wx:if="{{order.$orig.spouse&&order.$orig.spouse.name}}"><view class="info-row data-v-6f9cf068"><text class="info-label data-v-6f9cf068">配偶：</text><text class="info-value data-v-6f9cf068">{{order.$orig.spouse.name}}</text></view></block><block wx:if="{{order.$orig.chaoduType}}"><view class="info-row data-v-6f9cf068"><text class="info-label data-v-6f9cf068">超度类型：</text><text class="info-value data-v-6f9cf068">{{order.$orig.chaoduType}}</text></view></block><block wx:if="{{order.g1}}"><view class="info-row data-v-6f9cf068"><text class="info-label data-v-6f9cf068">代办物品：</text><text class="info-value data-v-6f9cf068">{{order.g2}}</text></view></block><block wx:if="{{order.$orig.receiver&&order.$orig.receiver.name}}"><view class="info-row data-v-6f9cf068"><text class="info-label data-v-6f9cf068">收件人：</text><text class="info-value data-v-6f9cf068">{{order.$orig.receiver.name}}</text></view></block></view></view><view class="order-actions data-v-6f9cf068"><button data-event-opts="{{[['tap',[['toggleDetail',[index]]]]]}}" class="action-btn detail-btn data-v-6f9cf068" bindtap="__e">{{showDetailIndex===index?'收起':'详情'}}</button><block wx:if="{{order.$orig.status==='待确认'}}"><button data-event-opts="{{[['tap',[['changeStatus',['$0'],[[['filteredOrders','_id',order.$orig._id]]]]]]]}}" class="action-btn status-btn data-v-6f9cf068" bindtap="__e">{{''+(order.$orig.status==='待确认'?'确认':'取消确认')+''}}</button></block><block wx:if="{{order.$orig.status==='待确认'}}"><button data-event-opts="{{[['tap',[['openFahuiDateDialog',['$0'],[[['filteredOrders','_id',order.$orig._id]]]]]]]}}" class="action-btn confirm-date-btn data-v-6f9cf068" bindtap="__e">专场日期确认</button></block><button data-event-opts="{{[['tap',[['toggleRemark',[index]]]]]}}" class="action-btn remark-btn data-v-6f9cf068" bindtap="__e">{{showRemarkIndex===index?'收起备注':'备注'}}</button><button data-event-opts="{{[['tap',[['deleteOrder',['$0'],[[['filteredOrders','_id',order.$orig._id,'_id']]]]]]]}}" class="action-btn delete-btn data-v-6f9cf068" bindtap="__e">删除</button></view><block wx:if="{{showDetailIndex===index}}"><view class="inline-detail data-v-6f9cf068"><view class="detail-section data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">订单详情</view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">法会名称：</text><text class="detail-value data-v-6f9cf068">{{order.$orig.fahuiName||order.$orig.fahuiProject&&order.$orig.fahuiProject.name||'-'}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">法会项目：</text><text class="detail-value data-v-6f9cf068">{{order.$orig.fahuiProject&&order.$orig.fahuiProject.name?order.$orig.fahuiProject.name:'-'}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">支付时间：</text><text class="detail-value data-v-6f9cf068">{{order.$orig.payTime?order.m3:'-'}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">金额：</text><text class="detail-value data-v-6f9cf068">{{"¥"+(order.$orig.amount||order.$orig.totalFee||0)}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">状态：</text><text class="detail-value data-v-6f9cf068">{{order.m4}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">专场法会日期：</text><input class="form-input data-v-6f9cf068" style="width:200rpx;display:inline-block;" type="date" data-event-opts="{{[['input',[['__set_model',['','inlineFahuiDate','$event',[]]]]]]}}" value="{{inlineFahuiDate}}" bindinput="__e"/><button data-event-opts="{{[['tap',[['confirmFahuiDate',['$0'],[[['filteredOrders','_id',order.$orig._id]]]]]]]}}" class="modal-btn confirm-btn data-v-6f9cf068" style="margin-left:16rpx;" bindtap="__e">确认</button></view></view></view></block><block wx:if="{{showRemarkIndex===index}}"><view class="inline-remark data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">备注</view><textarea class="form-textarea data-v-6f9cf068" placeholder="请输入备注内容" maxlength="200" data-event-opts="{{[['input',[['__set_model',['','inlineRemarkContent','$event',[]]]]]]}}" value="{{inlineRemarkContent}}" bindinput="__e"></textarea><button data-event-opts="{{[['tap',[['saveInlineRemark',['$0'],[[['filteredOrders','_id',order.$orig._id]]]]]]]}}" class="modal-btn confirm-btn data-v-6f9cf068" bindtap="__e">保存备注</button><block wx:if="{{order.g3}}"><view class="data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">历史备注</view><block wx:for="{{order.l0}}" wx:for-item="r" wx:for-index="i" wx:key="i"><view class="remark-item data-v-6f9cf068"><view class="remark-content data-v-6f9cf068">{{r.$orig.content}}</view><view class="remark-info data-v-6f9cf068"><text class="remark-author data-v-6f9cf068">{{r.$orig.author}}</text><text class="remark-time data-v-6f9cf068">{{r.m5}}</text></view></view></block></view></block></view></block></view></block></view><uni-popup vue-id="3dfff2ba-1" type="center" data-ref="detailModal" class="data-v-6f9cf068 vue-ref" bind:__l="__l" vue-slots="{{['default']}}"><view class="modal-content data-v-6f9cf068"><view class="modal-header data-v-6f9cf068"><text class="modal-title data-v-6f9cf068">订单详情</text><text data-event-opts="{{[['tap',[['hideDetailModal',['$event']]]]]}}" class="modal-close data-v-6f9cf068" bindtap="__e">×</text></view><block wx:if="{{selectedOrder}}"><view class="modal-body data-v-6f9cf068"><view class="detail-section data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">基本信息</view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">订单号：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.orderNo||selectedOrder._id}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">法会名称：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.fahuiName||selectedOrder.fahuiProject&&selectedOrder.fahuiProject.name||'-'}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">法会项目：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.fahuiProject&&selectedOrder.fahuiProject.name?selectedOrder.fahuiProject.name:'-'}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">报名时间：</text><text class="detail-value data-v-6f9cf068">{{$root.m6}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">支付时间：</text><text class="detail-value data-v-6f9cf068">{{$root.m7}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">支付方式：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.paymentMethod||'-'}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">金额：</text><text class="detail-value data-v-6f9cf068">{{"¥"+(selectedOrder.amount||selectedOrder.totalFee||0)}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">状态：</text><text class="detail-value data-v-6f9cf068">{{$root.m8}}</text></view><block wx:if="{{selectedOrder.remark}}"><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">备注：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.remark}}</text></view></block></view><block wx:if="{{$root.g4}}"><view class="detail-section data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">报名人信息</view><block wx:for="{{selectedOrder.applicants}}" wx:for-item="applicant" wx:for-index="idx" wx:key="idx"><view class="applicant-detail data-v-6f9cf068"><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">姓名：</text><text class="detail-value data-v-6f9cf068">{{applicant.name}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">性别：</text><text class="detail-value data-v-6f9cf068">{{applicant.gender}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">电话：</text><text class="detail-value data-v-6f9cf068">{{applicant.phone}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">农历生日：</text><text class="detail-value data-v-6f9cf068">{{applicant.lunarBirthday}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">出生时辰：</text><text class="detail-value data-v-6f9cf068">{{applicant.birthTime}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">常住地址：</text><text class="detail-value data-v-6f9cf068">{{applicant.address}}</text></view><view style="height:12rpx;" class="data-v-6f9cf068"></view></view></block></view></block><block wx:if="{{selectedOrder.spouse&&selectedOrder.spouse.name}}"><view class="detail-section data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">配偶信息</view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">姓名：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.spouse.name}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">性别：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.spouse.gender}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">电话：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.spouse.phone}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">农历生日：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.spouse.lunarBirthday}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">出生时辰：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.spouse.birthTime}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">常住地址：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.spouse.address}}</text></view></view></block><block wx:if="{{selectedOrder.chaoduType}}"><view class="detail-section data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">超度信息</view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">超度类型：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.chaoduType}}</text></view></view></block><block wx:if="{{$root.g5}}"><view class="detail-section data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">已故亲人信息</view><block wx:for="{{selectedOrder.deceasedList}}" wx:for-item="d" wx:for-index="i" wx:key="i"><view class="applicant-detail data-v-6f9cf068"><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">姓名：</text><text class="detail-value data-v-6f9cf068">{{d.name}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">关系：</text><text class="detail-value data-v-6f9cf068">{{d.relation}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">出生农历：</text><text class="detail-value data-v-6f9cf068">{{d.lunarBirthday}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">去世农历：</text><text class="detail-value data-v-6f9cf068">{{d.deathDate}}</text></view></view></block></view></block><block wx:if="{{$root.g6}}"><view class="detail-section data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">代办物品</view><block wx:for="{{selectedOrder.goods}}" wx:for-item="g" wx:for-index="i" wx:key="i"><view class="applicant-detail data-v-6f9cf068"><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">物品名称：</text><text class="detail-value data-v-6f9cf068">{{g.name}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">数量：</text><text class="detail-value data-v-6f9cf068">{{g.qty}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">单价：</text><text class="detail-value data-v-6f9cf068">{{"¥"+g.price}}</text></view></view></block></view></block><block wx:if="{{selectedOrder.receiver&&selectedOrder.receiver.name}}"><view class="detail-section data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">收件信息</view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">收件人：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.receiver.name}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">联系电话：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.receiver.phone}}</text></view><view class="detail-item data-v-6f9cf068"><text class="detail-label data-v-6f9cf068">收件地址：</text><text class="detail-value data-v-6f9cf068">{{selectedOrder.receiver.address}}</text></view></view></block><block wx:if="{{$root.g7}}"><view class="detail-section data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">管理备注</view><block wx:for="{{$root.l2}}" wx:for-item="remark" wx:for-index="index" wx:key="index"><view class="remark-item data-v-6f9cf068"><view class="remark-content data-v-6f9cf068">{{remark.$orig.content}}</view><view class="remark-info data-v-6f9cf068"><text class="remark-author data-v-6f9cf068">{{remark.$orig.author}}</text><text class="remark-time data-v-6f9cf068">{{remark.m9}}</text></view></view></block></view></block><block wx:if="{{$root.g8}}"><view class="detail-section data-v-6f9cf068"><view class="detail-title data-v-6f9cf068">操作日志</view><block wx:for="{{$root.l3}}" wx:for-item="log" wx:for-index="idx" wx:key="idx"><view class="remark-item data-v-6f9cf068"><view class="remark-content data-v-6f9cf068">{{log.$orig.action}}</view><view class="remark-info data-v-6f9cf068"><text class="remark-author data-v-6f9cf068">{{log.$orig.operator}}</text><text class="remark-time data-v-6f9cf068">{{log.m10}}</text></view></view></block></view></block></view></block><view class="modal-footer data-v-6f9cf068"><button data-event-opts="{{[['tap',[['hideDetailModal',['$event']]]]]}}" class="modal-btn confirm-btn data-v-6f9cf068" bindtap="__e">关闭</button></view></view></uni-popup><uni-popup vue-id="3dfff2ba-2" type="center" data-ref="remarkModal" class="data-v-6f9cf068 vue-ref" bind:__l="__l" vue-slots="{{['default']}}"><view class="modal-content data-v-6f9cf068"><view class="modal-header data-v-6f9cf068"><text class="modal-title data-v-6f9cf068">添加备注</text><text data-event-opts="{{[['tap',[['hideRemarkModal',['$event']]]]]}}" class="modal-close data-v-6f9cf068" bindtap="__e">×</text></view><view class="modal-body data-v-6f9cf068"><view class="form-group data-v-6f9cf068"><text class="form-label data-v-6f9cf068">备注内容</text><textarea class="form-textarea data-v-6f9cf068" placeholder="请输入备注内容" maxlength="200" data-event-opts="{{[['input',[['__set_model',['','remarkContent','$event',[]]]]]]}}" value="{{remarkContent}}" bindinput="__e"></textarea></view></view><view class="modal-footer data-v-6f9cf068"><button data-event-opts="{{[['tap',[['hideRemarkModal',['$event']]]]]}}" class="modal-btn data-v-6f9cf068" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['saveRemark',['$event']]]]]}}" class="modal-btn confirm-btn data-v-6f9cf068" bindtap="__e">保存</button></view></view></uni-popup><uni-popup bind:input="__e" vue-id="3dfff2ba-3" type="center" data-ref="fahuiDatePopup" value="{{showFahuiDatePopup}}" data-event-opts="{{[['^input',[['__set_model',['','showFahuiDatePopup','$event',[]]]]]]}}" class="data-v-6f9cf068 vue-ref" bind:__l="__l" vue-slots="{{['default']}}"><view class="modal-content data-v-6f9cf068"><view class="modal-header data-v-6f9cf068"><text class="modal-title data-v-6f9cf068">专场法会日期确认</text><text data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="modal-close data-v-6f9cf068" bindtap="__e">×</text></view><view class="modal-body data-v-6f9cf068"><view class="form-group data-v-6f9cf068"><text class="form-label data-v-6f9cf068">专场法会日期</text><input class="form-input data-v-6f9cf068" type="date" data-event-opts="{{[['input',[['__set_model',['','fahuiDateInput','$event',[]]]]]]}}" value="{{fahuiDateInput}}" bindinput="__e"/></view></view><view class="modal-footer data-v-6f9cf068"><button class="modal-btn confirm-btn data-v-6f9cf068" disabled="{{!fahuiDateInput}}" data-event-opts="{{[['tap',[['confirmFahuiDate',['$event']]]]]}}" bindtap="__e">确认</button></view></view></uni-popup></view>