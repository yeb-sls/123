<view class="admin-container data-v-23175a73"><view class="page-header data-v-23175a73"><view class="header-content data-v-23175a73"><view class="header-left data-v-23175a73"><text class="page-title data-v-23175a73">首页轮播图管理</text><text class="page-desc data-v-23175a73">管理小程序首页的轮播图片，支持拖拽排序</text></view><view class="header-actions data-v-23175a73"><button data-event-opts="{{[['tap',[['initDatabase',['$event']]]]]}}" class="init-btn data-v-23175a73" bindtap="__e"><text class="btn-icon data-v-23175a73">🔄</text><text class="data-v-23175a73">初始化</text></button><button data-event-opts="{{[['tap',[['showAddModal',['$event']]]]]}}" class="add-btn data-v-23175a73" bindtap="__e"><text class="btn-icon data-v-23175a73">➕</text><text class="data-v-23175a73">添加图片</text></button></view></view></view><view class="stats-card data-v-23175a73"><view class="stat-item data-v-23175a73"><text class="stat-number data-v-23175a73">{{$root.g0}}</text><text class="stat-label data-v-23175a73">总数量</text></view><view class="stat-item data-v-23175a73"><text class="stat-number data-v-23175a73">{{enabledCount}}</text><text class="stat-label data-v-23175a73">已启用</text></view><view class="stat-item data-v-23175a73"><text class="stat-number data-v-23175a73">{{disabledCount}}</text><text class="stat-label data-v-23175a73">已禁用</text></view></view><view class="banner-list data-v-23175a73"><view class="list-header data-v-23175a73"><text class="list-title data-v-23175a73">🖼️ 轮播图列表</text><text class="list-subtitle data-v-23175a73">{{"共 "+$root.g1+" 张图片"}}</text></view><block wx:if="{{$root.g2===0}}"><view class="empty-state data-v-23175a73"><text class="empty-icon data-v-23175a73">📷</text><text class="empty-title data-v-23175a73">暂无轮播图</text><text class="empty-desc data-v-23175a73">点击上方"添加图片"按钮开始创建</text><button data-event-opts="{{[['tap',[['showAddModal',['$event']]]]]}}" class="empty-btn data-v-23175a73" bindtap="__e">添加第一张图片</button></view></block><block wx:else><view class="banner-items data-v-23175a73"><block wx:for="{{$root.l0}}" wx:for-item="banner" wx:for-index="index" wx:key="_id"><view class="{{['banner-item','data-v-23175a73',(banner.$orig.status!=='启用')?'banner-disabled':'']}}"><view class="banner-preview data-v-23175a73"><image class="banner-img data-v-23175a73" src="{{banner.$orig.imageUrl}}" mode="aspectFill"></image><view class="banner-overlay data-v-23175a73"><view class="overlay-actions data-v-23175a73"><button data-event-opts="{{[['tap',[['editBanner',[index]]]]]}}" class="action-btn edit-btn data-v-23175a73" bindtap="__e"><text class="action-icon data-v-23175a73">✏️</text><text class="data-v-23175a73">编辑</text></button><button data-event-opts="{{[['tap',[['deleteBanner',[index]]]]]}}" class="action-btn delete-btn data-v-23175a73" bindtap="__e"><text class="action-icon data-v-23175a73">🗑️</text><text class="data-v-23175a73">删除</text></button></view></view><view class="{{['status-badge','data-v-23175a73',banner.$orig.status==='启用'?'status-enabled':'status-disabled']}}">{{''+banner.$orig.status+''}}</view></view><view class="banner-info data-v-23175a73"><view class="info-header data-v-23175a73"><text class="banner-title data-v-23175a73">{{banner.$orig.title||'未设置标题'}}</text><text class="banner-order data-v-23175a73">{{"#"+banner.$orig.order}}</text></view><text class="banner-desc data-v-23175a73">{{banner.$orig.description||'未设置描述'}}</text><view class="banner-actions data-v-23175a73"><view class="action-group data-v-23175a73"><button class="{{['sort-btn','data-v-23175a73',(index===0)?'btn-disabled':'']}}" style="background:#007aff;color:#fff;border:none;padding:10rpx 20rpx;border-radius:8rpx;font-size:24rpx;" disabled="{{index===0}}" data-event-opts="{{[['tap',[['moveBanner',[index,-1]]]],['tap',[['moveBanner',[index,-1]]]]]}}" bindtap="__e"><text class="sort-icon data-v-23175a73">⬆️</text><text class="data-v-23175a73">上移</text></button><button class="{{['sort-btn','data-v-23175a73',(index===banner.g3-1)?'btn-disabled':'']}}" style="background:#007aff;color:#fff;border:none;padding:10rpx 20rpx;border-radius:8rpx;font-size:24rpx;" disabled="{{index===banner.g4-1}}" data-event-opts="{{[['tap',[['moveBanner',[index,1]]]],['tap',[['moveBanner',[index,1]]]]]}}" bindtap="__e"><text class="sort-icon data-v-23175a73">⬇️</text><text class="data-v-23175a73">下移</text></button></view><view class="toggle-group data-v-23175a73"><text class="toggle-label data-v-23175a73">状态</text><switch checked="{{banner.$orig.status==='启用'}}" color="#007aff" data-event-opts="{{[['change',[['toggleBannerStatus',['$0','$event'],[[['banners','_id',banner.$orig._id]]]]]]]}}" bindchange="__e" class="data-v-23175a73"></switch></view></view></view></view></block></view></block></view><uni-popup vue-id="3fd474f3-1" show="{{showBannerPopup}}" type="center" data-event-opts="{{[['^close',[['closePopup']]]]}}" bind:close="__e" class="data-v-23175a73" bind:__l="__l" vue-slots="{{['default']}}"><view class="popup-content data-v-23175a73"><view class="popup-header data-v-23175a73"><text class="popup-title data-v-23175a73">{{isEdit?'编辑轮播图':'添加轮播图'}}</text><button data-event-opts="{{[['tap',[['closePopup',['$event']]]]]}}" class="close-btn data-v-23175a73" bindtap="__e">×</button></view><view class="form-container data-v-23175a73"><view class="form-group data-v-23175a73"><text class="form-label data-v-23175a73">图片标题 *</text><input class="form-input data-v-23175a73" placeholder="请输入图片标题" maxlength="50" data-event-opts="{{[['input',[['__set_model',['$0','title','$event',[]],['currentBanner']]]]]}}" value="{{currentBanner.title}}" bindinput="__e"/><text class="form-tip data-v-23175a73">{{$root.g5+"/50"}}</text></view><view class="form-group data-v-23175a73"><text class="form-label data-v-23175a73">图片描述</text><textarea class="form-textarea data-v-23175a73" placeholder="请输入图片描述" maxlength="200" data-event-opts="{{[['input',[['__set_model',['$0','description','$event',[]],['currentBanner']]]]]}}" value="{{currentBanner.description}}" bindinput="__e"></textarea><text class="form-tip data-v-23175a73">{{$root.g6+"/200"}}</text></view><view class="form-group data-v-23175a73"><text class="form-label data-v-23175a73">上传图片 *</text><view data-event-opts="{{[['tap',[['chooseImage',['$event']]]],['tap',[['chooseImage',['$event']]]],['touchstart',[['onUploadTouch',['$event']]]]]}}" class="upload-area data-v-23175a73" bindtap="__e" bindtouchstart="__e"><block wx:if="{{currentBanner.imageUrl}}"><image class="upload-preview data-v-23175a73" src="{{currentBanner.imageUrl}}" mode="aspectFill"></image></block><block wx:else><view class="upload-placeholder data-v-23175a73"><text class="upload-icon data-v-23175a73">📷</text><text class="upload-text data-v-23175a73">点击上传图片</text><text class="upload-tip data-v-23175a73">建议尺寸：750x400px，格式：JPG/PNG</text></view></block></view><button data-event-opts="{{[['tap',[['chooseImage',['$event']]]]]}}" class="test-btn data-v-23175a73" bindtap="__e">测试选择图片</button><button data-event-opts="{{[['tap',[['testChooseImage',['$event']]]]]}}" class="test-btn data-v-23175a73" style="margin-left:10rpx;" bindtap="__e">简单测试</button></view><view class="form-group data-v-23175a73"><text class="form-label data-v-23175a73">跳转链接（可选）</text><input class="form-input data-v-23175a73" placeholder="请输入跳转链接，如：/pages/detail" data-event-opts="{{[['input',[['__set_model',['$0','linkUrl','$event',[]],['currentBanner']]]]]}}" value="{{currentBanner.linkUrl}}" bindinput="__e"/></view></view><view class="popup-buttons data-v-23175a73"><button data-event-opts="{{[['tap',[['closePopup',['$event']]]]]}}" class="popup-btn cancel-btn data-v-23175a73" bindtap="__e">取消</button><button class="popup-btn primary-btn data-v-23175a73" disabled="{{loading}}" data-event-opts="{{[['tap',[['saveBanner',['$event']]]]]}}" bindtap="__e"><block wx:if="{{loading}}"><text class="data-v-23175a73">保存中...</text></block><block wx:else><text class="data-v-23175a73">{{isEdit?'更新':'保存'}}</text></block></button></view></view></uni-popup><block wx:if="{{loading}}"><view class="loading-overlay data-v-23175a73"><view class="loading-content data-v-23175a73"><text class="loading-icon data-v-23175a73">⏳</text><text class="loading-text data-v-23175a73">加载中...</text></view></view></block></view>