<view class="admin-container data-v-63362ca4"><view class="page-header data-v-63362ca4"><text class="page-title data-v-63362ca4">代办物品总览</text><text class="page-desc data-v-63362ca4">查看和管理所有项目的代办物品</text></view><view class="module-switch data-v-63362ca4"><view class="switch-item data-v-63362ca4"><text class="switch-label data-v-63362ca4">代办物品模块</text><switch checked="{{moduleEnabled}}" color="#667eea" data-event-opts="{{[['change',[['onModuleToggle',['$event']]]]]}}" bindchange="__e" class="data-v-63362ca4"></switch><text class="switch-desc data-v-63362ca4">{{moduleEnabled?'已启用':'已禁用'}}</text></view><text class="switch-tip data-v-63362ca4">启用后前台将显示代办物品选择功能</text></view><view class="stats-section data-v-63362ca4"><view class="stats-card data-v-63362ca4"><view class="stats-item data-v-63362ca4"><text class="stats-number data-v-63362ca4">{{totalProjects}}</text><text class="stats-label data-v-63362ca4">项目总数</text></view><view class="stats-item data-v-63362ca4"><text class="stats-number data-v-63362ca4">{{totalGoods}}</text><text class="stats-label data-v-63362ca4">物品总数</text></view><view class="stats-item data-v-63362ca4"><text class="stats-number data-v-63362ca4">{{projectsWithGoods}}</text><text class="stats-label data-v-63362ca4">有物品项目</text></view></view><view class="batch-actions data-v-63362ca4"><button data-event-opts="{{[['tap',[['showBatchAddPopup',['$event']]]]]}}" class="batch-btn data-v-63362ca4" bindtap="__e"><text class="batch-icon data-v-63362ca4">📦</text><text class="data-v-63362ca4">批量添加物品</text></button><button data-event-opts="{{[['tap',[['exportGoodsData',['$event']]]]]}}" class="batch-btn data-v-63362ca4" bindtap="__e"><text class="batch-icon data-v-63362ca4">📊</text><text class="data-v-63362ca4">导出物品数据</text></button></view></view><view class="projects-section data-v-63362ca4"><view class="section-title data-v-63362ca4">项目代办物品</view><block wx:if="{{loading}}"><view class="loading-container data-v-63362ca4"><view class="loading-spinner data-v-63362ca4"></view><text class="loading-text data-v-63362ca4">加载中...</text></view></block><block wx:else><block wx:if="{{$root.g0===0}}"><view class="empty-container data-v-63362ca4"><text class="empty-text data-v-63362ca4">暂无项目数据</text></view></block><block wx:else><view class="projects-list data-v-63362ca4"><block wx:for="{{$root.l1}}" wx:for-item="project" wx:for-index="index" wx:key="_id"><view class="project-card data-v-63362ca4"><view class="project-header data-v-63362ca4"><view class="project-info data-v-63362ca4"><text class="project-name data-v-63362ca4">{{project.$orig.name}}</text><text class="project-category data-v-63362ca4">{{project.$orig.category}}</text></view><view class="project-actions data-v-63362ca4"><button data-event-opts="{{[['tap',[['addGoods',['$0','$1'],[[['projects','_id',project.$orig._id,'_id']],[['projects','_id',project.$orig._id,'name']]]]]]]}}" class="action-btn add data-v-63362ca4" bindtap="__e">添加物品</button><button data-event-opts="{{[['tap',[['manageGoods',['$0','$1'],[[['projects','_id',project.$orig._id,'_id']],[['projects','_id',project.$orig._id,'name']]]]]]]}}" class="action-btn manage data-v-63362ca4" bindtap="__e">管理物品</button></view></view><view class="project-desc data-v-63362ca4">{{project.$orig.description}}</view><block wx:if="{{project.g1}}"><view class="goods-section data-v-63362ca4"><view class="goods-header data-v-63362ca4"><text class="goods-title data-v-63362ca4">{{"代办物品 ("+project.g2+"项)"}}</text></view><view class="goods-list data-v-63362ca4"><block wx:for="{{project.l0}}" wx:for-item="item" wx:for-index="itemIndex" wx:key="itemIndex"><view class="goods-item data-v-63362ca4"><block wx:if="{{!item.m0}}"><view class="goods-info data-v-63362ca4"><view class="goods-main data-v-63362ca4"><text class="goods-name data-v-63362ca4">{{item.$orig.name}}</text><text class="goods-price data-v-63362ca4">{{"¥"+item.$orig.price}}</text></view><view class="goods-details data-v-63362ca4"><block wx:if="{{item.$orig.maxQuantity}}"><text class="goods-quantity data-v-63362ca4">{{"最大可选: "+item.$orig.maxQuantity+"个"}}</text></block><block wx:if="{{item.$orig.description}}"><text class="goods-desc data-v-63362ca4">{{item.$orig.description}}</text></block></view></view></block><block wx:else><view class="goods-edit-form data-v-63362ca4"><view class="edit-form-row data-v-63362ca4"><view class="edit-form-group data-v-63362ca4"><text class="edit-label data-v-63362ca4">物品名称</text><input class="edit-input data-v-63362ca4" placeholder="请输入物品名称" maxlength="30" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['editingGood']]]]]}}" value="{{editingGood.name}}" bindinput="__e"/></view><view class="edit-form-group data-v-63362ca4"><text class="edit-label data-v-63362ca4">法金</text><input class="edit-input data-v-63362ca4" type="number" placeholder="请输入法金" min="0" step="0.01" data-event-opts="{{[['input',[['__set_model',['$0','price','$event',['number']],['editingGood']]]],['blur',[['$forceUpdate']]]]}}" value="{{editingGood.price}}" bindinput="__e" bindblur="__e"/></view></view><view class="edit-form-row data-v-63362ca4"><view class="edit-form-group data-v-63362ca4"><text class="edit-label data-v-63362ca4">最大可选数量</text><input class="edit-input data-v-63362ca4" type="number" placeholder="无限制" min="1" data-event-opts="{{[['input',[['__set_model',['$0','maxQuantity','$event',['number']],['editingGood']]]],['blur',[['$forceUpdate']]]]}}" value="{{editingGood.maxQuantity}}" bindinput="__e" bindblur="__e"/></view><view class="edit-form-group data-v-63362ca4"><text class="edit-label data-v-63362ca4">描述</text><input class="edit-input data-v-63362ca4" placeholder="物品描述（可选）" maxlength="200" data-event-opts="{{[['input',[['__set_model',['$0','description','$event',[]],['editingGood']]]]]}}" value="{{editingGood.description}}" bindinput="__e"/></view></view></view></block><view class="goods-actions data-v-63362ca4"><block wx:if="{{!item.m1}}"><view class="view-actions data-v-63362ca4"><button data-event-opts="{{[['tap',[['startEdit',['$0',itemIndex,'$1'],[[['projects','_id',project.$orig._id,'_id']],[['projects','_id',project.$orig._id],['goods','',itemIndex]]]]]]]}}" class="goods-btn edit data-v-63362ca4" bindtap="__e">编辑</button><button data-event-opts="{{[['tap',[['deleteGoods',['$0','$1',itemIndex],[[['projects','_id',project.$orig._id,'_id']],[['projects','_id',project.$orig._id,'name']]]]]]]}}" class="goods-btn delete data-v-63362ca4" bindtap="__e">删除</button></view></block><block wx:else><view class="edit-actions data-v-63362ca4"><button data-event-opts="{{[['tap',[['saveEdit',['$0',itemIndex],[[['projects','_id',project.$orig._id,'_id']]]]]]]}}" class="goods-btn save data-v-63362ca4" bindtap="__e">保存</button><button data-event-opts="{{[['tap',[['cancelEdit',['$event']]]]]}}" class="goods-btn cancel data-v-63362ca4" bindtap="__e">取消</button></view></block></view></view></block></view></view></block><block wx:else><view class="no-goods data-v-63362ca4"><text class="no-goods-text data-v-63362ca4">暂无代办物品</text><button data-event-opts="{{[['tap',[['addGoods',['$0','$1'],[[['projects','_id',project.$orig._id,'_id']],[['projects','_id',project.$orig._id,'name']]]]]]]}}" class="add-goods-btn data-v-63362ca4" bindtap="__e">添加第一个物品</button></view></block></view></block></view></block></block></view><uni-popup vue-id="038e65d0-1" show="{{showBatchPopup}}" type="center" data-event-opts="{{[['^close',[['closeBatchPopup']]]]}}" bind:close="__e" class="data-v-63362ca4" bind:__l="__l" vue-slots="{{['default']}}"><view class="popup-content data-v-63362ca4"><view class="popup-header data-v-63362ca4"><text class="popup-title data-v-63362ca4">批量添加物品</text><text data-event-opts="{{[['tap',[['closeBatchPopup',['$event']]]]]}}" class="popup-close data-v-63362ca4" bindtap="__e">×</text></view><view class="popup-body data-v-63362ca4"><view class="form-group data-v-63362ca4"><text class="form-label data-v-63362ca4">物品名称 *</text><input class="form-input data-v-63362ca4" placeholder="请输入物品名称" maxlength="30" data-event-opts="{{[['input',[['__set_model',['$0','name','$event',[]],['batchGood']]]]]}}" value="{{batchGood.name}}" bindinput="__e"/></view><view class="form-group data-v-63362ca4"><text class="form-label data-v-63362ca4">法金 (价格) *</text><input class="form-input data-v-63362ca4" type="number" placeholder="请输入法金金额" min="0" step="0.01" data-event-opts="{{[['input',[['__set_model',['$0','price','$event',['number']],['batchGood']]]],['blur',[['$forceUpdate']]]]}}" value="{{batchGood.price}}" bindinput="__e" bindblur="__e"/></view><view class="form-group data-v-63362ca4"><text class="form-label data-v-63362ca4">最大可选数量</text><input class="form-input data-v-63362ca4" type="number" placeholder="请输入最大可选数量" min="1" data-event-opts="{{[['input',[['__set_model',['$0','maxQuantity','$event',['number']],['batchGood']]]],['blur',[['$forceUpdate']]]]}}" value="{{batchGood.maxQuantity}}" bindinput="__e" bindblur="__e"/></view><view class="form-group data-v-63362ca4"><text class="form-label data-v-63362ca4">物品描述</text><textarea class="form-textarea data-v-63362ca4" placeholder="请输入物品描述（可选）" maxlength="200" data-event-opts="{{[['input',[['__set_model',['$0','description','$event',[]],['batchGood']]]]]}}" value="{{batchGood.description}}" bindinput="__e"></textarea></view><view class="form-group data-v-63362ca4"><text class="form-label data-v-63362ca4">选择项目</text><view class="project-checkboxes data-v-63362ca4"><block wx:for="{{projects}}" wx:for-item="project" wx:for-index="__i0__" wx:key="_id"><view class="checkbox-item data-v-63362ca4"><input type="checkbox" id="{{project._id}}" data-event-opts="{{[['change',[['e0',['$event']]]]]}}" data-event-params="{{({project,$$a,$$v,$$el,$$i,$$c})}}" value="{{project._id}}" checked="{{$root.g3?_i(batchGood.selectedProjects,project._id)>-1:batchGood.selectedProjects}}" bindchange="__e" class="data-v-63362ca4"/><label for="{{project._id}}" class="data-v-63362ca4">{{project.name}}</label></view></block></view></view></view><view class="popup-footer data-v-63362ca4"><button data-event-opts="{{[['tap',[['closeBatchPopup',['$event']]]]]}}" class="popup-btn cancel data-v-63362ca4" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['saveBatchGoods',['$event']]]]]}}" class="popup-btn confirm data-v-63362ca4" bindtap="__e">批量添加</button></view></view></uni-popup></view>