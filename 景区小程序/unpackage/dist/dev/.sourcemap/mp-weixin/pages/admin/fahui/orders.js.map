{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/小美女/Desktop/景区小程序/123/景区小程序/pages/admin/fahui/orders.vue?5628","webpack:///C:/Users/小美女/Desktop/景区小程序/123/景区小程序/pages/admin/fahui/orders.vue?4d38","webpack:///C:/Users/小美女/Desktop/景区小程序/123/景区小程序/pages/admin/fahui/orders.vue?f87c","webpack:///C:/Users/小美女/Desktop/景区小程序/123/景区小程序/pages/admin/fahui/orders.vue?b574","uni-app:///pages/admin/fahui/orders.vue","webpack:///C:/Users/小美女/Desktop/景区小程序/123/景区小程序/pages/admin/fahui/orders.vue?5029","webpack:///C:/Users/小美女/Desktop/景区小程序/123/景区小程序/pages/admin/fahui/orders.vue?2a83"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","components","uniPopup","data","fahuiType","orders","filteredOrders","statusOptions","statusIndex","typeOptions","typeIndex","selectedOrder","remarkContent","currentOrderForRemark","receiverEnabled","fahuiDateInput","showFahuiDatePopup","fahuiDateOrder","showDetailIndex","showRemarkIndex","inlineFahuiDate","inlineRemarkContent","onLoad","methods","goBack","uni","loadOrders","title","uniCloud","name","type","result","console","icon","filterOrders","filtered","onStatusChange","onTypeChange","getStatusClass","getStatusText","formatDate","viewDetail","hideDetailModal","changeStatus","newStatus","id","status","operator","deleteOrder","content","success","res","addRemark","saveRemark","remark","orderId","orderIndex","author","createTime","hideRemarkModal","getReceiverConfig","t","onReceiverSwitchChange","value","enabled","exportOrders","o","a","document","URL","openFahuiDateDialog","confirmFahuiDate","fahuiDate","toggleDetail","toggleRemark","order"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+H;AAC/H;AAC0D;AACL;AACqC;;;AAG1F;AACgN;AAChN,gBAAgB,iNAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,6FAAM;AACR,EAAE,sGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,iGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,8LAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC9JA;AAAA;AAAA;AAAA;AAAo0B,CAAgB,oyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCoRx1B;EACAC;IAAAC;EAAA;EACAC;IACA;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EAEAC;IACA;IACA;MACA;IACA;IACA;IACA;EACA;EAEAC;IACAC;MACAC;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAD;kBAAAE;gBAAA;gBAAA;gBAAA,OAEAC;kBACAC;kBACA1B;oBAAA2B;kBAAA;gBACA;cAAA;gBAHAC;gBAKA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAC;gBACAP;kBACAE;kBACAM;gBACA;cAAA;gBAAA;gBAEAR;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAS;MACA;;MAEA;MACA;QACA;QACAC;UAAA;QAAA;MACA;;MAEA;MACA;QACA;QACAA;UAAA;QAAA;MACA;MAEA;IACA;IAEA;IACAC;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;IACA;IAEA;IACAC;MACA;QACA;UACA;QACA;UACA;QACA;UACA;QACA;UACA;MAAA;IAEA;IAEA;IACAC;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACAT;MACA;QACA;MACA;QACA;MACA;IACA;IAEA;IACAU;MACA;MACA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAC;gBAAA;gBAEAnB;kBAAAE;gBAAA;gBAAA;gBAAA,OACAC;kBACAC;kBACA1B;oBACA0C;oBACAC;oBACAC;kBACA;gBACA;cAAA;gBAPAhB;gBAAA,M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","file":"pages/admin/fahui/orders.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/admin/fahui/orders.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./orders.vue?vue&type=template&id=6f9cf068&scoped=true&\"\nvar renderjs\nimport script from \"./orders.vue?vue&type=script&lang=js&\"\nexport * from \"./orders.vue?vue&type=script&lang=js&\"\nimport style0 from \"./orders.vue?vue&type=style&index=0&id=6f9cf068&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6f9cf068\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/admin/fahui/orders.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./orders.vue?vue&type=template&id=6f9cf068&scoped=true&\"","var components\ntry {\n  components = {\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"components/uni-popup/uni-popup\" */ \"@/components/uni-popup/uni-popup.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l1 = _vm.__map(_vm.filteredOrders, function (order, index) {\n    var $orig = _vm.__get_orig(order)\n    var m0 = _vm.getStatusText(order.status)\n    var g0 =\n      order.participantName ||\n      (order.applicants &&\n        order.applicants\n          .map(function (a) {\n            return a.name\n          })\n          .join(\"、\")) ||\n      \"-\"\n    var m1 = _vm.getStatusText(order.status)\n    var m2 = order.payTime ? _vm.formatDate(order.payTime) : null\n    var g1 = order.goods && order.goods.length\n    var g2 = g1\n      ? order.goods\n          .map(function (g) {\n            return g.name + \"×\" + g.qty\n          })\n          .join(\"，\")\n      : null\n    var m3 =\n      _vm.showDetailIndex === index && order.payTime\n        ? _vm.formatDate(order.payTime)\n        : null\n    var m4 =\n      _vm.showDetailIndex === index ? _vm.getStatusText(order.status) : null\n    var g3 =\n      _vm.showRemarkIndex === index\n        ? order.adminRemarks && order.adminRemarks.length\n        : null\n    var l0 =\n      _vm.showRemarkIndex === index && g3\n        ? _vm.__map(order.adminRemarks, function (r, i) {\n            var $orig = _vm.__get_orig(r)\n            var m5 = _vm.formatDate(r.createTime)\n            return {\n              $orig: $orig,\n              m5: m5,\n            }\n          })\n        : null\n    return {\n      $orig: $orig,\n      m0: m0,\n      g0: g0,\n      m1: m1,\n      m2: m2,\n      g1: g1,\n      g2: g2,\n      m3: m3,\n      m4: m4,\n      g3: g3,\n      l0: l0,\n    }\n  })\n  var m6 = _vm.selectedOrder\n    ? _vm.formatDate(_vm.selectedOrder.createTime)\n    : null\n  var m7 = _vm.selectedOrder ? _vm.formatDate(_vm.selectedOrder.payTime) : null\n  var m8 = _vm.selectedOrder\n    ? _vm.getStatusText(_vm.selectedOrder.status)\n    : null\n  var g4 = _vm.selectedOrder\n    ? _vm.selectedOrder.applicants && _vm.selectedOrder.applicants.length\n    : null\n  var g5 = _vm.selectedOrder\n    ? _vm.selectedOrder.deceasedList && _vm.selectedOrder.deceasedList.length\n    : null\n  var g6 = _vm.selectedOrder\n    ? _vm.selectedOrder.goods && _vm.selectedOrder.goods.length\n    : null\n  var g7 = _vm.selectedOrder\n    ? _vm.selectedOrder.adminRemarks &&\n      _vm.selectedOrder.adminRemarks.length > 0\n    : null\n  var l2 =\n    _vm.selectedOrder && g7\n      ? _vm.__map(_vm.selectedOrder.adminRemarks, function (remark, index) {\n          var $orig = _vm.__get_orig(remark)\n          var m9 = _vm.formatDate(remark.createTime)\n          return {\n            $orig: $orig,\n            m9: m9,\n          }\n        })\n      : null\n  var g8 = _vm.selectedOrder\n    ? _vm.selectedOrder.logs && _vm.selectedOrder.logs.length\n    : null\n  var l3 =\n    _vm.selectedOrder && g8\n      ? _vm.__map(_vm.selectedOrder.logs, function (log, idx) {\n          var $orig = _vm.__get_orig(log)\n          var m10 = _vm.formatDate(log.time)\n          return {\n            $orig: $orig,\n            m10: m10,\n          }\n        })\n      : null\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event) {\n      _vm.showFahuiDatePopup = false\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l1: l1,\n        m6: m6,\n        m7: m7,\n        m8: m8,\n        g4: g4,\n        g5: g5,\n        g6: g6,\n        g7: g7,\n        l2: l2,\n        g8: g8,\n        l3: l3,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./orders.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./orders.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"admin-container\">\r\n    <view class=\"header\">\r\n      <view class=\"back-btn\" @click=\"goBack\">\r\n        <text class=\"back-icon\">←</text>\r\n        <text class=\"back-text\">返回</text>\r\n      </view>\r\n      <view class=\"title\">{{ fahuiType === 'joint' ? '合坛法会' : '专场法会' }}订单管理</view>\r\n      <view class=\"refresh-btn\" @click=\"loadOrders\">\r\n        <text class=\"refresh-icon\">🔄</text>\r\n        <text class=\"refresh-text\">刷新</text>\r\n      </view>\r\n      <button class=\"export-btn\" @click=\"exportOrders\">导出订单</button>\r\n    </view>\r\n\r\n    <!-- 收件信息模块状态栏 -->\r\n    <view class=\"module-status-bar\">\r\n      <text>收件信息模块：</text>\r\n      <text :style=\"{color: receiverEnabled ? '#52c41a' : '#ff4d4f'}\">\r\n        {{ receiverEnabled ? '已启用' : '未启用' }}\r\n      </text>\r\n      <switch :checked=\"receiverEnabled\" @change=\"onReceiverSwitchChange\" style=\"margin-left: 24rpx;\" />\r\n    </view>\r\n\r\n    <!-- 筛选栏 -->\r\n    <view class=\"filter-bar\">\r\n      <view class=\"filter-item\">\r\n        <text class=\"filter-label\">状态：</text>\r\n        <picker @change=\"onStatusChange\" :value=\"statusIndex\" :range=\"statusOptions\">\r\n          <view class=\"picker-text\">{{ statusOptions[statusIndex] }}</view>\r\n        </picker>\r\n      </view>\r\n      <view class=\"filter-item\">\r\n        <text class=\"filter-label\">类型：</text>\r\n        <picker @change=\"onTypeChange\" :value=\"typeIndex\" :range=\"typeOptions\">\r\n          <view class=\"picker-text\">{{ typeOptions[typeIndex] }}</view>\r\n        </picker>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 订单列表 -->\r\n    <view class=\"order-list\">\r\n      <view v-for=\"(order, index) in filteredOrders\" :key=\"order._id\" class=\"order-item\">\r\n        <view class=\"order-header\">\r\n          <view class=\"order-id\">订单号：{{ order.orderNo || order._id }}</view>\r\n          <view class=\"order-status\" :class=\"order.status === '待确认' ? 'status-pending' : order.status === '已确认' ? 'status-confirmed' : order.status === '已取消' ? 'status-cancelled' : 'status-default'\">\r\n            {{ getStatusText(order.status) }}\r\n          </view>\r\n        </view>\r\n        \r\n        <view class=\"order-content\">\r\n          <view class=\"order-info\">\r\n            <view class=\"info-row\">\r\n              <text class=\"info-label\">法会名称：</text>\r\n              <text class=\"info-value\">{{ order.fahuiName || (order.fahuiProject && order.fahuiProject.name) || '-' }}</text>\r\n            </view>\r\n            <view class=\"info-row\">\r\n              <text class=\"info-label\">报名人：</text>\r\n              <text class=\"info-value\">{{ order.participantName || (order.applicants && order.applicants.map(a=>a.name).join('、')) || '-' }}</text>\r\n            </view>\r\n            <view class=\"info-row\">\r\n              <text class=\"info-label\">金额：</text>\r\n              <text class=\"info-value price\">¥{{ order.amount || order.totalFee || 0 }}</text>\r\n            </view>\r\n            <view class=\"info-row\">\r\n              <text class=\"info-label\">状态：</text>\r\n              <text class=\"info-value\">{{ getStatusText(order.status) }}</text>\r\n            </view>\r\n            <view class=\"info-row\">\r\n              <text class=\"info-label\">支付时间：</text>\r\n              <text class=\"info-value\">{{ order.payTime ? formatDate(order.payTime) : '-' }}</text>\r\n            </view>\r\n            <view class=\"info-row\" v-if=\"order.spouse && order.spouse.name\">\r\n              <text class=\"info-label\">配偶：</text>\r\n              <text class=\"info-value\">{{ order.spouse.name }}</text>\r\n            </view>\r\n            <view class=\"info-row\" v-if=\"order.chaoduType\">\r\n              <text class=\"info-label\">超度类型：</text>\r\n              <text class=\"info-value\">{{ order.chaoduType }}</text>\r\n            </view>\r\n            <view class=\"info-row\" v-if=\"order.goods && order.goods.length\">\r\n              <text class=\"info-label\">代办物品：</text>\r\n              <text class=\"info-value\">{{ order.goods.map(g => g.name + '×' + g.qty).join('，') }}</text>\r\n            </view>\r\n            <view class=\"info-row\" v-if=\"order.receiver && order.receiver.name\">\r\n              <text class=\"info-label\">收件人：</text>\r\n              <text class=\"info-value\">{{ order.receiver.name }}</text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n        \r\n        <view class=\"order-actions\">\r\n          <button class=\"action-btn detail-btn\" @click=\"toggleDetail(index)\">{{ showDetailIndex === index ? '收起' : '详情' }}</button>\r\n          <button class=\"action-btn status-btn\" @click=\"changeStatus(order)\" v-if=\"order.status === '待确认'\">\r\n            {{ order.status === '待确认' ? '确认' : '取消确认' }}\r\n          </button>\r\n          <button class=\"action-btn confirm-date-btn\" v-if=\"order.status === '待确认'\" @click=\"openFahuiDateDialog(order)\">专场日期确认</button>\r\n          <button class=\"action-btn remark-btn\" @click=\"toggleRemark(index)\">{{ showRemarkIndex === index ? '收起备注' : '备注' }}</button>\r\n          <button class=\"action-btn delete-btn\" @click=\"deleteOrder(order._id)\">删除</button>\r\n        </view>\r\n        <!-- 详情内联区 -->\r\n        <view v-if=\"showDetailIndex === index\" class=\"inline-detail\">\r\n          <view class=\"detail-section\">\r\n            <view class=\"detail-title\">订单详情</view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">法会名称：</text><text class=\"detail-value\">{{ order.fahuiName || (order.fahuiProject && order.fahuiProject.name) || '-' }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">法会项目：</text><text class=\"detail-value\">{{ order.fahuiProject && order.fahuiProject.name ? order.fahuiProject.name : '-' }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">支付时间：</text><text class=\"detail-value\">{{ order.payTime ? formatDate(order.payTime) : '-' }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">金额：</text><text class=\"detail-value\">¥{{ order.amount || order.totalFee || 0 }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">状态：</text><text class=\"detail-value\">{{ getStatusText(order.status) }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">专场法会日期：</text>\r\n              <input v-model=\"inlineFahuiDate\" type=\"date\" class=\"form-input\" style=\"width:200rpx;display:inline-block;\" />\r\n              <button class=\"modal-btn confirm-btn\" style=\"margin-left:16rpx;\" @click=\"confirmFahuiDate(order)\">确认</button>\r\n            </view>\r\n            <!-- 可补充更多字段 -->\r\n          </view>\r\n        </view>\r\n        <!-- 备注内联区 -->\r\n        <view v-if=\"showRemarkIndex === index\" class=\"inline-remark\">\r\n          <view class=\"detail-title\">备注</view>\r\n          <textarea v-model=\"inlineRemarkContent\" class=\"form-textarea\" placeholder=\"请输入备注内容\" maxlength=\"200\" />\r\n          <button class=\"modal-btn confirm-btn\" @click=\"saveInlineRemark(order)\">保存备注</button>\r\n          <view v-if=\"order.adminRemarks && order.adminRemarks.length\">\r\n            <view class=\"detail-title\">历史备注</view>\r\n            <view v-for=\"(r, i) in order.adminRemarks\" :key=\"i\" class=\"remark-item\">\r\n              <view class=\"remark-content\">{{ r.content }}</view>\r\n              <view class=\"remark-info\"><text class=\"remark-author\">{{ r.author }}</text><text class=\"remark-time\">{{ formatDate(r.createTime) }}</text></view>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 订单详情弹窗 -->\r\n    <uni-popup ref=\"detailModal\" type=\"center\">\r\n      <view class=\"modal-content\">\r\n        <view class=\"modal-header\">\r\n          <text class=\"modal-title\">订单详情</text>\r\n          <text class=\"modal-close\" @click=\"hideDetailModal\">×</text>\r\n        </view>\r\n        \r\n        <view class=\"modal-body\" v-if=\"selectedOrder\">\r\n          <view class=\"detail-section\">\r\n            <view class=\"detail-title\">基本信息</view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">订单号：</text><text class=\"detail-value\">{{ selectedOrder.orderNo || selectedOrder._id }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">法会名称：</text><text class=\"detail-value\">{{ selectedOrder.fahuiName || (selectedOrder.fahuiProject && selectedOrder.fahuiProject.name) || '-' }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">法会项目：</text><text class=\"detail-value\">{{ selectedOrder.fahuiProject && selectedOrder.fahuiProject.name ? selectedOrder.fahuiProject.name : '-' }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">报名时间：</text><text class=\"detail-value\">{{ formatDate(selectedOrder.createTime) }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">支付时间：</text><text class=\"detail-value\">{{ formatDate(selectedOrder.payTime) }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">支付方式：</text><text class=\"detail-value\">{{ selectedOrder.paymentMethod || '-' }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">金额：</text><text class=\"detail-value\">¥{{ selectedOrder.amount || selectedOrder.totalFee || 0 }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">状态：</text><text class=\"detail-value\">{{ getStatusText(selectedOrder.status) }}</text></view>\r\n            <view class=\"detail-item\" v-if=\"selectedOrder.remark\"><text class=\"detail-label\">备注：</text><text class=\"detail-value\">{{ selectedOrder.remark }}</text></view>\r\n          </view>\r\n          <view class=\"detail-section\" v-if=\"selectedOrder.applicants && selectedOrder.applicants.length\">\r\n            <view class=\"detail-title\">报名人信息</view>\r\n            <view v-for=\"(applicant, idx) in selectedOrder.applicants\" :key=\"idx\" class=\"applicant-detail\">\r\n              <view class=\"detail-item\"><text class=\"detail-label\">姓名：</text><text class=\"detail-value\">{{ applicant.name }}</text></view>\r\n              <view class=\"detail-item\"><text class=\"detail-label\">性别：</text><text class=\"detail-value\">{{ applicant.gender }}</text></view>\r\n              <view class=\"detail-item\"><text class=\"detail-label\">电话：</text><text class=\"detail-value\">{{ applicant.phone }}</text></view>\r\n              <view class=\"detail-item\"><text class=\"detail-label\">农历生日：</text><text class=\"detail-value\">{{ applicant.lunarBirthday }}</text></view>\r\n              <view class=\"detail-item\"><text class=\"detail-label\">出生时辰：</text><text class=\"detail-value\">{{ applicant.birthTime }}</text></view>\r\n              <view class=\"detail-item\"><text class=\"detail-label\">常住地址：</text><text class=\"detail-value\">{{ applicant.address }}</text></view>\r\n              <view style=\"height:12rpx;\"></view>\r\n            </view>\r\n          </view>\r\n          <view class=\"detail-section\" v-if=\"selectedOrder.spouse && selectedOrder.spouse.name\">\r\n            <view class=\"detail-title\">配偶信息</view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">姓名：</text><text class=\"detail-value\">{{ selectedOrder.spouse.name }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">性别：</text><text class=\"detail-value\">{{ selectedOrder.spouse.gender }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">电话：</text><text class=\"detail-value\">{{ selectedOrder.spouse.phone }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">农历生日：</text><text class=\"detail-value\">{{ selectedOrder.spouse.lunarBirthday }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">出生时辰：</text><text class=\"detail-value\">{{ selectedOrder.spouse.birthTime }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">常住地址：</text><text class=\"detail-value\">{{ selectedOrder.spouse.address }}</text></view>\r\n          </view>\r\n          <view class=\"detail-section\" v-if=\"selectedOrder.chaoduType\">\r\n            <view class=\"detail-title\">超度信息</view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">超度类型：</text><text class=\"detail-value\">{{ selectedOrder.chaoduType }}</text></view>\r\n          </view>\r\n          <view class=\"detail-section\" v-if=\"selectedOrder.deceasedList && selectedOrder.deceasedList.length\">\r\n            <view class=\"detail-title\">已故亲人信息</view>\r\n            <view v-for=\"(d, i) in selectedOrder.deceasedList\" :key=\"i\" class=\"applicant-detail\">\r\n              <view class=\"detail-item\"><text class=\"detail-label\">姓名：</text><text class=\"detail-value\">{{ d.name }}</text></view>\r\n              <view class=\"detail-item\"><text class=\"detail-label\">关系：</text><text class=\"detail-value\">{{ d.relation }}</text></view>\r\n              <view class=\"detail-item\"><text class=\"detail-label\">出生农历：</text><text class=\"detail-value\">{{ d.lunarBirthday }}</text></view>\r\n              <view class=\"detail-item\"><text class=\"detail-label\">去世农历：</text><text class=\"detail-value\">{{ d.deathDate }}</text></view>\r\n            </view>\r\n          </view>\r\n          <view class=\"detail-section\" v-if=\"selectedOrder.goods && selectedOrder.goods.length\">\r\n            <view class=\"detail-title\">代办物品</view>\r\n            <view v-for=\"(g, i) in selectedOrder.goods\" :key=\"i\" class=\"applicant-detail\">\r\n              <view class=\"detail-item\"><text class=\"detail-label\">物品名称：</text><text class=\"detail-value\">{{ g.name }}</text></view>\r\n              <view class=\"detail-item\"><text class=\"detail-label\">数量：</text><text class=\"detail-value\">{{ g.qty }}</text></view>\r\n              <view class=\"detail-item\"><text class=\"detail-label\">单价：</text><text class=\"detail-value\">¥{{ g.price }}</text></view>\r\n            </view>\r\n          </view>\r\n          <view class=\"detail-section\" v-if=\"selectedOrder.receiver && selectedOrder.receiver.name\">\r\n            <view class=\"detail-title\">收件信息</view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">收件人：</text><text class=\"detail-value\">{{ selectedOrder.receiver.name }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">联系电话：</text><text class=\"detail-value\">{{ selectedOrder.receiver.phone }}</text></view>\r\n            <view class=\"detail-item\"><text class=\"detail-label\">收件地址：</text><text class=\"detail-value\">{{ selectedOrder.receiver.address }}</text></view>\r\n          </view>\r\n          \r\n          <view class=\"detail-section\" v-if=\"selectedOrder.adminRemarks && selectedOrder.adminRemarks.length > 0\">\r\n            <view class=\"detail-title\">管理备注</view>\r\n            <view v-for=\"(remark, index) in selectedOrder.adminRemarks\" :key=\"index\" class=\"remark-item\">\r\n              <view class=\"remark-content\">{{ remark.content }}</view>\r\n              <view class=\"remark-info\">\r\n                <text class=\"remark-author\">{{ remark.author }}</text>\r\n                <text class=\"remark-time\">{{ formatDate(remark.createTime) }}</text>\r\n              </view>\r\n            </view>\r\n          </view>\r\n\r\n          <view class=\"detail-section\" v-if=\"selectedOrder.logs && selectedOrder.logs.length\">\r\n            <view class=\"detail-title\">操作日志</view>\r\n            <view v-for=\"(log, idx) in selectedOrder.logs\" :key=\"idx\" class=\"remark-item\">\r\n              <view class=\"remark-content\">{{ log.action }}</view>\r\n              <view class=\"remark-info\">\r\n                <text class=\"remark-author\">{{ log.operator }}</text>\r\n                <text class=\"remark-time\">{{ formatDate(log.time) }}</text>\r\n              </view>\r\n            </view>\r\n          </view>\r\n        </view>\r\n        \r\n        <view class=\"modal-footer\">\r\n          <button class=\"modal-btn confirm-btn\" @click=\"hideDetailModal\">关闭</button>\r\n        </view>\r\n      </view>\r\n    </uni-popup>\r\n\r\n    <!-- 备注弹窗 -->\r\n    <uni-popup ref=\"remarkModal\" type=\"center\">\r\n      <view class=\"modal-content\">\r\n        <view class=\"modal-header\">\r\n          <text class=\"modal-title\">添加备注</text>\r\n          <text class=\"modal-close\" @click=\"hideRemarkModal\">×</text>\r\n        </view>\r\n        \r\n        <view class=\"modal-body\">\r\n          <view class=\"form-group\">\r\n            <text class=\"form-label\">备注内容</text>\r\n            <textarea v-model=\"remarkContent\" placeholder=\"请输入备注内容\" class=\"form-textarea\" maxlength=\"200\" />\r\n          </view>\r\n        </view>\r\n        \r\n        <view class=\"modal-footer\">\r\n          <button class=\"modal-btn\" @click=\"hideRemarkModal\">取消</button>\r\n          <button class=\"modal-btn confirm-btn\" @click=\"saveRemark\">保存</button>\r\n        </view>\r\n      </view>\r\n    </uni-popup>\r\n\r\n    <!-- 专场法会日期确认弹窗 -->\r\n    <uni-popup ref=\"fahuiDatePopup\" v-model=\"showFahuiDatePopup\" type=\"center\">\r\n      <view class=\"modal-content\">\r\n        <view class=\"modal-header\">\r\n          <text class=\"modal-title\">专场法会日期确认</text>\r\n          <text class=\"modal-close\" @click=\"showFahuiDatePopup=false\">×</text>\r\n        </view>\r\n        <view class=\"modal-body\">\r\n          <view class=\"form-group\">\r\n            <text class=\"form-label\">专场法会日期</text>\r\n            <input v-model=\"fahuiDateInput\" type=\"date\" class=\"form-input\" />\r\n          </view>\r\n        </view>\r\n        <view class=\"modal-footer\">\r\n          <button class=\"modal-btn confirm-btn\" :disabled=\"!fahuiDateInput\" @click=\"confirmFahuiDate\">确认</button>\r\n        </view>\r\n      </view>\r\n    </uni-popup>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport uniPopup from '@/components/uni-popup/uni-popup.vue'\r\nexport default {\r\n  components: { uniPopup },\r\n  data() {\r\n    return {\r\n      fahuiType: 'special', // 默认专场法会\r\n      orders: [],\r\n      filteredOrders: [],\r\n      statusOptions: ['全部', '待确认', '已确认', '已取消'],\r\n      statusIndex: 0,\r\n      typeOptions: ['全部', '专场法会', '合坛法会'],\r\n      typeIndex: 0,\r\n      selectedOrder: null,\r\n      remarkContent: '',\r\n      currentOrderForRemark: null,\r\n      receiverEnabled: false,\r\n      fahuiDateInput: '',\r\n      showFahuiDatePopup: false,\r\n      fahuiDateOrder: null,\r\n      showDetailIndex: -1,\r\n      showRemarkIndex: -1,\r\n      inlineFahuiDate: '',\r\n      inlineRemarkContent: '',\r\n    }\r\n  },\r\n  \r\n  onLoad(options) {\r\n    // 获取法会类型参数\r\n    if (options.type) {\r\n      this.fahuiType = options.type;\r\n    }\r\n    this.loadOrders()\r\n    this.getReceiverConfig()\r\n  },\r\n  \r\n  methods: {\r\n    goBack() {\r\n      uni.navigateBack()\r\n    },\r\n    \r\n    // 加载订单列表\r\n    async loadOrders() {\r\n      try {\r\n        uni.showLoading({ title: '加载中...' })\r\n        \r\n        const result = await uniCloud.callFunction({\r\n          name: 'getFahuiOrders',\r\n          data: { type: this.fahuiType }\r\n        })\r\n        \r\n        if (result.result && result.result.data) {\r\n          this.orders = result.result.data\r\n          this.filterOrders()\r\n        }\r\n      } catch (error) {\r\n        console.error('加载订单失败：', error)\r\n        uni.showToast({\r\n          title: '加载失败',\r\n          icon: 'none'\r\n        })\r\n      } finally {\r\n        uni.hideLoading()\r\n      }\r\n    },\r\n    \r\n    // 筛选订单\r\n    filterOrders() {\r\n      let filtered = [...this.orders]\r\n      \r\n      // 按状态筛选\r\n      if (this.statusIndex > 0) {\r\n        const status = this.statusOptions[this.statusIndex]\r\n        filtered = filtered.filter(item => item.status === status)\r\n      }\r\n      \r\n      // 按类型筛选\r\n      if (this.typeIndex > 0) {\r\n        const type = this.typeOptions[this.typeIndex]\r\n        filtered = filtered.filter(item => item.fahuiType === type)\r\n      }\r\n      \r\n      this.filteredOrders = filtered\r\n    },\r\n    \r\n    // 状态筛选变化\r\n    onStatusChange(e) {\r\n      this.statusIndex = e.detail.value\r\n      this.filterOrders()\r\n    },\r\n    \r\n    // 类型筛选变化\r\n    onTypeChange(e) {\r\n      this.typeIndex = e.detail.value\r\n      this.filterOrders()\r\n    },\r\n    \r\n    // 获取状态样式\r\n    getStatusClass(status) {\r\n      switch (status) {\r\n        case '待确认':\r\n          return 'status-pending'\r\n        case '已确认':\r\n          return 'status-confirmed'\r\n        case '已取消':\r\n          return 'status-cancelled'\r\n        default:\r\n          return 'status-default'\r\n      }\r\n    },\r\n    \r\n    // 获取状态文本\r\n    getStatusText(status) {\r\n      return status || '未知'\r\n    },\r\n    \r\n    // 格式化日期\r\n    formatDate(date) {\r\n      if (!date) return ''\r\n      const d = new Date(date)\r\n      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')} ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`\r\n    },\r\n    \r\n    // 查看详情\r\n    viewDetail(order) {\r\n      this.selectedOrder = order\r\n      this.fahuiDateInput = order.fahuiDate || ''\r\n      console.log('detailModal ref:', this.$refs.detailModal)\r\n      if (this.$refs.detailModal && typeof this.$refs.detailModal.open === 'function') {\r\n        this.$refs.detailModal.open('center')\r\n      } else if (this.$refs.detailModal && typeof this.$refs.detailModal.show === 'function') {\r\n        this.$refs.detailModal.show()\r\n      }\r\n    },\r\n    \r\n    // 隐藏详情弹窗\r\n    hideDetailModal() {\r\n      this.$refs.detailModal.close()\r\n      this.selectedOrder = null\r\n    },\r\n    \r\n    // 更改状态\r\n    async changeStatus(order) {\r\n      const newStatus = order.status === '待确认' ? '已确认' : '待确认'\r\n      try {\r\n        uni.showLoading({ title: '更新中...' })\r\n        const result = await uniCloud.callFunction({\r\n          name: 'updateFahuiOrderStatus',\r\n          data: {\r\n            id: order._id,\r\n            status: newStatus,\r\n            operator: '管理员' // 可替换为当前登录用户\r\n          }\r\n        })\r\n        if (result.result && result.result.success) {\r\n          uni.showToast({\r\n            title: '状态更新成功',\r\n            icon: 'success'\r\n          })\r\n          this.loadOrders()\r\n        } else {\r\n          throw new Error(result.result.message || '更新失败')\r\n        }\r\n      } catch (error) {\r\n        console.error('更新状态失败：', error)\r\n        uni.showToast({\r\n          title: '更新失败',\r\n          icon: 'none'\r\n        })\r\n      } finally {\r\n        uni.hideLoading()\r\n      }\r\n    },\r\n    \r\n    // 删除订单\r\n    deleteOrder(id) {\r\n      uni.showModal({\r\n        title: '确认删除',\r\n        content: '确定要删除这个订单吗？',\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            try {\r\n              uni.showLoading({ title: '删除中...' })\r\n              \r\n              const result = await uniCloud.callFunction({\r\n                name: 'deleteFahuiOrder',\r\n                data: { id }\r\n              })\r\n              \r\n              if (result.result && result.result.success) {\r\n                uni.showToast({\r\n                  title: '删除成功',\r\n                  icon: 'success'\r\n                })\r\n                this.loadOrders()\r\n              } else {\r\n                throw new Error(result.result.message || '删除失败')\r\n              }\r\n            } catch (error) {\r\n              console.error('删除失败：', error)\r\n              uni.showToast({\r\n                title: '删除失败',\r\n                icon: 'none'\r\n              })\r\n            } finally {\r\n              uni.hideLoading()\r\n            }\r\n          }\r\n        }\r\n      })\r\n    },\r\n    \r\n    // 添加备注\r\n    addRemark(order) {\r\n      this.currentOrderForRemark = order\r\n      this.remarkContent = ''\r\n      console.log('remarkModal ref:', this.$refs.remarkModal)\r\n      if (this.$refs.remarkModal && typeof this.$refs.remarkModal.open === 'function') {\r\n        this.$refs.remarkModal.open('center')\r\n      } else if (this.$refs.remarkModal && typeof this.$refs.remarkModal.show === 'function') {\r\n        this.$refs.remarkModal.show()\r\n      }\r\n    },\r\n    \r\n    // 保存备注\r\n    async saveRemark() {\r\n      if (!this.remarkContent.trim()) {\r\n        uni.showToast({\r\n          title: '请输入备注内容',\r\n          icon: 'none'\r\n        })\r\n        return\r\n      }\r\n      try {\r\n        const remark = {\r\n          content: this.remarkContent\r\n        }\r\n        await uniCloud.callFunction({\r\n          name: 'addFahuiOrderRemark',\r\n          data: {\r\n            orderId: this.currentOrderForRemark._id,\r\n            remark: remark,\r\n            operator: '管理员' // 可替换为当前登录用户\r\n          }\r\n        })\r\n        // 更新本地数据\r\n        const orderIndex = this.orders.findIndex(o => o._id === this.currentOrderForRemark._id)\r\n        if (orderIndex !== -1) {\r\n          if (!this.orders[orderIndex].adminRemarks) {\r\n            this.orders[orderIndex].adminRemarks = []\r\n          }\r\n          this.orders[orderIndex].adminRemarks.push({ ...remark, author: '管理员', createTime: new Date() })\r\n        }\r\n        this.hideRemarkModal()\r\n        uni.showToast({\r\n          title: '备注添加成功',\r\n          icon: 'success'\r\n        })\r\n      } catch (error) {\r\n        console.error('添加备注失败：', error)\r\n        uni.showToast({\r\n          title: '添加备注失败',\r\n          icon: 'none'\r\n        })\r\n      }\r\n    },\r\n    \r\n    // 隐藏备注弹窗\r\n    hideRemarkModal() {\r\n      this.$refs.remarkModal.close()\r\n      this.currentOrderForRemark = null\r\n      this.remarkContent = ''\r\n    },\r\n\r\n    async getReceiverConfig() {\r\n      try {\r\n        const res = await uniCloud.callFunction({ name: 'getFahuiReceiverConfig', data: { t: Date.now() } })\r\n        console.log('[调试] getFahuiReceiverConfig 返回:', res)\r\n        // 兼容 enabled 字段在 result 或根对象\r\n        this.receiverEnabled = !!((res.result && typeof res.result.enabled !== 'undefined' ? res.result.enabled : res.enabled))\r\n      } catch (e) {\r\n        this.receiverEnabled = false\r\n      }\r\n    },\r\n    async onReceiverSwitchChange(e) {\r\n      const value = e.detail.value\r\n      try {\r\n        await uniCloud.callFunction({ name: 'updateFahuiReceiverConfig', data: { enabled: value } })\r\n        this.receiverEnabled = value\r\n        uni.showToast({ title: value ? '已启用' : '已关闭', icon: 'success' })\r\n      } catch (e) {\r\n        uni.showToast({ title: '设置失败', icon: 'none' })\r\n      }\r\n    },\r\n    exportOrders() {\r\n      // 导出当前筛选结果为CSV\r\n      const headers = [\r\n        '订单号','法会名称','法会项目','报名人','配偶','超度类型','已故亲人','代办物品','收件人','金额','支付方式','支付时间','报名时间','专场法会日期','状态','备注'\r\n      ]\r\n      const rows = this.filteredOrders.map(o => [\r\n        o.orderNo || o._id,\r\n        o.fahuiName || (o.fahuiProject && o.fahuiProject.name) || '',\r\n        o.fahuiProject && o.fahuiProject.name ? o.fahuiProject.name : '',\r\n        (o.applicants && o.applicants.length) ? o.applicants.map(a => `${a.name}/${a.phone}`).join('；') : '',\r\n        o.spouse && o.spouse.name ? o.spouse.name : '',\r\n        o.chaoduType || '',\r\n        (o.deceasedList && o.deceasedList.length) ? o.deceasedList.map(d => `${d.name}/${d.relation}`).join('；') : '',\r\n        (o.goods && o.goods.length) ? o.goods.map(g => `${g.name}×${g.qty}`).join('；') : '',\r\n        o.receiver && o.receiver.name ? o.receiver.name : '',\r\n        o.amount || o.totalFee || 0,\r\n        o.paymentMethod || '',\r\n        o.payTime ? this.formatDate(o.payTime) : '',\r\n        o.createTime ? this.formatDate(o.createTime) : '',\r\n        o.fahuiDate || '',\r\n        this.getStatusText(o.status),\r\n        (o.adminRemarks && o.adminRemarks.length) ? o.adminRemarks[o.adminRemarks.length-1].content : (o.remark || '')\r\n      ])\r\n      // 加 BOM 兼容 Excel\r\n      const csv = '\\uFEFF' + [headers, ...rows].map(row => row.map(v => `\"${(v||'').toString().replace(/\"/g,'\"\"')}\"`).join(',')).join('\\n')\r\n      // 创建下载\r\n      const blob = new Blob([csv], { type: 'text/csv' })\r\n      const url = URL.createObjectURL(blob)\r\n      const a = document.createElement('a')\r\n      a.href = url\r\n      a.download = 'fahui_orders.csv'\r\n      document.body.appendChild(a)\r\n      a.click()\r\n      document.body.removeChild(a)\r\n      URL.revokeObjectURL(url)\r\n      uni.showToast({ title: '导出成功', icon: 'success' })\r\n    },\r\n    openFahuiDateDialog(order) {\r\n      this.fahuiDateOrder = order\r\n      this.fahuiDateInput = order.fahuiDate || ''\r\n      this.showFahuiDatePopup = true\r\n    },\r\n    async confirmFahuiDate() {\r\n      if (!this.fahuiDateOrder || !this.fahuiDateInput) return\r\n      try {\r\n        uni.showLoading({ title: '确认中...' })\r\n        const result = await uniCloud.callFunction({\r\n          name: 'updateFahuiOrderStatus',\r\n          data: {\r\n            id: this.fahuiDateOrder._id,\r\n            status: '已确认',\r\n            fahuiDate: this.fahuiDateInput,\r\n            operator: '管理员' // 可替换为当前登录用户\r\n          }\r\n        })\r\n        if (result.result && result.result.success) {\r\n          uni.showToast({ title: '专场法会已确认', icon: 'success' })\r\n          this.showFahuiDatePopup = false\r\n          this.loadOrders()\r\n        } else {\r\n          throw new Error(result.result.message || '确认失败')\r\n        }\r\n      } catch (error) {\r\n        uni.showToast({ title: '确认失败', icon: 'none' })\r\n      } finally {\r\n        uni.hideLoading()\r\n      }\r\n    },\r\n    toggleDetail(idx) {\r\n      if (this.showDetailIndex === idx) {\r\n        this.showDetailIndex = -1\r\n      } else {\r\n        this.showDetailIndex = idx\r\n        this.inlineFahuiDate = this.filteredOrders[idx].fahuiDate || ''\r\n      }\r\n    },\r\n    toggleRemark(idx) {\r\n      if (this.showRemarkIndex === idx) {\r\n        this.showRemarkIndex = -1\r\n      } else {\r\n        this.showRemarkIndex = idx\r\n        this.inlineRemarkContent = ''\r\n      }\r\n    },\r\n    async confirmFahuiDate(order) {\r\n      if (!order || !this.inlineFahuiDate) return\r\n      try {\r\n        uni.showLoading({ title: '确认中...' })\r\n        const result = await uniCloud.callFunction({\r\n          name: 'updateFahuiOrderStatus',\r\n          data: {\r\n            id: order._id,\r\n            status: '已确认',\r\n            fahuiDate: this.inlineFahuiDate,\r\n            operator: '管理员'\r\n          }\r\n        })\r\n        if (result.result && result.result.success) {\r\n          uni.showToast({ title: '专场法会已确认', icon: 'success' })\r\n          this.loadOrders()\r\n        } else {\r\n          throw new Error(result.result.message || '确认失败')\r\n        }\r\n      } catch (error) {\r\n        uni.showToast({ title: '确认失败', icon: 'none' })\r\n      } finally {\r\n        uni.hideLoading()\r\n      }\r\n    },\r\n    async saveInlineRemark(order) {\r\n      if (!this.inlineRemarkContent.trim()) {\r\n        uni.showToast({ title: '请输入备注内容', icon: 'none' })\r\n        return\r\n      }\r\n      try {\r\n        const remark = { content: this.inlineRemarkContent }\r\n        await uniCloud.callFunction({\r\n          name: 'addFahuiOrderRemark',\r\n          data: {\r\n            orderId: order._id,\r\n            remark: remark,\r\n            operator: '管理员'\r\n          }\r\n        })\r\n        this.inlineRemarkContent = ''\r\n        this.loadOrders()\r\n        uni.showToast({ title: '备注添加成功', icon: 'success' })\r\n      } catch (error) {\r\n        uni.showToast({ title: '添加备注失败', icon: 'none' })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.admin-container {\r\n  min-height: 100vh;\r\n  background: #f5f5f5;\r\n  padding: 0;\r\n}\r\n\r\n.header {\r\n  background: #2d8cf0;\r\n  color: white;\r\n  padding: 20rpx 30rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  position: sticky;\r\n  top: 0;\r\n  z-index: 100;\r\n}\r\n\r\n.back-btn {\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.back-icon {\r\n  font-size: 32rpx;\r\n  margin-right: 8rpx;\r\n}\r\n\r\n.title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n}\r\n\r\n.refresh-btn {\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 28rpx;\r\n}\r\n\r\n.refresh-icon {\r\n  font-size: 32rpx;\r\n  margin-right: 8rpx;\r\n}\r\n\r\n.filter-bar {\r\n  background: white;\r\n  padding: 20rpx 30rpx;\r\n  display: flex;\r\n  gap: 30rpx;\r\n  border-bottom: 1rpx solid #eee;\r\n}\r\n\r\n.filter-item {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.filter-label {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  margin-right: 10rpx;\r\n}\r\n\r\n.picker-text {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  padding: 10rpx 20rpx;\r\n  background: #f8f9fa;\r\n  border-radius: 8rpx;\r\n  border: 1rpx solid #ddd;\r\n}\r\n\r\n.order-list {\r\n  padding: 20rpx;\r\n}\r\n\r\n.order-item {\r\n  background: white;\r\n  border-radius: 12rpx;\r\n  padding: 30rpx;\r\n  margin-bottom: 20rpx;\r\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.order-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.order-id {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n}\r\n\r\n.order-status {\r\n  padding: 8rpx 16rpx;\r\n  border-radius: 20rpx;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.status-pending {\r\n  background: #fff7e6;\r\n  color: #fa8c16;\r\n}\r\n\r\n.status-confirmed {\r\n  background: #e8f5e8;\r\n  color: #52c41a;\r\n}\r\n\r\n.status-cancelled {\r\n  background: #fff2f0;\r\n  color: #ff4d4f;\r\n}\r\n\r\n.status-default {\r\n  background: #f5f5f5;\r\n  color: #666;\r\n}\r\n\r\n.order-content {\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.order-info {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 10rpx;\r\n}\r\n\r\n.info-row {\r\n  display: flex;\r\n}\r\n\r\n.info-label {\r\n  font-size: 26rpx;\r\n  color: #666;\r\n  width: 140rpx;\r\n}\r\n\r\n.info-value {\r\n  font-size: 26rpx;\r\n  color: #333;\r\n  flex: 1;\r\n}\r\n\r\n.price {\r\n  color: #ff4d4f;\r\n  font-weight: bold;\r\n}\r\n\r\n.order-actions {\r\n  display: flex;\r\n  gap: 20rpx;\r\n}\r\n\r\n.action-btn {\r\n  flex: 1;\r\n  padding: 16rpx;\r\n  border-radius: 8rpx;\r\n  font-size: 28rpx;\r\n  border: none;\r\n}\r\n\r\n.detail-btn {\r\n  background: #1890ff;\r\n  color: white;\r\n}\r\n\r\n.status-btn {\r\n  background: #52c41a;\r\n  color: white;\r\n}\r\n\r\n.delete-btn {\r\n  background: #ff4d4f;\r\n  color: white;\r\n}\r\n\r\n.confirm-date-btn {\r\n  background: #2d8cf0;\r\n  color: #fff;\r\n  border-radius: 8rpx;\r\n  font-size: 26rpx;\r\n  padding: 12rpx 20rpx;\r\n  border: none;\r\n}\r\n\r\n.modal-content {\r\n  background: white;\r\n  border-radius: 12rpx;\r\n  width: 600rpx;\r\n  max-height: 80vh;\r\n  overflow-y: auto;\r\n}\r\n\r\n.modal-header {\r\n  padding: 30rpx;\r\n  border-bottom: 1rpx solid #eee;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.modal-title {\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.modal-close {\r\n  font-size: 40rpx;\r\n  color: #999;\r\n  cursor: pointer;\r\n}\r\n\r\n.modal-body {\r\n  padding: 30rpx;\r\n}\r\n\r\n.detail-section {\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.detail-title {\r\n  font-size: 30rpx;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n  padding-bottom: 10rpx;\r\n  border-bottom: 1rpx solid #eee;\r\n}\r\n\r\n.detail-item {\r\n  display: flex;\r\n  margin-bottom: 15rpx;\r\n}\r\n\r\n.detail-label {\r\n  font-size: 28rpx;\r\n  color: #666;\r\n  width: 160rpx;\r\n}\r\n\r\n.detail-value {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  flex: 1;\r\n}\r\n\r\n.modal-footer {\r\n  padding: 30rpx;\r\n  border-top: 1rpx solid #eee;\r\n  display: flex;\r\n  gap: 20rpx;\r\n}\r\n\r\n.modal-btn {\r\n  flex: 1;\r\n  padding: 20rpx;\r\n  border-radius: 8rpx;\r\n  font-size: 28rpx;\r\n  border: none;\r\n}\r\n\r\n.confirm-btn {\r\n  background: #2d8cf0;\r\n  color: white;\r\n}\r\n\r\n.remark-btn {\r\n  background: #fa8c16;\r\n  color: white;\r\n}\r\n\r\n.form-group {\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.form-label {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  display: block;\r\n  margin-bottom: 10rpx;\r\n}\r\n\r\n.form-input {\r\n  width: 100%;\r\n  border: 1rpx solid #e0e0e0;\r\n  border-radius: 8rpx;\r\n  padding: 20rpx;\r\n  font-size: 28rpx;\r\n  box-sizing: border-box;\r\n  height: 120rpx;\r\n  resize: none;\r\n}\r\n\r\n.remark-item {\r\n  background: #f8f9fa;\r\n  border-radius: 8rpx;\r\n  padding: 16rpx;\r\n  margin-bottom: 12rpx;\r\n}\r\n\r\n.remark-content {\r\n  font-size: 26rpx;\r\n  color: #333;\r\n  margin-bottom: 8rpx;\r\n}\r\n\r\n.remark-info {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.remark-author {\r\n  font-size: 24rpx;\r\n  color: #666;\r\n}\r\n\r\n.remark-time {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n\r\n.module-status-bar {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 16rpx;\r\n  background: #fffbe6;\r\n  padding: 16rpx 30rpx;\r\n  font-size: 28rpx;\r\n  margin-bottom: 10rpx;\r\n}\r\n.set-btn {\r\n  background: #2d8cf0;\r\n  color: #fff;\r\n  border-radius: 8rpx;\r\n  padding: 8rpx 20rpx;\r\n  font-size: 26rpx;\r\n  border: none;\r\n  margin-left: 12rpx;\r\n}\r\n.export-btn {\r\n  background: #52c41a;\r\n  color: #fff;\r\n  border-radius: 8rpx;\r\n  padding: 12rpx 24rpx;\r\n  font-size: 26rpx;\r\n  border: none;\r\n  margin-left: 16rpx;\r\n}\r\n.applicant-detail {\r\n  background: #f8f9fa;\r\n  border-radius: 8rpx;\r\n  padding: 16rpx;\r\n  margin-bottom: 12rpx;\r\n}\r\n</style> ","import mod from \"-!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./orders.vue?vue&type=style&index=0&id=6f9cf068&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./orders.vue?vue&type=style&index=0&id=6f9cf068&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1753699264124\n      var cssReload = require(\"C:/Users/小美女/Downloads/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}