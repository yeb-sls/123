# 合坛法会管理功能完善说明

## 问题描述
用户反馈：合坛法会后台的每个板块对应的不是前台的合坛法会的数据，而是显示专场法会的数据。

## 问题原因
1. 合坛法会管理页面跳转到的是同一个管理页面，没有区分专场法会和合坛法会
2. 云函数没有支持按类型筛选数据
3. 前台页面使用的是硬编码数据，而不是从后台获取

## 解决方案

### 1. 创建专门的合坛法会项目管理页面
- 新建了 `pages/admin/fahui/joint/projects.vue`
- 该页面专门管理合坛法会项目，与专场法会项目管理分离
- 添加了 `type: 'joint'` 标识

### 2. 更新云函数支持类型筛选

#### 修改的云函数：
- `getFahuiProjects` - 支持按 `type` 参数筛选
- `getFahuiBanners` - 支持按 `type` 参数筛选
- `getFahuiIntros` - 支持按 `type` 参数筛选
- `getFahuiOrders` - 支持按 `type` 参数筛选

### 3. 更新管理页面支持类型参数

#### 修改的页面：
- `pages/admin/fahui/banner.vue` - 头图管理
- `pages/admin/fahui/intro.vue` - 图文介绍管理
- `pages/admin/fahui/goods.vue` - 代办物品管理
- `pages/admin/fahui/receiver.vue` - 收件信息管理
- `pages/admin/fahui/orders.vue` - 订单管理

#### 主要修改内容：
1. 添加 `fahuiType` 数据属性
2. 在 `onLoad` 方法中获取 `type` 参数
3. 调用云函数时传递 `type` 参数
4. 页面标题根据类型动态显示

### 4. 更新前台页面数据加载

#### 修改的页面：
- `pages/fahui/special.vue` - 专场法会页面，只加载专场法会项目
- `pages/fahui/group.vue` - 合坛法会页面，从后台加载合坛法会项目

### 5. 添加路由配置
在 `pages.json` 中添加了新的合坛法会管理页面路由：
```json
{
  "path": "pages/admin/fahui/joint/projects",
  "style": { "navigationBarTitleText": "合坛法会项目管理" }
}
```

### 6. 创建测试页面
- 新建了 `pages/admin/fahui/joint/test.vue` 用于测试合坛法会管理功能
- 在合坛法会管理页面添加了"功能测试"按钮

## 现在的功能区分

### 专场法会管理
- **项目管理**：`/pages/admin/fahui/projects` (type: 'special')
- **头图管理**：`/pages/admin/fahui/banner?type=special`
- **介绍管理**：`/pages/admin/fahui/intro?type=special`
- **代办物品**：`/pages/admin/fahui/goods?type=special`
- **收件信息**：`/pages/admin/fahui/receiver?type=special`
- **订单管理**：`/pages/admin/fahui/orders?type=special`
- **前台页面**：`/pages/fahui/special`

### 合坛法会管理
- **项目管理**：`/pages/admin/fahui/joint/projects` (type: 'joint')
- **头图管理**：`/pages/admin/fahui/banner?type=joint`
- **介绍管理**：`/pages/admin/fahui/intro?type=joint`
- **代办物品**：`/pages/admin/fahui/goods?type=joint`
- **收件信息**：`/pages/admin/fahui/receiver?type=joint`
- **订单管理**：`/pages/admin/fahui/orders?type=joint`
- **前台页面**：`/pages/fahui/group`

## 数据表结构

### 法会项目表 (fahui_projects)
```javascript
{
  _id: "项目ID",
  name: "项目名称",
  description: "项目描述",
  category: "项目分类",
  price: 100,
  deadline: "2025-12-31",
  dates: ["2025-10-01", "2025-10-15"],
  maxApplicants: 50,
  goods: [],
  needReceiver: false,
  type: "special" | "joint"  // 新增字段
}
```

### 头图表 (fahui_banners)
```javascript
{
  _id: "头图ID",
  image: "图片URL",
  enabled: true,
  type: "special" | "joint"  // 新增字段
}
```

### 介绍表 (fahui_intros)
```javascript
{
  _id: "介绍ID",
  content: "介绍内容",
  enabled: true,
  type: "special" | "joint"  // 新增字段
}
```

### 订单表 (fahui_orders)
```javascript
{
  _id: "订单ID",
  fahuiType: "special" | "joint",  // 新增字段
  // ... 其他字段
}
```

## 测试建议

1. **进入后台管理** → 法会管理 → 合坛法会管理
2. **测试各个功能模块**：
   - 点击"板块头图" - 应该显示合坛法会头图管理
   - 点击"图文介绍" - 应该显示合坛法会介绍管理
   - 点击"法会项目" - 应该显示合坛法会项目管理
   - 点击"代办物品" - 应该显示合坛法会代办物品管理
   - 点击"收件信息" - 应该显示合坛法会收件信息管理
   - 点击"订单管理" - 应该显示合坛法会订单管理
3. **测试数据隔离**：
   - 在合坛法会管理中添加数据
   - 在专场法会管理中查看，应该看不到合坛法会的数据
4. **测试前台显示**：
   - 在合坛法会页面查看是否正确显示后台配置的数据

## 注意事项

1. 现有的数据需要手动添加 `type` 字段进行分类
2. 专场法会数据：`type: 'special'`
3. 合坛法会数据：`type: 'joint'`
4. 如果数据没有 `type` 字段，默认会被归类为专场法会

## 后续优化建议

1. 添加数据迁移脚本，为现有数据添加 `type` 字段
2. 在后台添加数据统计功能，显示各类型的订单数量
3. 优化前台页面，支持动态加载不同类型的配置数据
4. 添加数据导出功能，支持按类型导出数据 