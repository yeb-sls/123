# 合坛法会功能实现说明

## 功能概述

合坛法会是一个完整的法会报名管理系统，包含前台用户报名流程和后台管理功能。

## 前台功能

### 1. 合坛法会首页 (`pages/fahui/joint/index.vue`)
- **板块头图轮播**：显示后台设置的头图
- **图文介绍**：显示后台设置的介绍内容
- **法会项目列表**：展示所有可用的合坛法会项目
- **项目信息**：包含项目名称、价格、描述、分类、截止日期、可选日期、剩余名额等

### 2. 报名表单页面 (`pages/fahui/joint/form.vue`)
- **姓名信息管理**：
  - 支持添加最多5位报名人
  - 每位报名人需填写：姓名、性别、电话、农历生日、出生时辰、常住地址
  - 支持编辑和删除报名人信息
  
- **法事信息**：
  - 选择法会项目后自动调取后台设置的对应日期
  - 选择法会日期
  
- **特殊功能**：
  - 姻缘和合法会：提示输入配偶信息（选填）
  - 超度法会：选择超度类型，添加已故亲人信息（至少1人，最多5人）
  
- **代办物品**（非必选项）：
  - 后台选择此模块时前台显示
  - 选择具体代办物品（显示物品名称、法金）
  - 选择数量
  
- **收件信息**（非必填项）：
  - 后台选择此模块时前台显示
  - 收件人、收件人电话、收件地址

### 3. 确认页面 (`pages/fahui/joint/confirm.vue`)
- **显示支付法金**：包括活动费用、代办费用
- **显示代办物品**：物品名称、法金、数量
- **显示所有报名信息**：报名人信息、已故亲人信息、收件信息等

### 4. 支付页面 (`pages/fahui/joint/pay.vue`)
- **订单信息展示**
- **费用明细**
- **支付方式选择**：微信支付、支付宝
- **支付处理**

### 5. 成功页面 (`pages/fahui/joint/success.vue`)
- **成功提示**
- **订单信息**
- **后续步骤说明**
- **注意事项**
- **联系方式**

## 后台功能

### 1. 合坛法会管理系统 (`pages/admin/joint/index.vue`)
- 统一的管理入口

### 2. 项目管理 (`pages/admin/joint/projects.vue`)
- 添加、编辑、删除合坛法会项目
- 设置项目名称、价格、描述、分类
- 设置法会项目对应的具体日期
- 设置法会报名人数上限

### 3. 订单管理 (`pages/admin/joint/orders.vue`)
- 查询及导出合坛法会订单
- 订单支付成功后自动推送提醒
- 确认"此合坛法会已确认"操作
- 系统自动记录"操作人"及"操作时间"
- 添加订单备注，记录"备注内容"、"操作人"及"操作时间"

### 4. 头图管理 (`pages/admin/joint/banner.vue`)
- 编辑"板块头图"

### 5. 介绍管理 (`pages/admin/joint/intro.vue`)
- 编辑"图文介绍"

### 6. 代办物品管理 (`pages/admin/joint/goods.vue`)
- 设置"代办物品"模块
- 设置代办物品名称、单价
- 不设置前台不显示此模块

### 7. 收件信息管理 (`pages/admin/joint/receiver.vue`)
- 设置"收件信息"模块
- 不设置前台不显示此模块

### 8. 数据统计 (`pages/admin/joint/stats.vue`)
- 合坛法会相关数据统计

## 云函数

### 前台云函数
1. **getJointProjects** - 获取合坛法会项目
2. **getJointBanners** - 获取合坛法会头图
3. **getJointIntros** - 获取合坛法会介绍
4. **getJointGoods** - 获取合坛法会代办物品
5. **getJointReceiver** - 获取合坛法会收件信息配置
6. **createJointOrder** - 创建合坛法会订单
7. **updateJointOrderStatus** - 更新合坛法会订单状态

### 后台云函数
1. **addJointProject** - 添加合坛法会项目
2. **updateJointProject** - 更新合坛法会项目
3. **deleteJointProject** - 删除合坛法会项目
4. **addJointBanner** - 添加合坛法会头图
5. **deleteJointBanner** - 删除合坛法会头图
6. **addJointIntro** - 添加合坛法会介绍
7. **deleteJointIntro** - 删除合坛法会介绍
8. **addJointGood** - 添加合坛法会代办物品
9. **deleteJointGood** - 删除合坛法会代办物品
10. **updateJointReceiverConfig** - 更新合坛法会收件信息配置
11. **addJointOrderRemark** - 添加合坛法会订单备注
12. **confirmJointOrder** - 确认合坛法会订单
13. **initJointDatabase** - 初始化合坛法会数据库

## 数据库集合

1. **joint_projects** - 合坛法会项目
2. **joint_orders** - 合坛法会订单
3. **joint_banners** - 合坛法会头图
4. **joint_intros** - 合坛法会介绍
5. **joint_goods** - 合坛法会代办物品
6. **joint_receiver_config** - 合坛法会收件信息配置
7. **joint_order_remarks** - 合坛法会订单备注
8. **admin_notifications** - 管理员通知

## 特殊功能说明

### 1. 姻缘和合法会
- 选择"姻缘和合法会"时，提示输入配偶信息（选填）
- 在表单页面显示配偶信息填写按钮

### 2. 超度法会
- 选择"超度法会"时，必须选择超度类型
- 必须添加已故亲人信息：
  - 亡者姓名（必填）
  - 亡者出生农历日期（选填）
  - 亡者去世农历日期（选填）
  - 和已故亲人的关系（必选）
- 至少提交一位已故亲人信息，最多可提交五位
- 提交多人时按人数分别收费

### 3. 代办物品
- 后台可选择是否启用此模块
- 前台显示物品名称、单价、数量选择
- 费用计入总费用

### 4. 收件信息
- 后台可选择是否启用此模块
- 前台显示收件人、电话、地址输入框

## 页面路由配置

已在 `pages.json` 中添加以下路由：

```json
{
  "path": "pages/fahui/joint/form",
  "style": { "navigationBarTitleText": "合坛法会报名" }
},
{
  "path": "pages/fahui/joint/confirm",
  "style": { "navigationBarTitleText": "报名确认" }
},
{
  "path": "pages/fahui/joint/pay",
  "style": { "navigationBarTitleText": "支付" }
},
{
  "path": "pages/fahui/joint/success",
  "style": { "navigationBarTitleText": "报名成功" }
}
```

## 使用说明

### 1. 初始化数据库
首先调用 `initJointDatabase` 云函数初始化数据库和默认数据。

### 2. 后台配置
1. 在后台管理系统中配置合坛法会项目
2. 设置头图和介绍内容
3. 配置代办物品（可选）
4. 配置收件信息模块（可选）

### 3. 前台使用
1. 用户访问合坛法会首页
2. 选择法会项目进入报名表单
3. 填写报名人信息
4. 根据法会类型填写特殊信息
5. 选择代办物品和收件信息（如果启用）
6. 确认信息并支付
7. 完成报名

### 4. 后台管理
1. 查看和管理订单
2. 确认已支付的订单
3. 添加订单备注
4. 导出订单数据

## 技术特点

1. **完整的业务流程**：从报名到支付到确认的完整流程
2. **灵活配置**：后台可灵活配置各种功能模块
3. **数据持久化**：支持草稿保存和数据恢复
4. **表单验证**：完整的前端表单验证
5. **响应式设计**：适配不同屏幕尺寸
6. **云函数架构**：使用uniCloud云函数处理业务逻辑
7. **数据库设计**：合理的数据表结构设计

## 注意事项

1. 确保云函数已正确部署
2. 数据库集合需要正确创建
3. 支付功能需要配置真实的支付接口
4. 文件上传功能需要配置云存储
5. 注意数据安全和隐私保护 