# 前台表单功能实现说明

## 功能概述

前台表单页面 (`pages/fahui/joint/form.vue`) 已完整实现了姻缘和合法会和超度法会的特殊功能，包括所有要求的字段和验证逻辑。

## 姻缘和合法会功能

### ✅ 已实现的功能

1. **配偶信息提示**：
   - 当选择姻缘和合法会项目时，显示"如需填写配偶信息，请点击下方按钮"
   - 提供"填写配偶信息（选填）"按钮

2. **配偶信息表单**：
   - 姓名（选填）
   - 性别选择
   - 农历生日选择
   - 出生时辰选择

3. **配偶信息显示**：
   - 填写后显示配偶信息卡片
   - 提供"修改配偶信息"按钮

4. **数据保存**：
   - 配偶信息保存到本地草稿
   - 提交时包含在订单数据中

### 📋 实现细节

```javascript
// 配偶信息数据结构
spouse: {
  name: '',           // 姓名（选填）
  gender: '',         // 性别
  lunarBirthday: '',  // 农历生日
  birthTime: ''       // 出生时辰
}

// 性别选项
genderOptions: ['男', '女']

// 出生时辰选项
birthTimeOptions: ['子时(23:00-01:00)', '丑时(01:00-03:00)', ...]
```

## 超度法会功能

### ✅ 已实现的功能

1. **超度类型选择**（必选）：
   - 超度亡灵
   - 超度婴灵
   - 超度冤亲债主
   - 超度历代宗亲

2. **已故亲人信息管理**：
   - 至少提交一位已故亲人信息
   - 最多可提交五位已故亲人信息
   - 支持添加、编辑、删除操作

3. **已故亲人信息字段**：
   - **亡者姓名**（必填）
   - **亡者出生农历日期**（选填）
   - **亡者去世农历日期**（选填）
   - **与已故亲人的关系**（必选）

4. **关系选项**（完整列表）：
   - 先曾祖父、先曾祖母
   - 先祖父、先祖母
   - 外祖父、外祖母
   - 先父、先母
   - 岳父、岳母
   - 先夫、先妻
   - 故爱子、故爱女
   - 好友、恩师、其他

5. **费用计算**：
   - 按已故亲人人数分别收费
   - 支持多人收费逻辑

### 📋 实现细节

```javascript
// 超度类型选项
chaoduTypes: ['超度亡灵', '超度婴灵', '超度冤亲债主', '超度历代宗亲']

// 已故亲人关系选项
deceasedRelationOptions: ['先曾祖父', '先曾祖母', '先祖父', '先祖母', '外祖父', '外祖母', '先父', '先母', '岳父', '岳母', '先夫', '先妻', '故爱子', '故爱女', '好友', '恩师', '其他']

// 已故亲人数据结构
deceasedList: [{
  name: '',              // 亡者姓名（必填）
  lunarBirthday: '',     // 出生农历日期（选填）
  deathDate: '',         // 去世农历日期（选填）
  relation: ''           // 关系（必选）
}]
```

## 表单验证

### ✅ 验证规则

1. **基本验证**：
   - 至少添加一位报名人
   - 报名人信息完整（姓名、性别、电话、生日、时辰、地址）

2. **姻缘和合法会验证**：
   - 配偶信息为选填项，无强制验证

3. **超度法会验证**：
   - 超度类型必选
   - 至少添加一位已故亲人
   - 已故亲人姓名和关系为必填项
   - 出生和去世日期为选填项

4. **收件信息验证**：
   - 根据后台配置验证必填字段

### 📋 验证代码示例

```javascript
// 超度法会验证
if (this.currentProject.category === '超度法会') {
  if (!this.chaoduType) {
    uni.showToast({ title: '请选择超度类型', icon: 'none' })
    return false
  }
  
  if (this.deceasedList.length === 0) {
    uni.showToast({ title: '请至少添加一位已故亲人', icon: 'none' })
    return false
  }
  
  for (let i = 0; i < this.deceasedList.length; i++) {
    const deceased = this.deceasedList[i]
    if (!deceased.name || !deceased.relation) {
      uni.showToast({ title: `第${i + 1}位已故亲人信息不完整`, icon: 'none' })
      return false
    }
  }
}
```

## 费用计算

### ✅ 计算逻辑

1. **姻缘和合法会**：
   - 按报名人人数收费：`项目价格 × 报名人数`

2. **超度法会**：
   - 按已故亲人人数收费：`项目价格 × 已故亲人数`

3. **代办物品费用**：
   - 按选择的物品数量和单价计算

### 📋 计算代码

```javascript
// 根据项目分类计算费用
if (this.currentProject.category === '超度法会') {
  // 超度法会按已故亲人人数收费
  activityFee = this.currentProject.price * this.deceasedList.length
} else {
  // 其他法会按报名人人数收费
  activityFee = this.currentProject.price * this.applicants.length
}
```

## 数据持久化

### ✅ 草稿保存

- 所有表单数据自动保存到本地存储
- 页面刷新后自动恢复草稿数据
- 提交成功后清除草稿

### ✅ 订单数据

```javascript
const orderData = {
  type: 'joint_fahui',
  projectId: this.currentProject._id,
  projectName: this.currentProject.name,
  projectPrice: this.currentProject.price,
  selectedDate: this.selectedDate,
  chaoduType: this.chaoduType,
  applicants: this.applicants,
  spouse: this.currentProject.category === '姻缘和合' ? this.spouse : null,
  deceasedList: this.deceasedList,
  selectedItems: selectedItems,
  receiver: this.showReceiver ? this.receiver : null,
  activityFee: activityFee,
  goodsFee: goodsFee,
  totalFee: activityFee + goodsFee,
  applicantCount: this.currentProject.category === '超度法会' ? this.deceasedList.length : this.applicants.length
}
```

## 用户界面

### ✅ 界面特点

1. **分类响应式显示**：
   - 根据项目分类动态显示相应功能
   - 姻缘和合法会显示配偶信息相关界面
   - 超度法会显示超度类型和已故亲人管理界面

2. **友好提示**：
   - 清晰的必填/选填标识
   - 详细的操作提示
   - 错误信息友好显示

3. **操作便捷**：
   - 弹窗式表单编辑
   - 一键添加/删除功能
   - 实时数据保存

## 总结

前台表单页面已完整实现了所有要求的功能：

✅ **姻缘和合法会**：配偶信息填写提示和表单（选填）
✅ **超度法会**：超度类型选择（必选）+ 已故亲人信息管理（1-5人）
✅ **字段完整**：所有要求的字段都已实现
✅ **验证严格**：必填字段验证，选填字段可选
✅ **费用正确**：超度法会按已故亲人人数收费
✅ **用户体验**：友好的界面和操作流程

所有功能都已在前台表单页面中正确实现，用户可以正常使用这些特殊功能。 