# 合坛法会收件信息增删改查云函数说明

## 功能概述

为合坛法会收件信息模块提供完整的增删改查（CRUD）功能，包括添加、查询、更新和删除收件信息。

## 云函数列表

### 1. addJointReceiver - 添加收件信息

**功能**：添加新的收件信息记录

**请求参数**：
```javascript
{
  name: "收件人姓名",      // 必填
  phone: "联系电话",      // 必填，11位手机号
  address: "收件地址",    // 必填
  orderId: "订单ID"       // 可选，关联订单
}
```

**返回结果**：
```javascript
{
  code: 0,                // 0成功，1失败
  msg: "收件信息添加成功",
  data: {
    _id: "记录ID",
    name: "收件人姓名",
    phone: "联系电话",
    address: "收件地址",
    orderId: "订单ID",
    create_time: "创建时间",
    update_time: "更新时间"
  }
}
```

**验证规则**：
- 姓名不能为空
- 电话不能为空且必须是11位手机号
- 地址不能为空

### 2. getJointReceivers - 获取收件信息列表

**功能**：获取所有收件信息列表，按创建时间倒序排列

**请求参数**：
```javascript
{
  // 无需参数
}
```

**返回结果**：
```javascript
{
  code: 0,
  data: [
    {
      _id: "记录ID",
      name: "收件人姓名",
      phone: "联系电话",
      address: "收件地址",
      orderId: "订单ID",
      create_time: "创建时间",
      update_time: "更新时间"
    }
  ]
}
```

### 3. getJointReceiver - 获取单个收件信息

**功能**：根据ID获取单个收件信息

**请求参数**：
```javascript
{
  _id: "收件信息ID"       // 必填
}
```

**返回结果**：
```javascript
{
  code: 0,
  data: {
    _id: "记录ID",
    name: "收件人姓名",
    phone: "联系电话",
    address: "收件地址",
    orderId: "订单ID",
    create_time: "创建时间",
    update_time: "更新时间"
  }
}
```

**特殊说明**：
- 如果不提供 `_id` 参数，则返回收件信息模块配置（向后兼容）

### 4. updateJointReceiver - 更新收件信息

**功能**：根据ID更新收件信息

**请求参数**：
```javascript
{
  _id: "收件信息ID",      // 必填
  name: "收件人姓名",     // 必填
  phone: "联系电话",     // 必填，11位手机号
  address: "收件地址",   // 必填
  orderId: "订单ID"      // 可选
}
```

**返回结果**：
```javascript
{
  code: 0,
  msg: "收件信息更新成功",
  data: {
    _id: "记录ID",
    name: "收件人姓名",
    phone: "联系电话",
    address: "收件地址",
    orderId: "订单ID",
    update_time: "更新时间"
  }
}
```

**验证规则**：
- ID不能为空
- 姓名不能为空
- 电话不能为空且必须是11位手机号
- 地址不能为空
- 记录必须存在

### 5. deleteJointReceiver - 删除收件信息

**功能**：根据ID删除收件信息

**请求参数**：
```javascript
{
  id: "收件信息ID"        // 必填
}
```

**返回结果**：
```javascript
{
  code: 0,
  msg: "收件信息删除成功"
}
```

## 数据库结构

### joint_receivers 集合
```javascript
{
  _id: "记录ID",                    // 系统自动生成
  name: "收件人姓名",               // 字符串，必填
  phone: "联系电话",                // 字符串，11位手机号，必填
  address: "收件地址",              // 字符串，必填
  orderId: "关联订单ID",            // 字符串，可选
  create_time: "创建时间",          // 日期，系统自动生成
  update_time: "更新时间"           // 日期，系统自动更新
}
```

## 使用示例

### 前端调用示例

```javascript
// 添加收件信息
const addResult = await uniCloud.callFunction({
  name: 'addJointReceiver',
  data: {
    name: '张三',
    phone: '13800138000',
    address: '北京市朝阳区xxx街道xxx号',
    orderId: 'order_123'
  }
})

// 获取收件信息列表
const listResult = await uniCloud.callFunction({
  name: 'getJointReceivers'
})

// 获取单个收件信息
const detailResult = await uniCloud.callFunction({
  name: 'getJointReceiver',
  data: {
    _id: 'receiver_123'
  }
})

// 更新收件信息
const updateResult = await uniCloud.callFunction({
  name: 'updateJointReceiver',
  data: {
    _id: 'receiver_123',
    name: '李四',
    phone: '13900139000',
    address: '上海市浦东新区xxx街道xxx号'
  }
})

// 删除收件信息
const deleteResult = await uniCloud.callFunction({
  name: 'deleteJointReceiver',
  data: {
    id: 'receiver_123'
  }
})
```

## 错误处理

### 常见错误码
- `code: 0` - 操作成功
- `code: 1` - 操作失败

### 错误信息
- 字段验证失败：具体字段的错误提示
- 记录不存在：`收件信息不存在`
- 数据库操作失败：`操作失败`

## 安全考虑

1. **数据验证**：所有输入数据都进行格式验证
2. **手机号验证**：使用正则表达式验证手机号格式
3. **必填字段检查**：确保关键字段不为空
4. **记录存在性检查**：更新和删除前检查记录是否存在

## 性能优化

1. **索引建议**：在 `create_time` 字段上创建索引以优化列表查询
2. **分页支持**：可以根据需要添加分页参数
3. **缓存策略**：对于频繁查询的配置信息可以考虑缓存

## 相关文件

- `uniCloud-aliyun/cloudfunctions/addJointReceiver/` - 添加收件信息云函数
- `uniCloud-aliyun/cloudfunctions/getJointReceivers/` - 获取收件信息列表云函数
- `uniCloud-aliyun/cloudfunctions/getJointReceiver/` - 获取单个收件信息云函数
- `uniCloud-aliyun/cloudfunctions/updateJointReceiver/` - 更新收件信息云函数
- `uniCloud-aliyun/cloudfunctions/deleteJointReceiver/` - 删除收件信息云函数

## 部署说明

1. **上传云函数**：将所有云函数上传到云端
2. **测试功能**：在控制台测试各个云函数的功能
3. **前端集成**：在前端页面中调用相应的云函数
4. **错误监控**：监控云函数的执行情况和错误日志 